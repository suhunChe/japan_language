<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT N4 ë‹¨ì–´ í€´ì¦ˆ 2 (í˜•ìš©ì‚¬/ë¶€ì‚¬)</title>
    
    <style>
        /* --- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .back-link {
            display: inline-block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #064e3b; /* N4 í…Œë§ˆ ë‹¤í¬ ê·¸ë¦° */
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .back-link:hover { background-color: #10b981; transform: translateY(-2px); }
        .top-bar { text-align: center; background-color: #f0fdf4; padding-top: 10px; }

        /* --- ê¸°ì¡´ ìˆ˜í›ˆë‹˜ CSS ì½”ë“œ --- */
        /* N4 2íƒ„ ì „ìš© ìŠ¤íƒ€ì¼ (Unique ID: jp-n4-2) */
        #jp-n4-2-wrapper {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: #f0fdf4;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 10px;
            margin: 0 auto 30px auto; /* ì¤‘ì•™ ì •ë ¬ */
            position: relative;
            --max-width: 650px;
            --primary-color: #10b981; /* ì—ë©”ë„ë“œ ê·¸ë¦° ìœ ì§€ */
            --dark-color: #064e3b;
            --accent-color: #f59e0b;
            
            /* [ë³´í†µ] ì‚¬ì´ì¦ˆ */
            --q-size: 40px; --ex-size: 20px; --opt-size: 20px; --ruby-size: 18px; --card-pad: 25px; --btn-pad: 14px;
        }

        /* [ì‘ê²Œ] */
        #jp-n4-2-wrapper.size-small { --q-size: 24px; --ex-size: 14px; --opt-size: 15px; --ruby-size: 12px; --card-pad: 15px; --btn-pad: 10px; }
        /* [í¬ê²Œ] */
        #jp-n4-2-wrapper.size-large { --q-size: 52px; --ex-size: 26px; --opt-size: 26px; --ruby-size: 24px; --card-pad: 32px; --btn-pad: 18px; }

        #jp-n4-2-wrapper .quiz-container {
            background-color: #ffffff; padding: 20px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2); text-align: center;
            width: 100%; max-width: var(--max-width); position: relative; border: 2px solid var(--primary-color);
            box-sizing: border-box;
        }

        .control-panel {
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            gap: 10px; margin-bottom: 10px; background: #ecfdf5; padding: 8px 12px; border-radius: 10px;
        }
        
        .set-group { display: flex; flex-wrap: wrap; gap: 4px; }
        .set-btn {
            background: #fff; border: 1px solid var(--primary-color); color: var(--primary-color);
            padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; cursor: pointer;
        }
        .set-btn.active { background: var(--primary-color); color: white; }
        .set-btn-all { border-color: var(--accent-color); color: #d97706; }
        .set-btn-all.active { background: var(--accent-color); color: white; }

        .size-group { display: flex; gap: 2px; }
        .size-btn { background: #e5e7eb; border: none; padding: 4px 8px; font-size: 11px; border-radius: 4px; cursor: pointer; }
        .size-btn.active { background: #374151; color: white; }

        .status-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: #374151; color: white; padding: 8px 15px; border-radius: 8px;
            margin-bottom: 15px; font-size: 14px; font-weight: bold;
        }
        .status-item { display: flex; align-items: center; gap: 5px; }
        .timer-icon { color: var(--accent-color); }
        .score-box { color: #10b981; }

        .question-card { padding: var(--card-pad); margin-bottom: 15px; border-bottom: 1px dashed #d1fae5; }
        .word-row { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }

        ruby { font-size: var(--q-size); font-weight: bold; color: var(--dark-color); line-height: 1.5; }
        rt { font-size: var(--ruby-size); color: #059669; font-weight: normal; }

        .audio-btn {
            background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 50%;
            width: 40px; height: 40px; font-size: 20px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: transform 0.1s;
        }
        .audio-btn:active { transform: scale(0.9); }
        .audio-btn:hover { background: #e5e7eb; }

        .example-box {
            background: #f9fafb; padding: 15px; border-radius: 8px;
            font-size: var(--ex-size); color: #4b5563; line-height: 1.6; text-align: left;
        }
        .highlight { color: #d97706; font-weight: bold; background: #fef3c7; padding: 0 4px; border-radius: 4px; }

        .hint-box {
            display: none; margin-top: 10px; font-size: calc(var(--ex-size) - 1px);
            color: #059669; font-weight: bold; animation: fadeIn 0.3s;
            border-top: 1px solid #e5e7eb; padding-top: 8px;
        }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt-btn {
            background-color: #f9fafb; border: 1px solid #e5e7eb; color: #374151;
            padding: var(--btn-pad); font-size: var(--opt-size); border-radius: 10px; cursor: pointer;
            font-weight: bold; transition: all 0.1s;
        }
        .opt-btn:hover { background-color: #ecfdf5; border-color: var(--primary-color); }
        .opt-btn.correct { background-color: #10b981 !important; color: white !important; border-color: #10b981; }
        .opt-btn.wrong { background-color: #ef4444 !important; color: white !important; border-color: #ef4444; opacity: 0.6; }
        .opt-btn:disabled { cursor: not-allowed; opacity: 0.7; }

        .next-btn {
            display: none; width: 100%; margin-top: 20px; padding: 15px;
            background-color: var(--primary-color); color: white; font-size: 18px;
            font-weight: bold; border: none; border-radius: 8px; cursor: pointer; animation: fadeIn 0.3s;
        }
        .next-btn:hover { background-color: #059669; }

        #resultScreen_2 {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.99); border-radius: 15px;
            flex-direction: column; align-items: center; justify-content: center; z-index: 50;
            padding: 20px; box-sizing: border-box;
        }
        .review-list {
            width: 100%; max-height: 200px; overflow-y: auto;
            background: #f3f4f6; border-radius: 8px; padding: 10px; margin: 15px 0; text-align: left;
        }
        .review-item { border-bottom: 1px solid #e5e7eb; padding: 8px 0; font-size: 14px; }
        .review-item:last-child { border-bottom: none; }
        .review-word { font-weight: bold; color: var(--dark-color); }
        .review-mean { color: #4b5563; }

        .disabled-area { pointer-events: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body style="background-color: #f0fdf4; margin: 0; padding: 0;">

    <div class="top-bar">
        <a href="../index.html" class="back-link">ğŸ”™ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div id="jp-n4-2-wrapper">
        <div class="quiz-container">
            
            <div class="control-panel">
                <div class="set-group">
                    <button class="set-btn active" onclick="JpN4_2.changeSet(0)">1</button>
                    <button class="set-btn" onclick="JpN4_2.changeSet(1)">2</button>
                    <button class="set-btn" onclick="JpN4_2.changeSet(2)">3</button>
                    <button class="set-btn" onclick="JpN4_2.changeSet(3)">4</button>
                    <button class="set-btn" onclick="JpN4_2.changeSet(4)">5</button>
                    <button class="set-btn set-btn-all" onclick="JpN4_2.changeSet('all')">ALL</button>
                </div>
                <div class="size-group">
                    <button class="size-btn" onclick="JpN4_2.setSize('small')">ì‘ê²Œ</button>
                    <button class="size-btn active" onclick="JpN4_2.setSize('medium')" id="btnSizeM">ë³´í†µ</button>
                    <button class="size-btn" onclick="JpN4_2.setSize('large')">í¬ê²Œ</button>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-item"><span>ğŸ“</span><span id="qCount_2">1 / 20</span></div>
                <div class="status-item"><span class="timer-icon">â±ï¸</span><span id="timerDisplay_2">0s</span></div>
                <div class="status-item score-box"><span>ğŸ†</span><span id="liveScore_2">0</span></div>
            </div>

            <div class="question-card">
                <div class="word-row">
                    <div id="qWord_2"><ruby>å˜èª<rt>ãŸã‚“ã”</rt></ruby></div>
                    <button class="audio-btn" onclick="JpN4_2.speak()" title="ë‹¨ì–´ ë“£ê¸°">ğŸ”Š</button>
                </div>
                <div class="example-box">
                    <span id="qExample_2">...</span>
                    <div class="hint-box" id="qHint_2">...</div>
                </div>
            </div>

            <div class="options-grid" id="qOptions_2"></div>

            <button id="btnNext_2" class="next-btn" onclick="JpN4_2.nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â–¶</button>

            <div id="resultScreen_2">
                <h2 style="color:#064e3b; margin:0 0 10px 0;">ê²°ê³¼ ë¦¬í¬íŠ¸</h2>
                <div style="font-size:36px; font-weight:bold; color:#10b981; margin-bottom:5px;">
                    <span id="finalScore_2">0</span>ì 
                </div>
                <div style="font-size:14px; color:#6b7280; margin-bottom:15px;">
                    (ì´ì  <span id="maxScore_2">0</span>ì  ì¤‘)
                </div>
                <div id="wrongListHeader_2" style="width:100%; text-align:left; font-size:14px; font-weight:bold; color:#333; margin-bottom:5px;">
                    âŒ í‹€ë¦° ë‹¨ì–´
                </div>
                <div class="review-list" id="wrongList_2"></div>
                <button class="next-btn" style="display:block; width:auto; padding:10px 30px;" onclick="JpN4_2.initGame()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
    (function() {
        // N4 2íƒ„ ë°ì´í„°: ì´í˜•ìš©ì‚¬, ë‚˜í˜•ìš©ì‚¬, ë¶€ì‚¬ 100ê°œ
        const dataPool = [
            // Set 1: ì´í˜•ìš©ì‚¬ (ê°ì •, ì„±ì§ˆ)
            {q:"å¬‰ã—ã„", y:"ã†ã‚Œã—ã„", m:"ê¸°ì˜ë‹¤", ex:"åˆæ ¼ã—ã¦<span class='highlight'>å¬‰ã—ã„</span>ã€‚", tr:"í•©ê²©í•´ì„œ ê¸°ì˜ë‹¤."},
            {q:"æ‚²ã—ã„", y:"ã‹ãªã—ã„", m:"ìŠ¬í”„ë‹¤", ex:"<span class='highlight'>æ‚²ã—ã„</span>ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èã„ãŸã€‚", tr:"ìŠ¬í”ˆ ë‰´ìŠ¤ë¥¼ ë“¤ì—ˆë‹¤."},
            {q:"æ¥½ã—ã„", y:"ãŸã®ã—ã„", m:"ì¦ê²ë‹¤", ex:"æ—…è¡Œã¯ã¨ã¦ã‚‚<span class='highlight'>æ¥½ã—ã‹ã£</span>ãŸã€‚", tr:"ì—¬í–‰ì€ ë§¤ìš° ì¦ê±°ì› ë‹¤."},
            {q:"å¯‚ã—ã„", y:"ã•ã³ã—ã„", m:"ì™¸ë¡­ë‹¤/ì“¸ì“¸í•˜ë‹¤", ex:"ä¸€äººã§<span class='highlight'>å¯‚ã—ã„</span>ã€‚", tr:"í˜¼ìë¼ì„œ ì™¸ë¡­ë‹¤."},
            {q:"æ¥ãšã‹ã—ã„", y:"ã¯ãšã‹ã—ã„", m:"ë¶€ë„ëŸ½ë‹¤", ex:"å¤±æ•—ã—ã¦<span class='highlight'>æ¥ãšã‹ã—ã„</span>ã€‚", tr:"ì‹¤ìˆ˜í•´ì„œ ë¶€ë„ëŸ½ë‹¤."},
            {q:"ç¾¨ã¾ã—ã„", y:"ã†ã‚‰ã‚„ã¾ã—ã„", m:"ë¶€ëŸ½ë‹¤", ex:"å½¼ãŒ<span class='highlight'>ç¾¨ã¾ã—ã„</span>ã€‚", tr:"ê·¸ê°€ ë¶€ëŸ½ë‹¤."},
            {q:"å¯ç¬‘ã—ã„", y:"ãŠã‹ã—ã„", m:"ì´ìƒí•˜ë‹¤/ìš°ìŠµë‹¤", ex:"ã“ã®æ©Ÿæ¢°ã¯<span class='highlight'>ãŠã‹ã—ã„</span>ã€‚", tr:"ì´ ê¸°ê³„ëŠ” ì´ìƒí•˜ë‹¤."},
            {q:"å³ã—ã„", y:"ãã³ã—ã„", m:"ì—„ê²©í•˜ë‹¤", ex:"å…ˆç”Ÿã¯<span class='highlight'>å³ã—ã„</span>ã€‚", tr:"ì„ ìƒë‹˜ì€ ì—„ê²©í•˜ë‹¤."},
            {q:"è©³ã—ã„", y:"ãã‚ã—ã„", m:"ìƒì„¸í•˜ë‹¤/ìì„¸í•˜ë‹¤", ex:"<span class='highlight'>è©³ã—ã„</span>èª¬æ˜ã‚’èãã€‚", tr:"ìì„¸í•œ ì„¤ëª…ì„ ë“£ë‹¤."},
            {q:"è‹¦ã„", y:"ã«ãŒã„", m:"ì“°ë‹¤(ë§›)", ex:"ã“ã®è–¬ã¯<span class='highlight'>è‹¦ã„</span>ã€‚", tr:"ì´ ì•½ì€ ì“°ë‹¤."},
            {q:"è‡­ã„", y:"ãã•ã„", m:"ëƒ„ìƒˆë‚˜ë‹¤/êµ¬ë¦¬ë‹¤", ex:"ã‚´ãƒŸãŒ<span class='highlight'>è‡­ã„</span>ã€‚", tr:"ì“°ë ˆê¸°ê°€ ëƒ„ìƒˆë‚œë‹¤."},
            {q:"ç´°ã‹ã„", y:"ã“ã¾ã‹ã„", m:"ì‘ë‹¤/ì„¸ì„¸í•˜ë‹¤", ex:"<span class='highlight'>ç´°ã‹ã„</span>ãŠé‡‘ãŒãªã„ã€‚", tr:"ì”ëˆì´ ì—†ë‹¤."},
            {q:"å‡„ã„", y:"ã™ã”ã„", m:"ëŒ€ë‹¨í•˜ë‹¤", ex:"å½¼ã®æ‰èƒ½ã¯<span class='highlight'>ã™ã”ã„</span>ã€‚", tr:"ê·¸ì˜ ì¬ëŠ¥ì€ ëŒ€ë‹¨í•˜ë‹¤."},
            {q:"ç´ æ™´ã‚‰ã—ã„", y:"ã™ã°ã‚‰ã—ã„", m:"í›Œë¥­í•˜ë‹¤/ë©‹ì§€ë‹¤", ex:"<span class='highlight'>ç´ æ™´ã‚‰ã—ã„</span>æ™¯è‰²ã ã€‚", tr:"í›Œë¥­í•œ ê²½ì¹˜ë‹¤."},
            {q:"æ­£ã—ã„", y:"ãŸã ã—ã„", m:"ì˜¬ë°”ë¥´ë‹¤/ë§ë‹¤", ex:"<span class='highlight'>æ­£ã—ã„</span>ç­”ãˆã‚’é¸ã¶ã€‚", tr:"ì˜¬ë°”ë¥¸ ë‹µì„ ê³ ë¥´ë‹¤."},
            {q:"æ¿€ã—ã„", y:"ã¯ã’ã—ã„", m:"ì‹¬í•˜ë‹¤/ê²©ë ¬í•˜ë‹¤", ex:"<span class='highlight'>æ¿€ã—ã„</span>é›¨ãŒé™ã‚‹ã€‚", tr:"ì‹¬í•œ ë¹„ê°€ ë‚´ë¦°ë‹¤."},
            {q:"é…·ã„", y:"ã²ã©ã„", m:"ì‹¬í•˜ë‹¤/ê°€í˜¹í•˜ë‹¤", ex:"<span class='highlight'>ã²ã©ã„</span>ã“ã¨ã‚’è¨€ã†ã€‚", tr:"ì‹¬í•œ ë§ì„ í•˜ë‹¤."},
            {q:"æ·±ã„", y:"ãµã‹ã„", m:"ê¹Šë‹¤", ex:"æµ·ãŒ<span class='highlight'>æ·±ã„</span>ã€‚", tr:"ë°”ë‹¤ê°€ ê¹Šë‹¤."},
            {q:"çã—ã„", y:"ã‚ãšã‚‰ã—ã„", m:"ë“œë¬¼ë‹¤/í¬ê·€í•˜ë‹¤", ex:"<span class='highlight'>çã—ã„</span>é³¥ã‚’è¦‹ãŸã€‚", tr:"í¬ê·€í•œ ìƒˆë¥¼ ë³´ì•˜ë‹¤."},
            {q:"å„ªã—ã„", y:"ã‚„ã•ã—ã„", m:"ìƒëƒ¥í•˜ë‹¤/ì‰½ë‹¤", ex:"å½¼ã¯<span class='highlight'>å„ªã—ã„</span>äººã ã€‚", tr:"ê·¸ëŠ” ìƒëƒ¥í•œ ì‚¬ëŒì´ë‹¤."},

            // Set 2: ì´í˜•ìš©ì‚¬ (ìƒíƒœ, ë‚ ì”¨, ê°ê°)
            {q:"æŸ”ã‚‰ã‹ã„", y:"ã‚„ã‚ã‚‰ã‹ã„", m:"ë¶€ë“œëŸ½ë‹¤", ex:"<span class='highlight'>æŸ”ã‚‰ã‹ã„</span>ãƒ‘ãƒ³ã‚’é£Ÿã¹ã‚‹ã€‚", tr:"ë¶€ë“œëŸ¬ìš´ ë¹µì„ ë¨¹ë‹¤."},
            {q:"æµ…ã„", y:"ã‚ã•ã„", m:"ì–•ë‹¤", ex:"ã“ã®å·ã¯<span class='highlight'>æµ…ã„</span>ã€‚", tr:"ì´ ê°•ì€ ì–•ë‹¤."},
            {q:"ç¾ã—ã„", y:"ã†ã¤ãã—ã„", m:"ì•„ë¦„ë‹µë‹¤", ex:"<span class='highlight'>ç¾ã—ã„</span>èŠ±ãŒå’²ã„ãŸã€‚", tr:"ì•„ë¦„ë‹¤ìš´ ê½ƒì´ í”¼ì—ˆë‹¤."},
            {q:"é‡ã„", y:"ãŠã‚‚ã„", m:"ë¬´ê²ë‹¤", ex:"è·ç‰©ãŒ<span class='highlight'>é‡ã„</span>ã€‚", tr:"ì§ì´ ë¬´ê²ë‹¤."},
            {q:"è»½ã„", y:"ã‹ã‚‹ã„", m:"ê°€ë³ë‹¤", ex:"<span class='highlight'>è»½ã„</span>é´ã‚’å±¥ãã€‚", tr:"ê°€ë²¼ìš´ ì‹ ë°œì„ ì‹ ë‹¤."},
            {q:"ç¡¬ã„", y:"ã‹ãŸã„", m:"ë‹¨ë‹¨í•˜ë‹¤/ë”±ë”±í•˜ë‹¤", ex:"ã“ã®è‚‰ã¯<span class='highlight'>ç¡¬ã„</span>ã€‚", tr:"ì´ ê³ ê¸°ëŠ” ì§ˆê¸°ë‹¤(ë”±ë”±í•˜ë‹¤)."},
            {q:"æ±šã„", y:"ããŸãªã„", m:"ë”ëŸ½ë‹¤", ex:"æ‰‹ãŒ<span class='highlight'>æ±šã„</span>ã€‚", tr:"ì†ì´ ë”ëŸ½ë‹¤."},
            {q:"æš—ã„", y:"ãã‚‰ã„", m:"ì–´ë‘¡ë‹¤", ex:"éƒ¨å±‹ãŒ<span class='highlight'>æš—ã„</span>ã€‚", tr:"ë°©ì´ ì–´ë‘¡ë‹¤."},
            {q:"æ€–ã„", y:"ã“ã‚ã„", m:"ë¬´ì„­ë‹¤", ex:"<span class='highlight'>æ€–ã„</span>æ˜ ç”»ã‚’è¦‹ãŸã€‚", tr:"ë¬´ì„œìš´ ì˜í™”ë¥¼ ë³´ì•˜ë‹¤."},
            {q:"çœ ã„", y:"ã­ã‚€ã„", m:"ì¡¸ë¦¬ë‹¤", ex:"æ˜¼ã”é£¯ã®å¾Œã§<span class='highlight'>çœ ã„</span>ã€‚", tr:"ì ì‹¬ ë¨¹ì€ í›„ì— ì¡¸ë¦¬ë‹¤."},
            {q:"åºƒã„", y:"ã²ã‚ã„", m:"ë„“ë‹¤", ex:"<span class='highlight'>åºƒã„</span>å®¶ã«ä½ã¿ãŸã„ã€‚", tr:"ë„“ì€ ì§‘ì— ì‚´ê³  ì‹¶ë‹¤."},
            {q:"ç‹­ã„", y:"ã›ã¾ã„", m:"ì¢ë‹¤", ex:"é“ãŒ<span class='highlight'>ç‹­ã„</span>ã€‚", tr:"ê¸¸ì´ ì¢ë‹¤."},
            {q:"å¤ªã„", y:"ãµã¨ã„", m:"êµµë‹¤", ex:"<span class='highlight'>å¤ªã„</span>ç·šã‚’å¼•ãã€‚", tr:"êµµì€ ì„ ì„ ê¸‹ë‹¤."},
            {q:"ç´°ã„", y:"ã»ãã„", m:"ê°€ëŠ˜ë‹¤", ex:"<span class='highlight'>ç´°ã„</span>ãƒšãƒ³ã§æ›¸ãã€‚", tr:"ê°€ëŠ” íœìœ¼ë¡œ ì“°ë‹¤."},
            {q:"å¼±ã„", y:"ã‚ˆã‚ã„", m:"ì•½í•˜ë‹¤", ex:"ä½“ãŒ<span class='highlight'>å¼±ã„</span>ã€‚", tr:"ëª¸ì´ ì•½í•˜ë‹¤."},
            {q:"å¼·ã„", y:"ã¤ã‚ˆã„", m:"ê°•í•˜ë‹¤", ex:"é¢¨ãŒ<span class='highlight'>å¼·ã„</span>ã€‚", tr:"ë°”ëŒì´ ê°•í•˜ë‹¤."},
            {q:"æ‚ªã„", y:"ã‚ã‚‹ã„", m:"ë‚˜ì˜ë‹¤", ex:"å¤©æ°—ãŒ<span class='highlight'>æ‚ªã„</span>ã€‚", tr:"ë‚ ì”¨ê°€ ë‚˜ì˜ë‹¤."},
            {q:"è‹¥ã„", y:"ã‚ã‹ã„", m:"ì Šë‹¤", ex:"å½¼ã¯ã¾ã <span class='highlight'>è‹¥ã„</span>ã€‚", tr:"ê·¸ëŠ” ì•„ì§ ì Šë‹¤."},
            {q:"å®œã—ã„", y:"ã‚ˆã‚ã—ã„", m:"ì¢‹ë‹¤(ì •ì¤‘)", ex:"ã“ã‚Œã§<span class='highlight'>ã‚ˆã‚ã—ã„</span>ã§ã™ã‹ã€‚", tr:"ì´ê²ƒìœ¼ë¡œ ê´œì°®ìœ¼ì‹­ë‹ˆê¹Œ?"},
            {q:"å†·ãŸã„", y:"ã¤ã‚ãŸã„", m:"ì°¨ê°‘ë‹¤", ex:"<span class='highlight'>å†·ãŸã„</span>æ°´ãŒé£²ã¿ãŸã„ã€‚", tr:"ì°¨ê°€ìš´ ë¬¼ì„ ë§ˆì‹œê³  ì‹¶ë‹¤."},

            // Set 3: ë‚˜í˜•ìš©ì‚¬ (ì„±ê²©, íŒë‹¨)
            {q:"å¤§åˆ‡", y:"ãŸã„ã›ã¤", m:"ì†Œì¤‘í•¨/ì¤‘ìš”í•¨", ex:"<span class='highlight'>å¤§åˆ‡</span>ãªå‹é”ã ã€‚", tr:"ì†Œì¤‘í•œ ì¹œêµ¬ë‹¤."},
            {q:"ä¸å¯§", y:"ã¦ã„ã­ã„", m:"ì •ì¤‘í•¨/ê³µì†í•¨", ex:"<span class='highlight'>ä¸å¯§</span>ã«èª¬æ˜ã™ã‚‹ã€‚", tr:"ì •ì¤‘í•˜ê²Œ ì„¤ëª…í•˜ë‹¤."},
            {q:"è¤‡é›‘", y:"ãµãã–ã¤", m:"ë³µì¡í•¨", ex:"<span class='highlight'>è¤‡é›‘</span>ãªå•é¡Œã ã€‚", tr:"ë³µì¡í•œ ë¬¸ì œë‹¤."},
            {q:"ç„¡ç†", y:"ã‚€ã‚Š", m:"ë¬´ë¦¬í•¨/ë¶ˆê°€ëŠ¥í•¨", ex:"ãã‚Œã¯<span class='highlight'>ç„¡ç†</span>ãªè©±ã ã€‚", tr:"ê·¸ê²ƒì€ ë¬´ë¦¬í•œ ì´ì•¼ê¸°ë‹¤."},
            {q:"æ¥½", y:"ã‚‰ã", m:"í¸ì•ˆí•¨/ì‰¬ì›€", ex:"<span class='highlight'>æ¥½</span>ãªä»•äº‹ã¯ãªã„ã€‚", tr:"í¸í•œ ì¼ì€ ì—†ë‹¤."},
            {q:"å®‰å…¨", y:"ã‚ã‚“ãœã‚“", m:"ì•ˆì „í•¨", ex:"ã“ã“ã¯<span class='highlight'>å®‰å…¨</span>ã§ã™ã€‚", tr:"ì—¬ê¸°ëŠ” ì•ˆì „í•©ë‹ˆë‹¤."},
            {q:"å±é™º", y:"ãã‘ã‚“", m:"ìœ„í—˜í•¨", ex:"<span class='highlight'>å±é™º</span>ãªå ´æ‰€ã«ã¯è¡Œã‹ãªã„ã€‚", tr:"ìœ„í—˜í•œ ì¥ì†Œì—ëŠ” ê°€ì§€ ì•ŠëŠ”ë‹¤."},
            {q:"è¦ªåˆ‡", y:"ã—ã‚“ã›ã¤", m:"ì¹œì ˆí•¨", ex:"<span class='highlight'>è¦ªåˆ‡</span>ãªäººã«å‡ºä¼šã£ãŸã€‚", tr:"ì¹œì ˆí•œ ì‚¬ëŒì„ ë§Œë‚¬ë‹¤."},
            {q:"çœŸé¢ç›®", y:"ã¾ã˜ã‚", m:"ì„±ì‹¤í•¨", ex:"å½¼ã¯<span class='highlight'>çœŸé¢ç›®</span>ãªå­¦ç”Ÿã ã€‚", tr:"ê·¸ëŠ” ì„±ì‹¤í•œ í•™ìƒì´ë‹¤."},
            {q:"ä¸çœŸé¢ç›®", y:"ãµã¾ã˜ã‚", m:"ë¶ˆì„±ì‹¤í•¨", ex:"<span class='highlight'>ä¸çœŸé¢ç›®</span>ãªæ…‹åº¦ã‚’ã¨ã‚‹ã€‚", tr:"ë¶ˆì„±ì‹¤í•œ íƒœë„ë¥¼ ì·¨í•˜ë‹¤."},
            {q:"ç†±å¿ƒ", y:"ã­ã£ã—ã‚“", m:"ì—´ì‹¬ì„", ex:"<span class='highlight'>ç†±å¿ƒ</span>ã«å‹‰å¼·ã™ã‚‹ã€‚", tr:"ì—´ì‹¬íˆ ê³µë¶€í•˜ë‹¤."},
            {q:"å¿ƒé…", y:"ã—ã‚“ã±ã„", m:"ê±±ì •ìŠ¤ëŸ¬ì›€", ex:"è¦ªã«<span class='highlight'>å¿ƒé…</span>ã‚’ã‹ã‘ã‚‹ã€‚", tr:"ë¶€ëª¨ì—ê²Œ ê±±ì •ì„ ë¼ì¹˜ë‹¤."},
            {q:"é‚ªé­”", y:"ã˜ã‚ƒã¾", m:"ë°©í•´ë¨", ex:"å‹‰å¼·ã®<span class='highlight'>é‚ªé­”</span>ã‚’ã—ãªã„ã§ã€‚", tr:"ê³µë¶€ë¥¼ ë°©í•´í•˜ì§€ ë§ˆ."},
            {q:"ååˆ†", y:"ã˜ã‚…ã†ã¶ã‚“", m:"ì¶©ë¶„í•¨", ex:"æ™‚é–“ã¯<span class='highlight'>ååˆ†</span>ã‚ã‚‹ã€‚", tr:"ì‹œê°„ì€ ì¶©ë¶„íˆ ìˆë‹¤."},
            {q:"å¤‰", y:"ã¸ã‚“", m:"ì´ìƒí•¨", ex:"<span class='highlight'>å¤‰</span>ãªéŸ³ãŒã—ãŸã€‚", tr:"ì´ìƒí•œ ì†Œë¦¬ê°€ ë‚¬ë‹¤."},
            {q:"ä¸ä¾¿", y:"ãµã¹ã‚“", m:"ë¶ˆí¸í•¨", ex:"äº¤é€šãŒ<span class='highlight'>ä¸ä¾¿</span>ã ã€‚", tr:"êµí†µì´ ë¶ˆí¸í•˜ë‹¤."},
            {q:"ä¾¿åˆ©", y:"ã¹ã‚“ã‚Š", m:"í¸ë¦¬í•¨", ex:"ã‚¹ãƒãƒ›ã¯<span class='highlight'>ä¾¿åˆ©</span>ã ã€‚", tr:"ìŠ¤ë§ˆíŠ¸í°ì€ í¸ë¦¬í•˜ë‹¤."},
            {q:"ç°¡å˜", y:"ã‹ã‚“ãŸã‚“", m:"ê°„ë‹¨í•¨", ex:"<span class='highlight'>ç°¡å˜</span>ãªæ–™ç†ã‚’ä½œã‚‹ã€‚", tr:"ê°„ë‹¨í•œ ìš”ë¦¬ë¥¼ ë§Œë“¤ë‹¤."},
            {q:"ç››ã‚“", y:"ã•ã‹ã‚“", m:"ì„±í–‰í•¨/í™œë°œí•¨", ex:"ã‚¹ãƒãƒ¼ãƒ„ãŒ<span class='highlight'>ç››ã‚“</span>ã ã€‚", tr:"ìŠ¤í¬ì¸ ê°€ í™œë°œí•˜ë‹¤(ì„±í–‰í•˜ë‹¤)."},
            {q:"æ®‹å¿µ", y:"ã–ã‚“ã­ã‚“", m:"ìœ ê°ìŠ¤ëŸ¬ì›€/ì•„ì‰¬ì›€", ex:"è¡Œã‘ãªãã¦<span class='highlight'>æ®‹å¿µ</span>ã ã€‚", tr:"ê°ˆ ìˆ˜ ì—†ì–´ì„œ ì•„ì‰½ë‹¤."},

            // Set 4: ë‚˜í˜•ìš©ì‚¬ & ê¸°íƒ€
            {q:"å¥½ã", y:"ã™ã", m:"ì¢‹ì•„í•¨", ex:"çŒ«ãŒ<span class='highlight'>å¥½ã</span>ã ã€‚", tr:"ê³ ì–‘ì´ë¥¼ ì¢‹ì•„í•œë‹¤."},
            {q:"å«Œã„", y:"ãã‚‰ã„", m:"ì‹«ì–´í•¨", ex:"å˜˜ã¤ãã¯<span class='highlight'>å«Œã„</span>ã ã€‚", tr:"ê±°ì§“ë§ìŸì´ëŠ” ì‹«ë‹¤."},
            {q:"ä¸Šæ‰‹", y:"ã˜ã‚‡ã†ãš", m:"ì˜í•¨/ëŠ¥ìˆ™í•¨", ex:"æ­ŒãŒ<span class='highlight'>ä¸Šæ‰‹</span>ã ã€‚", tr:"ë…¸ë˜ë¥¼ ì˜í•œë‹¤."},
            {q:"ä¸‹æ‰‹", y:"ã¸ãŸ", m:"ì„œíˆ¼/ëª»í•¨", ex:"çµµãŒ<span class='highlight'>ä¸‹æ‰‹</span>ã ã€‚", tr:"ê·¸ë¦¼ì„ ëª» ê·¸ë¦°ë‹¤."},
            {q:"å¾—æ„", y:"ã¨ãã„", m:"ìì‹ ìˆìŒ/ì˜í•¨", ex:"è‹±èªãŒ<span class='highlight'>å¾—æ„</span>ã ã€‚", tr:"ì˜ì–´ë¥¼ ì˜í•œë‹¤(ìì‹ ìˆë‹¤)."},
            {q:"è‹¦æ‰‹", y:"ã«ãŒã¦", m:"ì„œíˆ¼/ê±°ë¶í•¨", ex:"ç´è±†ã¯<span class='highlight'>è‹¦æ‰‹</span>ã ã€‚", tr:"ë‚«í† ëŠ” ì˜ ëª» ë¨¹ëŠ”ë‹¤(ê±°ë¶í•˜ë‹¤)."},
            {q:"å¿…è¦", y:"ã²ã¤ã‚ˆã†", m:"í•„ìš”í•¨", ex:"ãƒ“ã‚¶ãŒ<span class='highlight'>å¿…è¦</span>ã§ã™ã€‚", tr:"ë¹„ìê°€ í•„ìš”í•©ë‹ˆë‹¤."},
            {q:"ç«‹æ´¾", y:"ã‚Šã£ã±", m:"í›Œë¥­í•¨", ex:"<span class='highlight'>ç«‹æ´¾</span>ãªå»ºç‰©ã ã€‚", tr:"í›Œë¥­í•œ ê±´ë¬¼ì´ë‹¤."},
            {q:"è‡ªç”±", y:"ã˜ã‚†ã†", m:"ììœ ë¡œì›€", ex:"<span class='highlight'>è‡ªç”±</span>ã«ä½¿ãˆã‚‹ã€‚", tr:"ììœ ë¡­ê²Œ ì“¸ ìˆ˜ ìˆë‹¤."},
            {q:"é©å½“", y:"ã¦ãã¨ã†", m:"ì ë‹¹í•¨", ex:"<span class='highlight'>é©å½“</span>ãªå¤§ãã•ã«åˆ‡ã‚‹ã€‚", tr:"ì ë‹¹í•œ í¬ê¸°ë¡œ ìë¥´ë‹¤."},
            {q:"ç‰¹åˆ¥", y:"ã¨ãã¹ã¤", m:"íŠ¹ë³„í•¨", ex:"ä»Šæ—¥ã¯<span class='highlight'>ç‰¹åˆ¥</span>ãªæ—¥ã ã€‚", tr:"ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ë‚ ì´ë‹¤."},
            {q:"çµæ§‹", y:"ã‘ã£ã“ã†", m:"ê´œì°®ìŒ/í›Œë¥­í•¨", ex:"å‘³ã¯<span class='highlight'>çµæ§‹</span>ã§ã™ã€‚", tr:"ë§›ì€ ì¢‹ìŠµë‹ˆë‹¤(ê´œì°®ìŠµë‹ˆë‹¤)."},
            {q:"æœ‰å", y:"ã‚†ã†ã‚ã„", m:"ìœ ëª…í•¨", ex:"<span class='highlight'>æœ‰å</span>ãªä½œå®¶ã€‚", tr:"ìœ ëª…í•œ ì‘ê°€."},
            {q:"è‰²ã€…", y:"ã„ã‚ã„ã‚", m:"ì—¬ëŸ¬ê°€ì§€", ex:"<span class='highlight'>è‰²ã€…</span>ãªå›½ã¸è¡ŒããŸã„ã€‚", tr:"ì—¬ëŸ¬ ë‚˜ë¼ì— ê°€ê³  ì‹¶ë‹¤."},
            {q:"å¤§äº‹", y:"ã ã„ã˜", m:"ì¤‘ìš”í•¨/í°ì¼", ex:"ãŠä½“ã‚’<span class='highlight'>å¤§äº‹</span>ã«ã€‚", tr:"ëª¸ì¡°ë¦¬ ì˜ í•˜ì„¸ìš”(ëª¸ì„ ì†Œì¤‘íˆ)."},
            {q:"å¤§ä¸ˆå¤«", y:"ã ã„ã˜ã‚‡ã†ã¶", m:"ê´œì°®ìŒ", ex:"ä¸€äººã§ã‚‚<span class='highlight'>å¤§ä¸ˆå¤«</span>ã§ã™ã€‚", tr:"í˜¼ìë¼ë„ ê´œì°®ìŠµë‹ˆë‹¤."},
            {q:"å¤§å¥½ã", y:"ã ã„ã™ã", m:"ë§¤ìš° ì¢‹ì•„í•¨", ex:"ã‚¢ãƒ‹ãƒ¡ãŒ<span class='highlight'>å¤§å¥½ã</span>ã ã€‚", tr:"ì• ë‹ˆë©”ì´ì…˜ì„ ë§¤ìš° ì¢‹ì•„í•œë‹¤."},
            {q:"å¤§å«Œã„", y:"ã ã„ãã‚‰ã„", m:"ë§¤ìš° ì‹«ì–´í•¨", ex:"è™«ãŒ<span class='highlight'>å¤§å«Œã„</span>ã ã€‚", tr:"ë²Œë ˆë¥¼ ë§¤ìš° ì‹«ì–´í•œë‹¤."},
            {q:"æš‡", y:"ã²ã¾", m:"í•œê°€í•¨", ex:"æ˜æ—¥ã¯<span class='highlight'>æš‡</span>ã ã€‚", tr:"ë‚´ì¼ì€ í•œê°€í•˜ë‹¤."},
            {q:"å…ƒæ°—", y:"ã’ã‚“ã", m:"ê±´ê°•í•¨/í™œê¸°ì°¸", ex:"ãŠ<span class='highlight'>å…ƒæ°—</span>ã§ã™ã‹ã€‚", tr:"ê±´ê°•í•˜ì‹­ë‹ˆê¹Œ? (ì˜ ì§€ë‚´ì„¸ìš”?)"},

            // Set 5: í•„ìˆ˜ ë¶€ì‚¬
            {q:"ãœã²", y:"ãœã²", m:"ê¼­/ë°˜ë“œì‹œ", ex:"<span class='highlight'>ãœã²</span>éŠã³ã«æ¥ã¦ãã ã•ã„ã€‚", tr:"ê¼­ ë†€ëŸ¬ ì˜¤ì„¸ìš”."},
            {q:"ãŸã¶ã‚“", y:"ãŸã¶ã‚“", m:"ì•„ë§ˆ", ex:"<span class='highlight'>ãŸã¶ã‚“</span>é›¨ãŒé™ã‚‹ã§ã—ã‚‡ã†ã€‚", tr:"ì•„ë§ˆ ë¹„ê°€ ì˜¤ê² ì§€ìš”."},
            {q:"ãã£ã¨", y:"ãã£ã¨", m:"ë¶„ëª…/ë°˜ë“œì‹œ", ex:"å½¼ã¯<span class='highlight'>ãã£ã¨</span>æ¥ã‚‹ã€‚", tr:"ê·¸ëŠ” ë¶„ëª… ì˜¬ ê²ƒì´ë‹¤."},
            {q:"ãšã£ã¨", y:"ãšã£ã¨", m:"ê³„ì†/í›¨ì”¬", ex:"<span class='highlight'>ãšã£ã¨</span>å¾…ã£ã¦ã„ãŸã€‚", tr:"ê³„ì† ê¸°ë‹¤ë ¸ë‹¤."},
            {q:"ãã‚ãã‚", y:"ãã‚ãã‚", m:"ìŠ¬ìŠ¬", ex:"<span class='highlight'>ãã‚ãã‚</span>å¸°ã‚Šã¾ã—ã‚‡ã†ã€‚", tr:"ìŠ¬ìŠ¬ ëŒì•„ê°‘ì‹œë‹¤."},
            {q:"ãªã‹ãªã‹", y:"ãªã‹ãªã‹", m:"ì¢€ì²˜ëŸ¼/ê½¤", ex:"ãƒã‚¹ãŒ<span class='highlight'>ãªã‹ãªã‹</span>æ¥ãªã„ã€‚", tr:"ë²„ìŠ¤ê°€ ì¢€ì²˜ëŸ¼ ì˜¤ì§€ ì•ŠëŠ”ë‹¤."},
            {q:"ã‚„ã£ã±ã‚Š", y:"ã‚„ã£ã±ã‚Š", m:"ì—­ì‹œ", ex:"<span class='highlight'>ã‚„ã£ã±ã‚Š</span>å›ã¯ã™ã”ã„ã€‚", tr:"ì—­ì‹œ ë„ˆëŠ” ëŒ€ë‹¨í•´."},
            {q:"å…¨ç„¶", y:"ãœã‚“ãœã‚“", m:"ì „í˜€", ex:"<span class='highlight'>å…¨ç„¶</span>ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚", tr:"ì „í˜€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤."},
            {q:"ã»ã¨ã‚“ã©", y:"ã»ã¨ã‚“ã©", m:"ê±°ì˜/ëŒ€ë¶€ë¶„", ex:"å®¿é¡Œã¯<span class='highlight'>ã»ã¨ã‚“ã©</span>çµ‚ã‚ã£ãŸã€‚", tr:"ìˆ™ì œëŠ” ê±°ì˜ ëë‚¬ë‹¤."},
            {q:"ã ã„ã¶", y:"ã ã„ã¶", m:"ê½¤/ìƒë‹¹íˆ", ex:"ç—…æ°—ãŒ<span class='highlight'>ã ã„ã¶</span>è‰¯ããªã£ãŸã€‚", tr:"ë³‘ì´ ê½¤ ì¢‹ì•„ì¡Œë‹¤."},
            {q:"ã‚„ã£ã¨", y:"ã‚„ã£ã¨", m:"ê²¨ìš°/ë§ˆì¹¨ë‚´", ex:"<span class='highlight'>ã‚„ã£ã¨</span>è©¦é¨“ãŒçµ‚ã‚ã£ãŸã€‚", tr:"ë“œë””ì–´ ì‹œí—˜ì´ ëë‚¬ë‹¤."},
            {q:"å¿…ãš", y:"ã‹ãªã‚‰ãš", m:"ë°˜ë“œì‹œ", ex:"<span class='highlight'>å¿…ãš</span>ç´„æŸã‚’å®ˆã‚‹ã€‚", tr:"ë°˜ë“œì‹œ ì•½ì†ì„ ì§€í‚¨ë‹¤."},
            {q:"ã¯ã£ãã‚Š", y:"ã¯ã£ãã‚Š", m:"í™•ì‹¤íˆ/ëšœë ·ì´", ex:"<span class='highlight'>ã¯ã£ãã‚Š</span>è¨€ã£ã¦ãã ã•ã„ã€‚", tr:"í™•ì‹¤í•˜ê²Œ ë§í•´ ì£¼ì„¸ìš”."},
            {q:"ã—ã£ã‹ã‚Š", y:"ã—ã£ã‹ã‚Š", m:"ì œëŒ€ë¡œ/í™•ì‹¤íˆ", ex:"<span class='highlight'>ã—ã£ã‹ã‚Š</span>å‹‰å¼·ã—ãªã•ã„ã€‚", tr:"ì œëŒ€ë¡œ ê³µë¶€í•˜ì‹œì˜¤."},
            {q:"ã‚†ã£ãã‚Š", y:"ã‚†ã£ãã‚Š", m:"ì²œì²œíˆ/í‘¹", ex:"<span class='highlight'>ã‚†ã£ãã‚Š</span>ä¼‘ã‚“ã§ãã ã•ã„ã€‚", tr:"í‘¹ ì‰¬ì„¸ìš”."},
            {q:"ã ã‚“ã ã‚“", y:"ã ã‚“ã ã‚“", m:"ì ì ", ex:"<span class='highlight'>ã ã‚“ã ã‚“</span>å¯’ããªã‚‹ã€‚", tr:"ì ì  ì¶”ì›Œì§„ë‹¤."},
            {q:"ã‚‚ã†ã™ã", y:"ã‚‚ã†ã™ã", m:"ì´ì œ ê³§", ex:"<span class='highlight'>ã‚‚ã†ã™ã</span>æ˜¥ã ã€‚", tr:"ì´ì œ ê³§ ë´„ì´ë‹¤."},
            {q:"æ™‚ã€…", y:"ã¨ãã©ã", m:"ê°€ë”", ex:"<span class='highlight'>æ™‚ã€…</span>æ˜ ç”»ã‚’è¦‹ã‚‹ã€‚", tr:"ê°€ë” ì˜í™”ë¥¼ ë³¸ë‹¤."},
            {q:"çµ¶å¯¾ã«", y:"ãœã£ãŸã„ã«", m:"ì ˆëŒ€ë¡œ", ex:"<span class='highlight'>çµ¶å¯¾ã«</span>å¿˜ã‚Œãªã„ã€‚", tr:"ì ˆëŒ€ë¡œ ìŠì§€ ì•ŠëŠ”ë‹¤."},
            {q:"ç‰¹ã«", y:"ã¨ãã«", m:"íŠ¹íˆ", ex:"<span class='highlight'>ç‰¹ã«</span>å•é¡Œã¯ãªã„ã€‚", tr:"íŠ¹íˆ ë¬¸ì œëŠ” ì—†ë‹¤."}
        ];

        let quizList = [];
        let currentIdx = 0;
        let score = 0;
        let attempts = 0;
        let currentMode = 0;
        let timerInterval = null;
        let seconds = 0;
        let wrongAnswers = []; 
        let maxPossibleScore = 0;

        const wrapper = document.getElementById('jp-n4-2-wrapper');
        const elQWord = document.getElementById('qWord_2');
        const elQExample = document.getElementById('qExample_2');
        const elQHint = document.getElementById('qHint_2');
        const elOptions = document.getElementById('qOptions_2');
        const elNextBtn = document.getElementById('btnNext_2');
        const elResult = document.getElementById('resultScreen_2');
        const elFinalScore = document.getElementById('finalScore_2');
        const elMaxScore = document.getElementById('maxScore_2');
        const elWrongList = document.getElementById('wrongList_2');
        const elWrongHeader = document.getElementById('wrongListHeader_2');
        const elQCount = document.getElementById('qCount_2');
        const elTimer = document.getElementById('timerDisplay_2');
        const elLiveScore = document.getElementById('liveScore_2');

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function setSize(size) {
            wrapper.classList.remove('size-small', 'size-large');
            const btns = wrapper.querySelectorAll('.size-btn');
            btns.forEach(b => b.classList.remove('active'));

            if (size === 'small') {
                wrapper.classList.add('size-small');
                btns[0].classList.add('active');
            } else if (size === 'large') {
                wrapper.classList.add('size-large');
                btns[2].classList.add('active');
            } else {
                btns[1].classList.add('active');
            }
        }

        function changeSet(mode) {
            currentMode = mode;
            const btns = wrapper.querySelectorAll('.set-btn');
            btns.forEach(b => b.classList.remove('active'));
            let btnIdx = (mode === 'all') ? 5 : mode;
            btns[btnIdx].classList.add('active');
            initGame();
        }

        function initGame() {
            let targetData = [];
            if (currentMode === 'all') {
                targetData = shuffle([...dataPool]);
            } else {
                const start = currentMode * 20;
                const end = start + 20;
                targetData = shuffle(dataPool.slice(start, end));
            }

            quizList = targetData;
            currentIdx = 0;
            score = 0;
            wrongAnswers = [];
            maxPossibleScore = quizList.length * 10;

            elResult.style.display = 'none';
            updateStatus();
            loadQuestion();
        }

        function loadQuestion() {
            if (currentIdx >= quizList.length) {
                finishGame();
                return;
            }

            const data = quizList[currentIdx];
            attempts = 0; 
            
            resetTimer();
            startTimer();
            updateStatus();

            elQWord.innerHTML = `<ruby>${data.q}<rt>${data.y}</rt></ruby>`;
            elQExample.innerHTML = data.ex;
            
            elQHint.style.display = 'none';
            elQHint.innerText = `ğŸ’¡ í•´ì„: ${data.tr}`;

            elNextBtn.style.display = 'none';
            elOptions.innerHTML = '';
            elOptions.classList.remove('disabled-area');

            let opts = [{txt: data.m, isAns: true}];
            let others = shuffle(dataPool.filter(d => d.m !== data.m)).slice(0, 3);
            others.forEach(o => opts.push({txt: o.m, isAns: false}));
            opts = shuffle(opts);

            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt.txt;
                btn.onclick = () => checkAnswer(btn, opt.isAns);
                elOptions.appendChild(btn);
            });
        }

        function checkAnswer(btn, isCorrect) {
            if (isCorrect) {
                stopTimer();
                btn.classList.add('correct');
                elOptions.classList.add('disabled-area');

                if (attempts === 0) {
                    let timeBonus = Math.max(2, 10 - Math.floor(seconds / 2)); 
                    score += timeBonus;
                    updateStatus();
                    setTimeout(() => { nextQuestion(); }, 500);
                } else {
                    elNextBtn.style.display = 'block';
                }
            } else {
                btn.classList.add('wrong');
                btn.disabled = true;

                if (attempts === 0) {
                    attempts = 1;
                    elQHint.style.display = 'block';
                    const currentData = quizList[currentIdx];
                    if(!wrongAnswers.includes(currentData)) {
                        wrongAnswers.push(currentData);
                    }
                } else {
                    stopTimer();
                    elOptions.classList.add('disabled-area');
                    const correctTxt = quizList[currentIdx].m;
                    const allBtns = elOptions.querySelectorAll('.opt-btn');
                    allBtns.forEach(b => {
                        if (b.innerText === correctTxt) b.classList.add('correct');
                    });
                    elNextBtn.style.display = 'block';
                }
            }
        }

        function startTimer() {
            seconds = 0;
            elTimer.innerText = "0s";
            timerInterval = setInterval(() => {
                seconds++;
                elTimer.innerText = seconds + "s";
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function resetTimer() {
            stopTimer();
            seconds = 0;
            elTimer.innerText = "0s";
        }

        function updateStatus() {
            elQCount.innerText = `${currentIdx + 1} / ${quizList.length}`;
            elLiveScore.innerText = score;
        }

        function nextQuestion() {
            currentIdx++;
            loadQuestion();
        }

        function speak() {
            if (!('speechSynthesis' in window)) return;
            const data = quizList[currentIdx];
            const text = data.q; 
            const utt = new SpeechSynthesisUtterance(text);
            utt.lang = 'ja-JP';
            utt.rate = 0.9;
            const voices = window.speechSynthesis.getVoices();
            const jaVoice = voices.find(v => v.lang.includes('ja') || v.lang.includes('JP'));
            if (jaVoice) utt.voice = jaVoice;
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utt);
        }
        
        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = function() { window.speechSynthesis.getVoices(); };
        }

        function finishGame() {
            stopTimer();
            elFinalScore.innerText = score;
            elMaxScore.innerText = maxPossibleScore;

            elWrongList.innerHTML = '';
            if (wrongAnswers.length === 0) {
                elWrongHeader.innerText = "âœ… í‹€ë¦° ë‹¨ì–´ ì—†ìŒ";
                elWrongList.innerHTML = '<div style="padding:10px; text-align:center;">ğŸ‰ ì™„ë²½í•©ë‹ˆë‹¤! í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                elWrongHeader.innerText = `âŒ í‹€ë¦° ë‹¨ì–´ (ì´ ${wrongAnswers.length}ê°œ)`;
                wrongAnswers.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'review-item';
                    div.innerHTML = `
                        <div class="review-word">${item.q} (${item.y})</div>
                        <div class="review-mean">${item.m}</div>
                        <div style="font-size:12px; color:#999; margin-top:2px;">${item.tr}</div>
                    `;
                    elWrongList.appendChild(div);
                });
            }
            elResult.style.display = 'flex';
        }

        window.JpN4_2 = { setSize, changeSet, initGame, nextQuestion, speak };
        initGame();
    })();
    </script>
</body>
</html>

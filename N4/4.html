<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT N4 ë‹¨ì–´ í€´ì¦ˆ 4 (í•„ìˆ˜ í•œì)</title>
    
    <style>
        /* --- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .back-link {
            display: inline-block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #064e3b;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .back-link:hover { background-color: #10b981; transform: translateY(-2px); }
        .top-bar { text-align: center; background-color: #f0fdf4; padding-top: 10px; }

        /* --- ê¸°ì¡´ ìˆ˜í›ˆë‹˜ CSS ì½”ë“œ --- */
        /* N4 4íƒ„ ì „ìš© ìŠ¤íƒ€ì¼ (Unique ID: jp-n4-4) */
        #jp-n4-4-wrapper {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: #f0fdf4;
            color: #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center; /* ì˜¤íƒ€ ìˆ˜ì •ë¨ */
            padding: 10px; border-radius: 10px; margin: 0 auto 30px auto; position: relative;
            --max-width: 650px;
            --primary-color: #10b981;
            --dark-color: #064e3b;
            --accent-color: #f59e0b;
            
            /* [ë³´í†µ] ì‚¬ì´ì¦ˆ */
            --q-size: 40px; --ex-size: 20px; --opt-size: 20px; --ruby-size: 18px; --card-pad: 25px; --btn-pad: 14px;
        }

        #jp-n4-4-wrapper.size-small { --q-size: 24px; --ex-size: 14px; --opt-size: 15px; --ruby-size: 12px; --card-pad: 15px; --btn-pad: 10px; }
        #jp-n4-4-wrapper.size-large { --q-size: 52px; --ex-size: 26px; --opt-size: 26px; --ruby-size: 24px; --card-pad: 32px; --btn-pad: 18px; }

        #jp-n4-4-wrapper .quiz-container {
            background-color: #ffffff; padding: 20px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2); text-align: center;
            width: 100%; max-width: var(--max-width); position: relative; border: 2px solid var(--primary-color);
            box-sizing: border-box;
        }

        .control-panel { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; background: #ecfdf5; padding: 8px 12px; border-radius: 10px; }
        .set-group { display: flex; flex-wrap: wrap; gap: 4px; }
        .set-btn { background: #fff; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; cursor: pointer; }
        .set-btn.active { background: var(--primary-color); color: white; }
        .set-btn-all { border-color: var(--accent-color); color: #d97706; }
        .set-btn-all.active { background: var(--accent-color); color: white; }
        .size-group { display: flex; gap: 2px; }
        .size-btn { background: #e5e7eb; border: none; padding: 4px 8px; font-size: 11px; border-radius: 4px; cursor: pointer; }
        .size-btn.active { background: #374151; color: white; }

        .status-bar { display: flex; justify-content: space-between; align-items: center; background: #374151; color: white; padding: 8px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 14px; font-weight: bold; }
        .status-item { display: flex; align-items: center; gap: 5px; }
        .timer-icon { color: var(--accent-color); }
        .score-box { color: #10b981; }

        .question-card { padding: var(--card-pad); margin-bottom: 15px; border-bottom: 1px dashed #d1fae5; }
        .word-row { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }
        ruby { font-size: var(--q-size); font-weight: bold; color: var(--dark-color); line-height: 1.5; font-family: "MS Mincho", "Yu Mincho", serif;} /* í•œìëŠ” ëª…ì¡°ì²´ë¡œ ì¡°ê¸ˆ ë” ë©‹ì§€ê²Œ (ì„ íƒì‚¬í•­) */
        rt { font-size: var(--ruby-size); color: #059669; font-weight: normal; font-family: 'Malgun Gothic', sans-serif;}
        .audio-btn { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; }
        .audio-btn:active { transform: scale(0.9); }
        .audio-btn:hover { background: #e5e7eb; }

        .example-box { background: #f9fafb; padding: 15px; border-radius: 8px; font-size: var(--ex-size); color: #4b5563; line-height: 1.6; text-align: left; }
        .highlight { color: #d97706; font-weight: bold; background: #fef3c7; padding: 0 4px; border-radius: 4px; }
        .hint-box { display: none; margin-top: 10px; font-size: calc(var(--ex-size) - 1px); color: #059669; font-weight: bold; animation: fadeIn 0.3s; border-top: 1px solid #e5e7eb; padding-top: 8px; }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt-btn { background-color: #f9fafb; border: 1px solid #e5e7eb; color: #374151; padding: var(--btn-pad); font-size: var(--opt-size); border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.1s; }
        .opt-btn:hover { background-color: #ecfdf5; border-color: var(--primary-color); }
        .opt-btn.correct { background-color: #10b981 !important; color: white !important; border-color: #10b981; }
        .opt-btn.wrong { background-color: #ef4444 !important; color: white !important; border-color: #ef4444; opacity: 0.6; }
        .opt-btn:disabled { cursor: not-allowed; opacity: 0.7; }

        .next-btn { display: none; width: 100%; margin-top: 20px; padding: 15px; background-color: var(--primary-color); color: white; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; animation: fadeIn 0.3s; }
        .next-btn:hover { background-color: #059669; }

        #resultScreen_4 { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.99); border-radius: 15px; flex-direction: column; align-items: center; justify-content: center; z-index: 50; padding: 20px; box-sizing: border-box; }
        .review-list { width: 100%; max-height: 200px; overflow-y: auto; background: #f3f4f6; border-radius: 8px; padding: 10px; margin: 15px 0; text-align: left; }
        .review-item { border-bottom: 1px solid #e5e7eb; padding: 8px 0; font-size: 14px; }
        .review-item:last-child { border-bottom: none; }
        .review-word { font-weight: bold; color: var(--dark-color); }
        .review-mean { color: #4b5563; }

        .disabled-area { pointer-events: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body style="background-color: #f0fdf4; margin: 0; padding: 0;">

    <div class="top-bar">
        <a href="../index.html" class="back-link">ğŸ”™ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div id="jp-n4-4-wrapper">
        <div class="quiz-container">
            <div class="control-panel">
                <div class="set-group">
                    <button class="set-btn active" onclick="JpN4_4.changeSet(0)">Set 1</button>
                    <button class="set-btn" onclick="JpN4_4.changeSet(1)">Set 2</button>
                    <button class="set-btn" onclick="JpN4_4.changeSet(2)">Set 3</button>
                    <button class="set-btn" onclick="JpN4_4.changeSet(3)">Set 4</button>
                    <button class="set-btn" onclick="JpN4_4.changeSet(4)">Set 5</button>
                    <button class="set-btn set-btn-all" onclick="JpN4_4.changeSet('all')">ALL</button>
                </div>
                <div class="size-group">
                    <button class="size-btn" onclick="JpN4_4.setSize('small')">ì‘ê²Œ</button>
                    <button class="size-btn active" onclick="JpN4_4.setSize('medium')" id="btnSizeM">ë³´í†µ</button>
                    <button class="size-btn" onclick="JpN4_4.setSize('large')">í¬ê²Œ</button>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-item"><span>ğŸ“</span><span id="qCount_4">1 / 20</span></div>
                <div class="status-item"><span class="timer-icon">â±ï¸</span><span id="timerDisplay_4">0s</span></div>
                <div class="status-item score-box"><span>ğŸ†</span><span id="liveScore_4">0</span></div>
            </div>

            <div class="question-card">
                <div class="word-row">
                    <div id="qWord_4"><ruby>å˜èª<rt>ãŸã‚“ã”</rt></ruby></div>
                    <button class="audio-btn" onclick="JpN4_4.speak()" title="ë“£ê¸°">ğŸ”Š</button>
                </div>
                <div class="example-box">
                    <span id="qExample_4">...</span>
                    <div class="hint-box" id="qHint_4">...</div>
                </div>
            </div>

            <div class="options-grid" id="qOptions_4"></div>

            <button id="btnNext_4" class="next-btn" onclick="JpN4_4.nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â–¶</button>

            <div id="resultScreen_4">
                <h2 style="color:#064e3b; margin:0 0 10px 0;">ê²°ê³¼ ë¦¬í¬íŠ¸</h2>
                <div style="font-size:36px; font-weight:bold; color:#10b981; margin-bottom:5px;"><span id="finalScore_4">0</span>ì </div>
                <div style="font-size:14px; color:#6b7280; margin-bottom:15px;">(ì´ì  <span id="maxScore_4">0</span>ì  ì¤‘)</div>
                <div id="wrongListHeader_4" style="width:100%; text-align:left; font-size:14px; font-weight:bold; color:#333; margin-bottom:5px;">âŒ í‹€ë¦° í•œì</div>
                <div class="review-list" id="wrongList_4"></div>
                <button class="next-btn" style="display:block; width:auto; padding:10px 30px;" onclick="JpN4_4.initGame()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
    (function() {
        // N4 4íƒ„ ë°ì´í„°: í•„ìˆ˜ í•œì 100ê°œ
        // m: ëœ»/ìŒë…/í›ˆë…
        const dataPool = [
            // Set 1: ìƒí™œ, ìŒì‹, ì‚¬ëŒ
            {q:"é£¯", y:"ã¯ã‚“", m:"ë°¥ (í•­)", ex:"æœã”<span class='highlight'>é£¯</span>ã‚’é£Ÿã¹ã‚‹ã€‚", tr:"ì•„ì¹¨ë°¥ì„ ë¨¹ë‹¤."},
            {q:"è‚‰", y:"ã«ã", m:"ê³ ê¸° (ìœ¡)", ex:"ç‰›<span class='highlight'>è‚‰</span>ã‚’è²·ã†ã€‚", tr:"ì†Œê³ ê¸°ë¥¼ ì‚¬ë‹¤."},
            {q:"èŒ¶", y:"ã¡ã‚ƒ", m:"ì°¨ (ë‹¤)", ex:"ãŠ<span class='highlight'>èŒ¶</span>ã‚’é£²ã¿ã¾ã™ã‹ã€‚", tr:"ì°¨ë¥¼ ë“œì‹œê² ìŠµë‹ˆê¹Œ?"},
            {q:"æ´‹", y:"ã‚ˆã†", m:"ì„œì–‘/ë°”ë‹¤ (ì–‘)", ex:"<span class='highlight'>æ´‹</span>æœã‚’ç€ã‚‹ã€‚", tr:"ì–‘ë³µ(ì˜·)ì„ ì…ë‹¤."},
            {q:"æœ", y:"ãµã", m:"ì˜· (ë³µ)", ex:"æ–°ã—ã„<span class='highlight'>æœ</span>ãŒæ¬²ã—ã„ã€‚", tr:"ìƒˆ ì˜·ì„ ê°–ê³  ì‹¶ë‹¤."},
            {q:"åº—", y:"ã¿ã›", m:"ê°€ê²Œ (ì )", ex:"ã‚ã®<span class='highlight'>åº—</span>ã¯ç¾å‘³ã—ã„ã€‚", tr:"ì € ê°€ê²ŒëŠ” ë§›ìˆë‹¤."},
            {q:"éŠ€", y:"ãã‚“", m:"ì€ (ì€)", ex:"<span class='highlight'>éŠ€</span>è¡Œã¸è¡Œãã€‚", tr:"ì€í–‰ì— ê°€ë‹¤."},
            {q:"åŒ»", y:"ã„", m:"ì˜ì‚¬ (ì˜)", ex:"<span class='highlight'>åŒ»</span>è€…ã«ãªã‚ŠãŸã„ã€‚", tr:"ì˜ì‚¬ê°€ ë˜ê³  ì‹¶ë‹¤."},
            {q:"è€…", y:"ã—ã‚ƒ", m:"ì‚¬ëŒ/ë†ˆ (ì)", ex:"è‹¥<span class='highlight'>è€…</span>ãŒé›†ã¾ã‚‹ã€‚", tr:"ì Šì€ì´ê°€ ëª¨ì´ë‹¤."},
            {q:"è–¬", y:"ãã™ã‚Š", m:"ì•½ (ì•½)", ex:"é¢¨é‚ª<span class='highlight'>è–¬</span>ã‚’é£²ã‚€ã€‚", tr:"ê°ê¸°ì•½ì„ ë¨¹ë‹¤."},
            {q:"ç—…", y:"ã³ã‚‡ã†", m:"ë³‘ (ë³‘)", ex:"<span class='highlight'>ç—…</span>é™¢ã¸è¡Œãã€‚", tr:"ë³‘ì›ì— ê°€ë‹¤."},
            {q:"é™¢", y:"ã„ã‚“", m:"ì§‘/ê¸°ê´€ (ì›)", ex:"å¤§å­¦<span class='highlight'>é™¢</span>ã§å­¦ã¶ã€‚", tr:"ëŒ€í•™ì›ì—ì„œ ë°°ìš°ë‹¤."},
            {q:"å ‚", y:"ã©ã†", m:"ì§‘ (ë‹¹)", ex:"é£Ÿ<span class='highlight'>å ‚</span>ã§é£Ÿã¹ã‚‹ã€‚", tr:"ì‹ë‹¹ì—ì„œ ë¨¹ë‹¤."},
            {q:"æ˜ ", y:"ãˆã„", m:"ë¹„ì¹˜ë‹¤ (ì˜)", ex:"<span class='highlight'>æ˜ </span>ç”»ã‚’è¦‹ã‚‹ã€‚", tr:"ì˜í™”ë¥¼ ë³´ë‹¤."},
            {q:"ç”»", y:"ãŒ", m:"ê·¸ë¦¼ (í™”)", ex:"æ¼«<span class='highlight'>ç”»</span>ã‚’èª­ã‚€ã€‚", tr:"ë§Œí™”ë¥¼ ì½ë‹¤."},
            {q:"æ­Œ", y:"ã†ãŸ", m:"ë…¸ë˜ (ê°€)", ex:"<span class='highlight'>æ­Œ</span>æ‰‹ã«ãªã‚‹ã€‚", tr:"ê°€ìˆ˜ê°€ ë˜ë‹¤."},
            {q:"éŸ³", y:"ãŠã¨", m:"ì†Œë¦¬ (ìŒ)", ex:"é›¨ã®<span class='highlight'>éŸ³</span>ãŒã™ã‚‹ã€‚", tr:"ë¹—ì†Œë¦¬ê°€ ë‚œë‹¤."},
            {q:"æ¥½", y:"ãŸã®ã—ã„", m:"ì¦ê²ë‹¤/í¸í•˜ë‹¤ (ë½)", ex:"éŸ³<span class='highlight'>æ¥½</span>ã‚’èãã€‚", tr:"ìŒì•…ì„ ë“£ë‹¤."},
            {q:"æ–™", y:"ã‚Šã‚‡ã†", m:"ì¬ë£Œ/ìš”ê¸ˆ (ë£Œ)", ex:"<span class='highlight'>æ–™</span>ç†ã‚’ä½œã‚‹ã€‚", tr:"ìš”ë¦¬ë¥¼ ë§Œë“¤ë‹¤."},
            {q:"ç†", y:"ã‚Š", m:"ë‹¤ìŠ¤ë¦¬ë‹¤ (ë¦¬)", ex:"ç„¡<span class='highlight'>ç†</span>ã‚’ã—ãªã„ã§ã€‚", tr:"ë¬´ë¦¬ë¥¼ í•˜ì§€ ë§ˆì„¸ìš”."},

            // Set 2: ìì—°, ì¥ì†Œ, ë°©í–¥
            {q:"æµ·", y:"ã†ã¿", m:"ë°”ë‹¤ (í•´)", ex:"<span class='highlight'>æµ·</span>å¤–æ—…è¡Œã«è¡Œãã€‚", tr:"í•´ì™¸ì—¬í–‰ì„ ê°€ë‹¤."},
            {q:"é‡", y:"ã®", m:"ë“¤ (ì•¼)", ex:"é‡<span class='highlight'>èœ</span>ã‚’é£Ÿã¹ã‚‹ã€‚", tr:"ì•¼ì±„ë¥¼ ë¨¹ë‹¤."},
            {q:"æ—", y:"ã¯ã‚„ã—", m:"ìˆ² (ë¦¼)", ex:"å°<span class='highlight'>æ—</span>ã•ã‚“ã¯å…ƒæ°—ã ã€‚", tr:"ì½”ë°”ì•¼ì‹œ ì”¨ëŠ” ê±´ê°•í•˜ë‹¤."},
            {q:"æ£®", y:"ã‚‚ã‚Š", m:"ìˆ²/ë¹½ë¹½í•˜ë‹¤ (ì‚¼)", ex:"<span class='highlight'>æ£®</span>ã®ä¸­ã‚’æ­©ãã€‚", tr:"ìˆ² ì†ì„ ê±·ë‹¤."},
            {q:"æ± ", y:"ã„ã‘", m:"ì—°ëª» (ì§€)", ex:"é›»<span class='highlight'>æ± </span>ã‚’è²·ã†ã€‚", tr:"ì „ì§€ë¥¼ ì‚¬ë‹¤."},
            {q:"å·", y:"ã—ã‚…ã†", m:"ê³ ì„ (ì£¼)", ex:"ä¹<span class='highlight'>å·</span>ã¸è¡Œãã€‚", tr:"ê·œìŠˆì— ê°€ë‹¤."},
            {q:"äº¬", y:"ãã‚‡ã†", m:"ì„œìš¸ (ê²½)", ex:"æ±<span class='highlight'>äº¬</span>ã«ä½ã‚€ã€‚", tr:"ë„ì¿„ì— ì‚°ë‹¤."},
            {q:"éƒ½", y:"ã¨", m:"ë„ì (ë„)", ex:"<span class='highlight'>éƒ½</span>åˆãŒæ‚ªã„ã€‚", tr:"ì‚¬ì •ì´ ì¢‹ì§€ ì•Šë‹¤."},
            {q:"çœŒ", y:"ã‘ã‚“", m:"í˜„ (í˜„)", ex:"ç§ã¯é•·é‡<span class='highlight'>çœŒ</span>å‡ºèº«ã ã€‚", tr:"ë‚˜ëŠ” ë‚˜ê°€ë…¸í˜„ ì¶œì‹ ì´ë‹¤."},
            {q:"å¸‚", y:"ã—", m:"ì‹œ/ì €ì (ì‹œ)", ex:"<span class='highlight'>å¸‚</span>å½¹æ‰€ã¸è¡Œãã€‚", tr:"ì‹œì²­ì— ê°€ë‹¤."},
            {q:"ç”º", y:"ã¾ã¡", m:"ë§ˆì„/ê±°ë¦¬ (ì •)", ex:"é™ã‹ãª<span class='highlight'>ç”º</span>ã ã€‚", tr:"ì¡°ìš©í•œ ë§ˆì„ì´ë‹¤."},
            {q:"æ‘", y:"ã‚€ã‚‰", m:"ë§ˆì„ (ì´Œ)", ex:"ç”°èˆã®<span class='highlight'>æ‘</span>ã«å¸°ã‚‹ã€‚", tr:"ì‹œê³¨ ë§ˆì„ë¡œ ëŒì•„ê°€ë‹¤."},
            {q:"æ‰€", y:"ã¨ã“ã‚", m:"ê³³/ì¥ì†Œ (ì†Œ)", ex:"ä½ã‚€<span class='highlight'>æ‰€</span>ã‚’æ¢ã™ã€‚", tr:"ì‚´ ê³³ì„ ì°¾ë‹¤."},
            {q:"å ´", y:"ã°", m:"ë§ˆë‹¹/ì¥ì†Œ (ì¥)", ex:"å·¥<span class='highlight'>å ´</span>ã§åƒãã€‚", tr:"ê³µì¥ì—ì„œ ì¼í•˜ë‹¤."},
            {q:"åœ°", y:"ã¡", m:"ë•… (ì§€)", ex:"<span class='highlight'>åœ°</span>ä¸‹é‰„ã«ä¹—ã‚‹ã€‚", tr:"ì§€í•˜ì² ì„ íƒ€ë‹¤."},
            {q:"å›³", y:"ãš", m:"ê·¸ë¦¼ (ë„)", ex:"<span class='highlight'>å›³</span>æ›¸é¤¨ã¸è¡Œãã€‚", tr:"ë„ì„œê´€ì— ê°€ë‹¤."},
            {q:"é¤¨", y:"ã‹ã‚“", m:"ì§‘ (ê´€)", ex:"æ˜ ç”»<span class='highlight'>é¤¨</span>ã§è¦‹ã‚‹ã€‚", tr:"ì˜í™”ê´€ì—ì„œ ë³´ë‹¤."},
            {q:"å®¤", y:"ã—ã¤", m:"ë°© (ì‹¤)", ex:"æ•™<span class='highlight'>å®¤</span>ã«å…¥ã‚‹ã€‚", tr:"êµì‹¤ì— ë“¤ì–´ê°€ë‹¤."},
            {q:"å±‹", y:"ã‚„", m:"ì§‘ (ì˜¥)", ex:"éƒ¨å±‹ã®<span class='highlight'>å±‹</span>ä¸Šã€‚", tr:"ë°©ì˜ ì˜¥ìƒ."},
            {q:"å·¥", y:"ã“ã†", m:"ì¥ì¸ (ê³µ)", ex:"<span class='highlight'>å·¥</span>æ¥­ãŒç››ã‚“ã ã€‚", tr:"ê³µì—…ì´ ì„±í•˜ë‹¤."},

            // Set 3: ë™ì‘, í–‰ìœ„
            {q:"å»º", y:"ãŸã¦ã‚‹", m:"ì„¸ìš°ë‹¤ (ê±´)", ex:"<span class='highlight'>å»º</span>ç‰©ã‚’å»ºã¦ã‚‹ã€‚", tr:"ê±´ë¬¼ì„ ì„¸ìš°ë‹¤."},
            {q:"è²¸", y:"ã‹ã™", m:"ë¹Œë ¤ì£¼ë‹¤ (ëŒ€)", ex:"æœ¬ã‚’<span class='highlight'>è²¸</span>ã—ã¦ã€‚", tr:"ì±…ì„ ë¹Œë ¤ì¤˜."},
            {q:"å€Ÿ", y:"ã‹ã‚Šã‚‹", m:"ë¹Œë¦¬ë‹¤ (ì°¨)", ex:"ãŠé‡‘ã‚’<span class='highlight'>å€Ÿ</span>ã‚Šã‚‹ã€‚", tr:"ëˆì„ ë¹Œë¦¬ë‹¤."},
            {q:"é€", y:"ãŠãã‚‹", m:"ë³´ë‚´ë‹¤ (ì†¡)", ex:"æ‰‹ç´™ã‚’<span class='highlight'>é€</span>ã‚‹ã€‚", tr:"í¸ì§€ë¥¼ ë³´ë‚´ë‹¤."},
            {q:"å¾…", y:"ã¾ã¤", m:"ê¸°ë‹¤ë¦¬ë‹¤ (ëŒ€)", ex:"å½¼ã‚’<span class='highlight'>å¾…</span>ã¤ã€‚", tr:"ê·¸ë¥¼ ê¸°ë‹¤ë¦¬ë‹¤."},
            {q:"æ­¢", y:"ã¨ã¾ã‚‹", m:"ë©ˆì¶”ë‹¤ (ì§€)", ex:"è»ŠãŒ<span class='highlight'>æ­¢</span>ã¾ã‚‹ã€‚", tr:"ì°¨ê°€ ë©ˆì¶”ë‹¤."},
            {q:"æ­©", y:"ã‚ã‚‹ã", m:"ê±·ë‹¤ (ë³´)", ex:"æ•£<span class='highlight'>æ­©</span>ã™ã‚‹ã€‚", tr:"ì‚°ì±…í•˜ë‹¤."},
            {q:"èµ°", y:"ã¯ã—ã‚‹", m:"ë‹¬ë¦¬ë‹¤ (ì£¼)", ex:"å»Šä¸‹ã‚’<span class='highlight'>èµ°</span>ã‚‹ãªã€‚", tr:"ë³µë„ë¥¼ ë‹¬ë¦¬ì§€ ë§ˆë¼."},
            {q:"èµ·", y:"ãŠãã‚‹", m:"ì¼ì–´ë‚˜ë‹¤ (ê¸°)", ex:"æ—©<span class='highlight'>èµ·</span>ãã™ã‚‹ã€‚", tr:"ì¼ì° ì¼ì–´ë‚˜ë‹¤."},
            {q:"å¯", y:"ã­ã‚‹", m:"ìë‹¤ (ì¹¨)", ex:"<span class='highlight'>å¯</span>åŠã—ãŸã€‚", tr:"ëŠ¦ì  ì¤ë‹¤."},
            {q:"å§‹", y:"ã¯ã˜ã¾ã‚‹", m:"ì‹œì‘í•˜ë‹¤ (ì‹œ)", ex:"æˆæ¥­ãŒ<span class='highlight'>å§‹</span>ã¾ã‚‹ã€‚", tr:"ìˆ˜ì—…ì´ ì‹œì‘ëœë‹¤."},
            {q:"çµ‚", y:"ãŠã‚ã‚‹", m:"ëë‚˜ë‹¤ (ì¢…)", ex:"ä»•äº‹ãŒ<span class='highlight'>çµ‚</span>ã‚ã‚‹ã€‚", tr:"ì¼ì´ ëë‚˜ë‹¤."},
            {q:"å‹‰", y:"ã¹ã‚“", m:"í˜ì“°ë‹¤ (ë©´)", ex:"<span class='highlight'>å‹‰</span>å¼·ã™ã‚‹ã€‚", tr:"ê³µë¶€í•˜ë‹¤."},
            {q:"å¼·", y:"ãã‚‡ã†", m:"ê°•í•˜ë‹¤ (ê°•)", ex:"<span class='highlight'>å¼·</span>ã„é¢¨ã€‚", tr:"ê°•í•œ ë°”ëŒ."},
            {q:"åƒ", y:"ã¯ãŸã‚‰ã", m:"ì¼í•˜ë‹¤ (ë™)", ex:"ä¼šç¤¾ã§<span class='highlight'>åƒ</span>ãã€‚", tr:"íšŒì‚¬ì—ì„œ ì¼í•˜ë‹¤."},
            {q:"ä½œ", y:"ã¤ãã‚‹", m:"ë§Œë“¤ë‹¤ (ì‘)", ex:"ä½œ<span class='highlight'>æ–‡</span>ã‚’æ›¸ãã€‚", tr:"ì‘ë¬¸ì„ ì“°ë‹¤."},
            {q:"ä½¿", y:"ã¤ã‹ã†", m:"ì“°ë‹¤ (ì‚¬)", ex:"å¤§<span class='highlight'>ä½¿</span>é¤¨ã¸è¡Œãã€‚", tr:"ëŒ€ì‚¬ê´€ì— ê°€ë‹¤."},
            {q:"åˆ‡", y:"ãã‚‹", m:"ìë¥´ë‹¤ (ì ˆ)", ex:"å¤§<span class='highlight'>åˆ‡</span>ãªå‹é”ã€‚", tr:"ì†Œì¤‘í•œ ì¹œêµ¬."},
            {q:"å£²", y:"ã†ã‚‹", m:"íŒ”ë‹¤ (ë§¤)", ex:"<span class='highlight'>å£²</span>ã‚Šå ´ã¯ã©ã“ï¼Ÿ", tr:"ë§¤ì¥ì€ ì–´ë””ì•¼?"},
            {q:"é‹", y:"ã¯ã“ã¶", m:"ì˜®ê¸°ë‹¤ (ìš´)", ex:"<span class='highlight'>é‹</span>å‹•ã‚’ã™ã‚‹ã€‚", tr:"ìš´ë™ì„ í•˜ë‹¤."},

            // Set 4: ì¶”ìƒ, ì‚¬íšŒ, ìƒê°
            {q:"ä¸–", y:"ã›", m:"ì„¸ìƒ (ì„¸)", ex:"<span class='highlight'>ä¸–</span>ç•Œä¸­ã‚’æ—…ã™ã‚‹ã€‚", tr:"ì „ ì„¸ê³„ë¥¼ ì—¬í–‰í•˜ë‹¤."},
            {q:"ç•Œ", y:"ã‹ã„", m:"ì§€ê²½ (ê³„)", ex:"èŠ¸èƒ½<span class='highlight'>ç•Œ</span>ã«å…¥ã‚‹ã€‚", tr:"ì—°ì˜ˆê³„ì— ë“¤ì–´ê°€ë‹¤."},
            {q:"ä»•", y:"ã—", m:"ì„¬ê¸°ë‹¤ (ì‚¬)", ex:"<span class='highlight'>ä»•</span>äº‹ã‚’æ¢ã™ã€‚", tr:"ì¼ì„ ì°¾ë‹¤."},
            {q:"äº‹", y:"ã“ã¨", m:"ì¼ (ì‚¬)", ex:"ç«<span class='highlight'>äº‹</span>ãŒèµ·ãã‚‹ã€‚", tr:"í™”ì¬ê°€ ë°œìƒí•˜ë‹¤."},
            {q:"æ„", y:"ã„", m:"ëœ» (ì˜)", ex:"<span class='highlight'>æ„</span>å‘³ã‚’èª¿ã¹ã‚‹ã€‚", tr:"ì˜ë¯¸ë¥¼ ì¡°ì‚¬í•˜ë‹¤."},
            {q:"å‘³", y:"ã‚ã˜", m:"ë§› (ë¯¸)", ex:"è¶£<span class='highlight'>å‘³</span>ã¯ä½•ã§ã™ã‹ã€‚", tr:"ì·¨ë¯¸ëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ?"},
            {q:"è³ª", y:"ã—ã¤", m:"ë°”íƒ• (ì§ˆ)", ex:"<span class='highlight'>è³ª</span>å•ãŒã‚ã‚‹ã€‚", tr:"ì§ˆë¬¸ì´ ìˆë‹¤."},
            {q:"å•", y:"ã‚‚ã‚“", m:"ë¬»ë‹¤ (ë¬¸)", ex:"å•<span class='highlight'>é¡Œ</span>ã‚’è§£ãã€‚", tr:"ë¬¸ì œë¥¼ í’€ë‹¤."},
            {q:"é¡Œ", y:"ã ã„", m:"ì œëª© (ì œ)", ex:"å®¿<span class='highlight'>é¡Œ</span>ã‚’ã™ã‚‹ã€‚", tr:"ìˆ™ì œë¥¼ í•˜ë‹¤."},
            {q:"ç¿’", y:"ãªã‚‰ã†", m:"ìµíˆë‹¤ (ìŠµ)", ex:"ç·´<span class='highlight'>ç¿’</span>ã™ã‚‹ã€‚", tr:"ì—°ìŠµí•˜ë‹¤."},
            {q:"ç ”", y:"ã‘ã‚“", m:"ê°ˆë‹¤ (ì—°)", ex:"<span class='highlight'>ç ”</span>ç©¶å®¤ã«ã„ã‚‹ã€‚", tr:"ì—°êµ¬ì‹¤ì— ìˆë‹¤."},
            {q:"ç©¶", y:"ãã‚…ã†", m:"ì—°êµ¬í•˜ë‹¤ (êµ¬)", ex:"<span class='highlight'>ç©¶</span>æ˜ã™ã‚‹ã€‚", tr:"ê·œëª…í•˜ë‹¤."},
            {q:"è©¦", y:"ã—", m:"ì‹œí—˜í•˜ë‹¤ (ì‹œ)", ex:"<span class='highlight'>è©¦</span>åˆã«å‡ºã‚‹ã€‚", tr:"ì‹œí•©ì— ë‚˜ê°€ë‹¤."},
            {q:"é¨“", y:"ã‘ã‚“", m:"ì‹œí—˜í•˜ë‹¤ (í—˜)", ex:"çµŒ<span class='highlight'>é¨“</span>ãŒã‚ã‚‹ã€‚", tr:"ê²½í—˜ì´ ìˆë‹¤."},
            {q:"æ°‘", y:"ã¿ã‚“", m:"ë°±ì„± (ë¯¼)", ex:"å¸‚<span class='highlight'>æ°‘</span>ãƒ—ãƒ¼ãƒ«ã€‚", tr:"ì‹œë¯¼ ìˆ˜ì˜ì¥."},
            {q:"æ³¨", y:"ã¡ã‚…ã†", m:"ë¶“ë‹¤ (ì£¼)", ex:"<span class='highlight'>æ³¨</span>æ„ã™ã‚‹ã€‚", tr:"ì£¼ì˜í•˜ë‹¤."},
            {q:"ç™º", y:"ã¯ã¤", m:"í”¼ë‹¤ (ë°œ)", ex:"<span class='highlight'>ç™º</span>éŸ³ãŒã„ã„ã€‚", tr:"ë°œìŒì´ ì¢‹ë‹¤."},
            {q:"ç‰¹", y:"ã¨ã", m:"íŠ¹ë³„í•˜ë‹¤ (íŠ¹)", ex:"<span class='highlight'>ç‰¹</span>æ€¥ã«ä¹—ã‚‹ã€‚", tr:"íŠ¹ê¸‰(ì—´ì°¨)ì„ íƒ€ë‹¤."},
            {q:"åˆ¥", y:"ã¹ã¤", m:"ë‚˜ëˆ„ë‹¤ (ë³„)", ex:"ç‰¹<span class='highlight'>åˆ¥</span>ãªæ—¥ã€‚", tr:"íŠ¹ë³„í•œ ë‚ ."},
            {q:"æ€¥", y:"ã„ãã", m:"ê¸‰í•˜ë‹¤ (ê¸‰)", ex:"<span class='highlight'>æ€¥</span>è¡Œé›»è»Šã€‚", tr:"ê¸‰í–‰ì—´ì°¨."},

            // Set 5: í˜•ìš©ì‚¬, ìƒíƒœ, ê¸°íƒ€
            {q:"åºƒ", y:"ã²ã‚ã„", m:"ë„“ë‹¤ (ê´‘)", ex:"<span class='highlight'>åºƒ</span>å‘Šã‚’è¦‹ã‚‹ã€‚", tr:"ê´‘ê³ ë¥¼ ë³´ë‹¤."},
            {q:"æ‚ª", y:"ã‚ã‚‹ã„", m:"ë‚˜ì˜ë‹¤ (ì•…)", ex:"<span class='highlight'>æ‚ª</span>å£ã‚’è¨€ã†ãªã€‚", tr:"ìš•ì„ í•˜ì§€ ë§ˆë¼."},
            {q:"æš—", y:"ãã‚‰ã„", m:"ì–´ë‘¡ë‹¤ (ì•”)", ex:"éƒ¨å±‹ãŒ<span class='highlight'>æš—</span>ã„ã€‚", tr:"ë°©ì´ ì–´ë‘¡ë‹¤."},
            {q:"æ—©", y:"ã¯ã‚„ã„", m:"ì´ë¥´ë‹¤ (ì¡°)", ex:"<span class='highlight'>æ—©</span>æœã«èµ·ãã‚‹ã€‚", tr:"ì¡°ì¡°(ì´ë¥¸ ì•„ì¹¨)ì— ì¼ì–´ë‚˜ë‹¤."},
            {q:"é€Ÿ", y:"ã¯ã‚„ã„", m:"ë¹ ë¥´ë‹¤ (ì†)", ex:"<span class='highlight'>é€Ÿ</span>åº¦ã‚’è½ã¨ã™ã€‚", tr:"ì†ë„ë¥¼ ì¤„ì´ë‹¤."},
            {q:"ä½", y:"ã²ãã„", m:"ë‚®ë‹¤ (ì €)", ex:"æœ€<span class='highlight'>ä½</span>æ°—æ¸©ã€‚", tr:"ìµœì € ê¸°ì˜¨."},
            {q:"çŸ­", y:"ã¿ã˜ã‹ã„", m:"ì§§ë‹¤ (ë‹¨)", ex:"<span class='highlight'>çŸ­</span>æ™‚é–“ã§çµ‚ã‚ã‚‹ã€‚", tr:"ë‹¨ì‹œê°„ì— ëë‚˜ë‹¤."},
            {q:"è»½", y:"ã‹ã‚‹ã„", m:"ê°€ë³ë‹¤ (ê²½)", ex:"<span class='highlight'>è»½</span>é£Ÿã‚’ã¨ã‚‹ã€‚", tr:"ê°€ë²¼ìš´ ì‹ì‚¬ë¥¼ í•˜ë‹¤."},
            {q:"é‡", y:"ãŠã‚‚ã„", m:"ë¬´ê²ë‹¤ (ì¤‘)", ex:"ä½“<span class='highlight'>é‡</span>ã‚’æ¸¬ã‚‹ã€‚", tr:"ì²´ì¤‘ì„ ì¬ë‹¤."},
            {q:"å¯’", y:"ã•ã‚€ã„", m:"ì¶¥ë‹¤ (í•œ)", ex:"<span class='highlight'>å¯’</span>æ°—ãŒã™ã‚‹ã€‚", tr:"ì˜¤í•œì´ ë“ ë‹¤."},
            {q:"æš‘", y:"ã‚ã¤ã„", m:"ë¥ë‹¤ (ì„œ)", ex:"ä»Šå¹´ã®<span class='highlight'>æš‘</span>ã•ã¯ç•°å¸¸ã ã€‚", tr:"ì˜¬í•´ì˜ ë”ìœ„ëŠ” ì´ìƒí•˜ë‹¤."},
            {q:"èµ¤", y:"ã‚ã‹", m:"ë¶‰ë‹¤ (ì )", ex:"<span class='highlight'>èµ¤</span>ã¡ã‚ƒã‚“ãŒæ³£ãã€‚", tr:"ì•„ê¸°ê°€ ìš´ë‹¤."},
            {q:"é’", y:"ã‚ãŠ", m:"í‘¸ë¥´ë‹¤ (ì²­)", ex:"<span class='highlight'>é’</span>ç©ºãŒåºƒãŒã‚‹ã€‚", tr:"í‘¸ë¥¸ í•˜ëŠ˜ì´ í¼ì³ì§€ë‹¤."},
            {q:"é»’", y:"ãã‚", m:"ê²€ë‹¤ (í‘)", ex:"<span class='highlight'>é»’</span>æ¿ã‚’æ¶ˆã™ã€‚", tr:"ì¹ íŒì„ ì§€ìš°ë‹¤."},
            {q:"è‰²", y:"ã„ã‚", m:"ìƒ‰ (ìƒ‰)", ex:"æ™¯<span class='highlight'>è‰²</span>ãŒã„ã„ã€‚", tr:"ê²½ì¹˜ê°€ ì¢‹ë‹¤."},
            {q:"æ—…", y:"ãŸã³", m:"ì—¬í–‰ (ì—¬)", ex:"<span class='highlight'>æ—…</span>è¡Œã®è¨ˆç”»ã€‚", tr:"ì—¬í–‰ ê³„íš."},
            {q:"é€š", y:"ã¨ãŠã‚‹", m:"í†µí•˜ë‹¤ (í†µ)", ex:"äº¤<span class='highlight'>é€š</span>äº‹æ•…ã€‚", tr:"êµí†µì‚¬ê³ ."},
            {q:"è¦ª", y:"ãŠã‚„", m:"ì¹œí•˜ë‹¤/ë¶€ëª¨ (ì¹œ)", ex:"<span class='highlight'>è¦ª</span>åˆ‡ã«ã™ã‚‹ã€‚", tr:"ì¹œì ˆí•˜ê²Œ í•˜ë‹¤."},
            {q:"æ—", y:"ãã", m:"ê²¨ë ˆ (ì¡±)", ex:"å®¶<span class='highlight'>æ—</span>ã¨ä½ã‚€ã€‚", tr:"ê°€ì¡±ê³¼ ì‚´ë‹¤."},
            {q:"ç§", y:"ã‚ãŸã—", m:"ë‚˜ (ì‚¬)", ex:"<span class='highlight'>ç§</span>é‰„ã«ä¹—ã‚‹ã€‚", tr:"ì‚¬ì² (ë¯¼ì˜ ì „ì² )ì„ íƒ€ë‹¤."}
        ];

        let quizList = [];
        let currentIdx = 0;
        let score = 0;
        let attempts = 0;
        let currentMode = 0;
        let timerInterval = null;
        let seconds = 0;
        let wrongAnswers = []; 
        let maxPossibleScore = 0;

        const wrapper = document.getElementById('jp-n4-4-wrapper');
        const elQWord = document.getElementById('qWord_4');
        const elQExample = document.getElementById('qExample_4');
        const elQHint = document.getElementById('qHint_4');
        const elOptions = document.getElementById('qOptions_4');
        const elNextBtn = document.getElementById('btnNext_4');
        const elResult = document.getElementById('resultScreen_4');
        const elFinalScore = document.getElementById('finalScore_4');
        const elMaxScore = document.getElementById('maxScore_4');
        const elWrongList = document.getElementById('wrongList_4');
        const elWrongHeader = document.getElementById('wrongListHeader_4');
        const elQCount = document.getElementById('qCount_4');
        const elTimer = document.getElementById('timerDisplay_4');
        const elLiveScore = document.getElementById('liveScore_4');

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function setSize(size) {
            wrapper.classList.remove('size-small', 'size-large');
            const btns = wrapper.querySelectorAll('.size-btn');
            btns.forEach(b => b.classList.remove('active'));
            if (size === 'small') { wrapper.classList.add('size-small'); btns[0].classList.add('active'); }
            else if (size === 'large') { wrapper.classList.add('size-large'); btns[2].classList.add('active'); }
            else { btns[1].classList.add('active'); }
        }

        function changeSet(mode) {
            currentMode = mode;
            const btns = wrapper.querySelectorAll('.set-btn');
            btns.forEach(b => b.classList.remove('active'));
            let btnIdx = (mode === 'all') ? 5 : mode;
            btns[btnIdx].classList.add('active');
            initGame();
        }

        function initGame() {
            let targetData = [];
            if (currentMode === 'all') { targetData = shuffle([...dataPool]); }
            else {
                const start = currentMode * 20;
                const end = start + 20;
                targetData = shuffle(dataPool.slice(start, end));
            }
            quizList = targetData;
            currentIdx = 0; score = 0; wrongAnswers = []; maxPossibleScore = quizList.length * 10;
            elResult.style.display = 'none';
            updateStatus(); loadQuestion();
        }

        function loadQuestion() {
            if (currentIdx >= quizList.length) { finishGame(); return; }
            const data = quizList[currentIdx];
            attempts = 0; 
            resetTimer(); startTimer(); updateStatus();

            elQWord.innerHTML = `<ruby>${data.q}<rt>${data.y}</rt></ruby>`;
            elQExample.innerHTML = data.ex;
            elQHint.style.display = 'none';
            elQHint.innerText = `ğŸ’¡ í•´ì„: ${data.tr}`;
            elNextBtn.style.display = 'none';
            elOptions.innerHTML = '';
            elOptions.classList.remove('disabled-area');

            let opts = [{txt: data.m, isAns: true}];
            let others = shuffle(dataPool.filter(d => d.m !== data.m)).slice(0, 3);
            others.forEach(o => opts.push({txt: o.m, isAns: false}));
            opts = shuffle(opts);

            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt.txt;
                btn.onclick = () => checkAnswer(btn, opt.isAns);
                elOptions.appendChild(btn);
            });
        }

        function checkAnswer(btn, isCorrect) {
            if (isCorrect) {
                stopTimer(); btn.classList.add('correct'); elOptions.classList.add('disabled-area');
                if (attempts === 0) {
                    let timeBonus = Math.max(2, 10 - Math.floor(seconds / 2)); 
                    score += timeBonus; updateStatus();
                    setTimeout(() => { nextQuestion(); }, 500);
                } else { elNextBtn.style.display = 'block'; }
            } else {
                btn.classList.add('wrong'); btn.disabled = true;
                if (attempts === 0) {
                    attempts = 1; elQHint.style.display = 'block';
                    const currentData = quizList[currentIdx];
                    if(!wrongAnswers.includes(currentData)) { wrongAnswers.push(currentData); }
                } else {
                    stopTimer(); elOptions.classList.add('disabled-area');
                    const correctTxt = quizList[currentIdx].m;
                    const allBtns = elOptions.querySelectorAll('.opt-btn');
                    allBtns.forEach(b => { if (b.innerText === correctTxt) b.classList.add('correct'); });
                    elNextBtn.style.display = 'block';
                }
            }
        }

        function startTimer() { seconds = 0; elTimer.innerText = "0s"; timerInterval = setInterval(() => { seconds++; elTimer.innerText = seconds + "s"; }, 1000); }
        function stopTimer() { clearInterval(timerInterval); }
        function resetTimer() { stopTimer(); seconds = 0; elTimer.innerText = "0s"; }
        function updateStatus() { elQCount.innerText = `${currentIdx + 1} / ${quizList.length}`; elLiveScore.innerText = score; }
        function nextQuestion() { currentIdx++; loadQuestion(); }

        function speak() {
            if (!('speechSynthesis' in window)) return;
            const data = quizList[currentIdx];
            const utt = new SpeechSynthesisUtterance(data.q);
            utt.lang = 'ja-JP'; utt.rate = 0.9;
            const voices = window.speechSynthesis.getVoices();
            const jaVoice = voices.find(v => v.lang.includes('ja') || v.lang.includes('JP'));
            if (jaVoice) utt.voice = jaVoice;
            window.speechSynthesis.cancel(); window.speechSynthesis.speak(utt);
        }
        if ('speechSynthesis' in window) { window.speechSynthesis.onvoiceschanged = function() { window.speechSynthesis.getVoices(); }; }

        function finishGame() {
            stopTimer();
            elFinalScore.innerText = score; elMaxScore.innerText = maxPossibleScore;
            elWrongList.innerHTML = '';
            if (wrongAnswers.length === 0) {
                elWrongHeader.innerText = "âœ… í‹€ë¦° í•œì ì—†ìŒ";
                elWrongList.innerHTML = '<div style="padding:10px; text-align:center;">ğŸ‰ ì™„ë²½í•©ë‹ˆë‹¤! í•„ìˆ˜ í•œìë¥¼ ë§ˆìŠ¤í„°í•˜ì…¨êµ°ìš”!</div>';
            } else {
                elWrongHeader.innerText = `âŒ í‹€ë¦° í•œì (ì´ ${wrongAnswers.length}ê°œ)`;
                wrongAnswers.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'review-item';
                    div.innerHTML = `<div class="review-word">${item.q} (${item.y})</div><div class="review-mean">${item.m}</div><div style="font-size:12px; color:#999; margin-top:2px;">${item.tr}</div>`;
                    elWrongList.appendChild(div);
                });
            }
            elResult.style.display = 'flex';
        }

        window.JpN4_4 = { setSize, changeSet, initGame, nextQuestion, speak };
        initGame();
    })();
    </script>
</body>
</html>

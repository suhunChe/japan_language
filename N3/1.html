<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT N3 ë‹¨ì–´ í€´ì¦ˆ 1 (ëª…ì‚¬/ë™ì‚¬)</title>
    
    <style>
        /* --- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .back-link {
            display: inline-block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #1e3a8a; /* N3 í…Œë§ˆ ë‹¤í¬ ë¸”ë£¨ */
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .back-link:hover { background-color: #2563eb; transform: translateY(-2px); }
        .top-bar { text-align: center; background-color: #eff6ff; padding-top: 10px; }

        /* --- ê¸°ì¡´ ìˆ˜í›ˆë‹˜ CSS ì½”ë“œ --- */
        /* N3 1íƒ„ ì „ìš© ìŠ¤íƒ€ì¼ (Unique ID: jp-n3-1) */
        #jp-n3-1-wrapper {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: #eff6ff; /* ì•„ì£¼ ì—°í•œ ë¸”ë£¨ ë°°ê²½ */
            color: #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center; /* ì˜¤íƒ€ ìˆ˜ì •ë¨ */
            padding: 10px; border-radius: 10px; margin: 0 auto 30px auto; position: relative; /* ì¤‘ì•™ ì •ë ¬ìš© margin ì¶”ê°€ */
            --max-width: 650px;
            --primary-color: #2563eb; /* N3 ì‹œê·¸ë‹ˆì²˜ ë¸”ë£¨ */
            --dark-color: #1e3a8a;
            --accent-color: #f59e0b; /* ê³¨ë“œ í¬ì¸íŠ¸ */
            
            /* [ë³´í†µ] ì‚¬ì´ì¦ˆ */
            --q-size: 40px; --ex-size: 18px; --opt-size: 18px; --ruby-size: 16px; --card-pad: 25px; --btn-pad: 14px;
        }

        #jp-n3-1-wrapper.size-small { --q-size: 24px; --ex-size: 14px; --opt-size: 14px; --ruby-size: 12px; --card-pad: 15px; --btn-pad: 10px; }
        #jp-n3-1-wrapper.size-large { --q-size: 52px; --ex-size: 24px; --opt-size: 24px; --ruby-size: 20px; --card-pad: 32px; --btn-pad: 18px; }

        #jp-n3-1-wrapper .quiz-container {
            background-color: #ffffff; padding: 20px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.2); text-align: center;
            width: 100%; max-width: var(--max-width); position: relative; border: 2px solid var(--primary-color);
            box-sizing: border-box;
        }

        .control-panel { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; background: #dbeafe; padding: 8px 12px; border-radius: 10px; }
        .set-group { display: flex; flex-wrap: wrap; gap: 4px; }
        .set-btn { background: #fff; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; cursor: pointer; }
        .set-btn.active { background: var(--primary-color); color: white; }
        .set-btn-all { border-color: var(--accent-color); color: #d97706; }
        .set-btn-all.active { background: var(--accent-color); color: white; }
        .size-group { display: flex; gap: 2px; }
        .size-btn { background: #e5e7eb; border: none; padding: 4px 8px; font-size: 11px; border-radius: 4px; cursor: pointer; }
        .size-btn.active { background: #1e3a8a; color: white; }

        .status-bar { display: flex; justify-content: space-between; align-items: center; background: #1e3a8a; color: white; padding: 8px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 14px; font-weight: bold; }
        .status-item { display: flex; align-items: center; gap: 5px; }
        .timer-icon { color: var(--accent-color); }
        .score-box { color: #60a5fa; }

        .question-card { padding: var(--card-pad); margin-bottom: 15px; border-bottom: 1px dashed #bfdbfe; }
        .word-row { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }
        ruby { font-size: var(--q-size); font-weight: bold; color: var(--dark-color); line-height: 1.5; }
        rt { font-size: var(--ruby-size); color: #2563eb; font-weight: normal; }
        .audio-btn { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; }
        .audio-btn:active { transform: scale(0.9); }
        .audio-btn:hover { background: #e5e7eb; }

        .example-box { background: #f8fafc; padding: 15px; border-radius: 8px; font-size: var(--ex-size); color: #475569; line-height: 1.6; text-align: left; border: 1px solid #e2e8f0; }
        .highlight { color: #d97706; font-weight: bold; background: #fef3c7; padding: 0 4px; border-radius: 4px; }
        .hint-box { display: none; margin-top: 10px; font-size: calc(var(--ex-size) - 2px); color: #2563eb; font-weight: bold; animation: fadeIn 0.3s; border-top: 1px solid #e2e8f0; padding-top: 8px; }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt-btn { background-color: #f8fafc; border: 1px solid #e2e8f0; color: #334155; padding: var(--btn-pad); font-size: var(--opt-size); border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.1s; }
        .opt-btn:hover { background-color: #dbeafe; border-color: var(--primary-color); }
        .opt-btn.correct { background-color: #2563eb !important; color: white !important; border-color: #2563eb; }
        .opt-btn.wrong { background-color: #ef4444 !important; color: white !important; border-color: #ef4444; opacity: 0.6; }
        .opt-btn:disabled { cursor: not-allowed; opacity: 0.7; }

        .next-btn { display: none; width: 100%; margin-top: 20px; padding: 15px; background-color: var(--primary-color); color: white; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; animation: fadeIn 0.3s; }
        .next-btn:hover { background-color: #1d4ed8; }

        #resultScreen_n3_1 { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.99); border-radius: 15px; flex-direction: column; align-items: center; justify-content: center; z-index: 50; padding: 20px; box-sizing: border-box; }
        .review-list { width: 100%; max-height: 200px; overflow-y: auto; background: #f1f5f9; border-radius: 8px; padding: 10px; margin: 15px 0; text-align: left; }
        .review-item { border-bottom: 1px solid #e2e8f0; padding: 8px 0; font-size: 14px; }
        .review-item:last-child { border-bottom: none; }
        .review-word { font-weight: bold; color: var(--dark-color); }
        .review-mean { color: #475569; }

        .disabled-area { pointer-events: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body style="background-color: #eff6ff; margin: 0; padding: 0;">

    <div class="top-bar">
        <a href="../index.html" class="back-link">ğŸ”™ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div id="jp-n3-1-wrapper">
        <div class="quiz-container">
            <div class="control-panel">
                <div class="set-group">
                    <button class="set-btn active" onclick="JpN3_1.changeSet(0)">Set 1</button>
                    <button class="set-btn" onclick="JpN3_1.changeSet(1)">Set 2</button>
                    <button class="set-btn" onclick="JpN3_1.changeSet(2)">Set 3</button>
                    <button class="set-btn" onclick="JpN3_1.changeSet(3)">Set 4</button>
                    <button class="set-btn" onclick="JpN3_1.changeSet(4)">Set 5</button>
                    <button class="set-btn set-btn-all" onclick="JpN3_1.changeSet('all')">ALL</button>
                </div>
                <div class="size-group">
                    <button class="size-btn" onclick="JpN3_1.setSize('small')">ì‘ê²Œ</button>
                    <button class="size-btn active" onclick="JpN3_1.setSize('medium')" id="btnSizeM">ë³´í†µ</button>
                    <button class="size-btn" onclick="JpN3_1.setSize('large')">í¬ê²Œ</button>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-item"><span>ğŸ“</span><span id="qCount_n3_1">1 / 20</span></div>
                <div class="status-item"><span class="timer-icon">â±ï¸</span><span id="timerDisplay_n3_1">0s</span></div>
                <div class="status-item score-box"><span>ğŸ†</span><span id="liveScore_n3_1">0</span></div>
            </div>

            <div class="question-card">
                <div class="word-row">
                    <div id="qWord_n3_1"><ruby>å˜èª<rt>ãŸã‚“ã”</rt></ruby></div>
                    <button class="audio-btn" onclick="JpN3_1.speak()" title="ë“£ê¸°">ğŸ”Š</button>
                </div>
                <div class="example-box">
                    <span id="qExample_n3_1">...</span>
                    <div class="hint-box" id="qHint_n3_1">...</div>
                </div>
            </div>

            <div class="options-grid" id="qOptions_n3_1"></div>

            <button id="btnNext_n3_1" class="next-btn" onclick="JpN3_1.nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â–¶</button>

            <div id="resultScreen_n3_1">
                <h2 style="color:#1e3a8a; margin:0 0 10px 0;">ê²°ê³¼ ë¦¬í¬íŠ¸</h2>
                <div style="font-size:36px; font-weight:bold; color:#2563eb; margin-bottom:5px;"><span id="finalScore_n3_1">0</span>ì </div>
                <div style="font-size:14px; color:#64748b; margin-bottom:15px;">(ì´ì  <span id="maxScore_n3_1">0</span>ì  ì¤‘)</div>
                <div id="wrongListHeader_n3_1" style="width:100%; text-align:left; font-size:14px; font-weight:bold; color:#333; margin-bottom:5px;">âŒ í‹€ë¦° ë‹¨ì–´</div>
                <div class="review-list" id="wrongList_n3_1"></div>
                <button class="next-btn" style="display:block; width:auto; padding:10px 30px;" onclick="JpN3_1.initGame()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
    (function() {
        // N3 1íƒ„ ë°ì´í„°: ëª…ì‚¬/ë™ì‚¬ 100ê°œ
        const dataPool = [
            // Set 1: ì¶”ìƒ ëª…ì‚¬ (ê°ì •, ìƒê°, íƒœë„)
            {q:"åŠªåŠ›", y:"ã©ã‚Šã‚‡ã", m:"ë…¸ë ¥", ex:"æˆåŠŸã™ã‚‹ã«ã¯<span class='highlight'>åŠªåŠ›</span>ãŒå¿…è¦ã ã€‚", tr:"ì„±ê³µí•˜ë ¤ë©´ ë…¸ë ¥ì´ í•„ìš”í•˜ë‹¤."},
            {q:"æ„›", y:"ã‚ã„", m:"ì‚¬ë‘", ex:"å®¶æ—ã¸ã®<span class='highlight'>æ„›</span>ã€‚", tr:"ê°€ì¡±ì„ í–¥í•œ ì‚¬ë‘."},
            {q:"æ„Ÿæƒ…", y:"ã‹ã‚“ã˜ã‚‡ã†", m:"ê°ì •", ex:"<span class='highlight'>æ„Ÿæƒ…</span>ã‚’è¡¨ã«å‡ºã™ã€‚", tr:"ê°ì •ì„ ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚´ë‹¤."},
            {q:"è¡¨æƒ…", y:"ã²ã‚‡ã†ã˜ã‚‡ã†", m:"í‘œì •", ex:"æš—ã„<span class='highlight'>è¡¨æƒ…</span>ã‚’ã—ã¦ã„ã‚‹ã€‚", tr:"ì–´ë‘ìš´ í‘œì •ì„ í•˜ê³  ìˆë‹¤."},
            {q:"è‹¦åŠ´", y:"ãã‚ã†", m:"ê³ ìƒ/ìˆ˜ê³ ", ex:"è‹¥ã„é ƒã«<span class='highlight'>è‹¦åŠ´</span>ã—ãŸã€‚", tr:"ì Šì€ ì‹œì ˆì— ê³ ìƒí–ˆë‹¤."},
            {q:"å¸Œæœ›", y:"ãã¼ã†", m:"í¬ë§", ex:"å°†æ¥ã®<span class='highlight'>å¸Œæœ›</span>ã‚’èªã‚‹ã€‚", tr:"ì¥ë˜ì˜ í¬ë§ì„ ì´ì•¼ê¸°í•˜ë‹¤."},
            {q:"è‡ªä¿¡", y:"ã˜ã—ã‚“", m:"ìì‹ ê°", ex:"è‡ªåˆ†ã«<span class='highlight'>è‡ªä¿¡</span>ã‚’æŒã¤ã€‚", tr:"ìì‹ ì—ê²Œ ìì‹ ê°ì„ ê°–ë‹¤."},
            {q:"å¹³å’Œ", y:"ã¸ã„ã‚", m:"í‰í™”", ex:"ä¸–ç•Œã®<span class='highlight'>å¹³å’Œ</span>ã‚’ç¥ˆã‚‹ã€‚", tr:"ì„¸ê³„ì˜ í‰í™”ë¥¼ ê¸°ë„í•˜ë‹¤."},
            {q:"ç›®çš„", y:"ã‚‚ãã¦ã", m:"ëª©ì ", ex:"äººç”Ÿã®<span class='highlight'>ç›®çš„</span>ã‚’æ¢ã™ã€‚", tr:"ì¸ìƒì˜ ëª©ì ì„ ì°¾ë‹¤."},
            {q:"ç›®æ¨™", y:"ã‚‚ãã²ã‚‡ã†", m:"ëª©í‘œ", ex:"<span class='highlight'>ç›®æ¨™</span>ã‚’é”æˆã™ã‚‹ã€‚", tr:"ëª©í‘œë¥¼ ë‹¬ì„±í•˜ë‹¤."},
            {q:"è¨˜æ†¶", y:"ããŠã", m:"ê¸°ì–µ", ex:"å­ä¾›ã®é ƒã®<span class='highlight'>è¨˜æ†¶</span>ã€‚", tr:"ì–´ë¦´ ì  ê¸°ì–µ."},
            {q:"æ„è­˜", y:"ã„ã—ã", m:"ì˜ì‹", ex:"ç’°å¢ƒå•é¡Œã‚’<span class='highlight'>æ„è­˜</span>ã™ã‚‹ã€‚", tr:"í™˜ê²½ ë¬¸ì œë¥¼ ì˜ì‹í•˜ë‹¤."},
            {q:"æ„Ÿè¦š", y:"ã‹ã‚“ã‹ã", m:"ê°ê°", ex:"ãƒãƒ©ãƒ³ã‚¹<span class='highlight'>æ„Ÿè¦š</span>ãŒã„ã„ã€‚", tr:"ê· í˜• ê°ê°ì´ ì¢‹ë‹¤."},
            {q:"æ€§æ ¼", y:"ã›ã„ã‹ã", m:"ì„±ê²©", ex:"å½¼ã¯<span class='highlight'>æ€§æ ¼</span>ãŒæ˜ã‚‹ã„ã€‚", tr:"ê·¸ëŠ” ì„±ê²©ì´ ë°ë‹¤."},
            {q:"æ…‹åº¦", y:"ãŸã„ã©", m:"íƒœë„", ex:"çœŸé¢ç›®ãª<span class='highlight'>æ…‹åº¦</span>ã§èãã€‚", tr:"ì„±ì‹¤í•œ íƒœë„ë¡œ ë“£ë‹¤."},
            {q:"å°è±¡", y:"ã„ã‚“ã—ã‚‡ã†", m:"ì¸ìƒ", ex:"ç¬¬ä¸€<span class='highlight'>å°è±¡</span>ãŒè‰¯ã„ã€‚", tr:"ì²«ì¸ìƒì´ ì¢‹ë‹¤."},
            {q:"èˆˆå‘³", y:"ãã‚‡ã†ã¿", m:"í¥ë¯¸", ex:"æ­´å²ã«<span class='highlight'>èˆˆå‘³</span>ãŒã‚ã‚‹ã€‚", tr:"ì—­ì‚¬ì— í¥ë¯¸ê°€ ìˆë‹¤."},
            {q:"ä¸æº€", y:"ãµã¾ã‚“", m:"ë¶ˆë§Œ", ex:"çµ¦æ–™ã«<span class='highlight'>ä¸æº€</span>ãŒã‚ã‚‹ã€‚", tr:"ê¸‰ë£Œ(ì›”ê¸‰)ì— ë¶ˆë§Œì´ ìˆë‹¤."},
            {q:"æº€è¶³", y:"ã¾ã‚“ãã", m:"ë§Œì¡±", ex:"çµæœã«<span class='highlight'>æº€è¶³</span>ã™ã‚‹ã€‚", tr:"ê²°ê³¼ì— ë§Œì¡±í•˜ë‹¤."},
            {q:"é–¢ä¿‚", y:"ã‹ã‚“ã‘ã„", m:"ê´€ê³„", ex:"äººé–“<span class='highlight'>é–¢ä¿‚</span>ãŒé›£ã—ã„ã€‚", tr:"ì¸ê°„ê´€ê³„ê°€ ì–´ë µë‹¤."},

            // Set 2: ì‚¬íšŒ, ê²½ì œ, ìƒí™œ
            {q:"çµŒæ¸ˆ", y:"ã‘ã„ã–ã„", m:"ê²½ì œ", ex:"å›½ã®<span class='highlight'>çµŒæ¸ˆ</span>ãŒç™ºå±•ã™ã‚‹ã€‚", tr:"ë‚˜ë¼ì˜ ê²½ì œê°€ ë°œì „í•˜ë‹¤."},
            {q:"ç”£æ¥­", y:"ã•ã‚“ãã‚‡ã†", m:"ì‚°ì—…", ex:"è‡ªå‹•è»Š<span class='highlight'>ç”£æ¥­</span>ãŒç››ã‚“ã ã€‚", tr:"ìë™ì°¨ ì‚°ì—…ì´ í™œë°œí•˜ë‹¤."},
            {q:"è²¿æ˜“", y:"ã¼ã†ãˆã", m:"ë¬´ì—­", ex:"æµ·å¤–ã¨<span class='highlight'>è²¿æ˜“</span>ã™ã‚‹ã€‚", tr:"í•´ì™¸ì™€ ë¬´ì—­í•˜ë‹¤."},
            {q:"è£½å“", y:"ã›ã„ã²ã‚“", m:"ì œí’ˆ", ex:"æ–°<span class='highlight'>è£½å“</span>ã‚’ç™ºå£²ã™ã‚‹ã€‚", tr:"ì‹ ì œí’ˆì„ ë°œë§¤í•˜ë‹¤."},
            {q:"è¾²æ¥­", y:"ã®ã†ãã‚‡ã†", m:"ë†ì—…", ex:"<span class='highlight'>è¾²æ¥­</span>ã‚’å§‹ã‚ã‚‹ã€‚", tr:"ë†ì—…ì„ ì‹œì‘í•˜ë‹¤."},
            {q:"ç§‘å­¦", y:"ã‹ãŒã", m:"ê³¼í•™", ex:"<span class='highlight'>ç§‘å­¦</span>æŠ€è¡“ã®é€²æ­©ã€‚", tr:"ê³¼í•™ ê¸°ìˆ ì˜ ì§„ë³´."},
            {q:"æŠ€è¡“", y:"ãã˜ã‚…ã¤", m:"ê¸°ìˆ ", ex:"é«˜ã„<span class='highlight'>æŠ€è¡“</span>ã‚’æŒã£ã¦ã„ã‚‹ã€‚", tr:"ë†’ì€ ê¸°ìˆ ì„ ê°€ì§€ê³  ìˆë‹¤."},
            {q:"äº‹æƒ…", y:"ã˜ã˜ã‚‡ã†", m:"ì‚¬ì •", ex:"å®¶åº­ã®<span class='highlight'>äº‹æƒ…</span>ã§ä¼‘ã‚€ã€‚", tr:"ê°€ì • ì‚¬ì •ìœ¼ë¡œ ì‰¬ë‹¤."},
            {q:"äº‹æ•…", y:"ã˜ã“", m:"ì‚¬ê³ ", ex:"äº¤é€š<span class='highlight'>äº‹æ•…</span>ã«é­ã†ã€‚", tr:"êµí†µì‚¬ê³ ë¥¼ ë‹¹í•˜ë‹¤."},
            {q:"äº‹ä»¶", y:"ã˜ã‘ã‚“", m:"ì‚¬ê±´", ex:"ä¸æ€è­°ãª<span class='highlight'>äº‹ä»¶</span>ãŒèµ·ããŸã€‚", tr:"ë¶ˆê°€ì‚¬ì˜í•œ ì‚¬ê±´ì´ ì¼ì–´ë‚¬ë‹¤."},
            {q:"æ•…éšœ", y:"ã“ã—ã‚‡ã†", m:"ê³ ì¥", ex:"ãƒ‘ã‚½ã‚³ãƒ³ãŒ<span class='highlight'>æ•…éšœ</span>ã—ãŸã€‚", tr:"ì»´í“¨í„°ê°€ ê³ ì¥ ë‚¬ë‹¤."},
            {q:"ä¿®ç†", y:"ã—ã‚…ã†ã‚Š", m:"ìˆ˜ë¦¬", ex:"æ™‚è¨ˆã‚’<span class='highlight'>ä¿®ç†</span>ã«å‡ºã™ã€‚", tr:"ì‹œê³„ë¥¼ ìˆ˜ë¦¬ ë§¡ê¸°ë‹¤."},
            {q:"ç¾åœ¨", y:"ã’ã‚“ã–ã„", m:"í˜„ì¬", ex:"<span class='highlight'>ç¾åœ¨</span>ã®æ™‚åˆ»ã€‚", tr:"í˜„ì¬ ì‹œê°."},
            {q:"éå»", y:"ã‹ã“", m:"ê³¼ê±°", ex:"<span class='highlight'>éå»</span>ã‚’æŒ¯ã‚Šè¿”ã‚‹ã€‚", tr:"ê³¼ê±°ë¥¼ ë˜ëŒì•„ë³´ë‹¤."},
            {q:"æœªæ¥", y:"ã¿ã‚‰ã„", m:"ë¯¸ë˜", ex:"æ˜ã‚‹ã„<span class='highlight'>æœªæ¥</span>ã‚’ä¿¡ã˜ã‚‹ã€‚", tr:"ë°ì€ ë¯¸ë˜ë¥¼ ë¯¿ë‹¤."},
            {q:"çµæœ", y:"ã‘ã£ã‹", m:"ê²°ê³¼", ex:"è©¦é¨“ã®<span class='highlight'>çµæœ</span>ã‚’å¾…ã¤ã€‚", tr:"ì‹œí—˜ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ë‹¤."},
            {q:"åŸå› ", y:"ã’ã‚“ã„ã‚“", m:"ì›ì¸", ex:"å¤±æ•—ã®<span class='highlight'>åŸå› </span>ã‚’èª¿ã¹ã‚‹ã€‚", tr:"ì‹¤íŒ¨ì˜ ì›ì¸ì„ ì¡°ì‚¬í•˜ë‹¤."},
            {q:"ç†ç”±", y:"ã‚Šã‚†ã†", m:"ì´ìœ ", ex:"é…åˆ»ã—ãŸ<span class='highlight'>ç†ç”±</span>ã‚’è¨€ã†ã€‚", tr:"ì§€ê°í•œ ì´ìœ ë¥¼ ë§í•˜ë‹¤."},
            {q:"æ„è¦‹", y:"ã„ã‘ã‚“", m:"ì˜ê²¬", ex:"è‡ªåˆ†ã®<span class='highlight'>æ„è¦‹</span>ã‚’è¿°ã¹ã‚‹ã€‚", tr:"ìì‹ ì˜ ì˜ê²¬ì„ ë§í•˜ë‹¤."},
            {q:"æƒ…å ±", y:"ã˜ã‚‡ã†ã»ã†", m:"ì •ë³´", ex:"æ­£ã—ã„<span class='highlight'>æƒ…å ±</span>ã‚’å¾—ã‚‹ã€‚", tr:"ì˜¬ë°”ë¥¸ ì •ë³´ë¥¼ ì–»ë‹¤."},

            // Set 3: ë™ì‘ì„± ëª…ì‚¬ (ã™ã‚‹ ë™ì‚¬)
            {q:"æˆåŠŸ", y:"ã›ã„ã“ã†", m:"ì„±ê³µ", ex:"å®Ÿé¨“ã«<span class='highlight'>æˆåŠŸ</span>ã™ã‚‹ã€‚", tr:"ì‹¤í—˜ì— ì„±ê³µí•˜ë‹¤."},
            {q:"å¤±æ•—", y:"ã—ã£ã±ã„", m:"ì‹¤íŒ¨/ì‹¤ìˆ˜", ex:"è¨ˆç”»ã«<span class='highlight'>å¤±æ•—</span>ã™ã‚‹ã€‚", tr:"ê³„íšì— ì‹¤íŒ¨í•˜ë‹¤."},
            {q:"å‚åŠ ", y:"ã•ã‚“ã‹", m:"ì°¸ê°€", ex:"ä¼šè­°ã«<span class='highlight'>å‚åŠ </span>ã™ã‚‹ã€‚", tr:"íšŒì˜ì— ì°¸ê°€í•˜ë‹¤."},
            {q:"å‡ºå¸­", y:"ã—ã‚…ã£ã›ã", m:"ì¶œì„", ex:"æˆæ¥­ã«<span class='highlight'>å‡ºå¸­</span>ã™ã‚‹ã€‚", tr:"ìˆ˜ì—…ì— ì¶œì„í•˜ë‹¤."},
            {q:"æ¬ å¸­", y:"ã‘ã£ã›ã", m:"ê²°ì„", ex:"ç—…æ°—ã§<span class='highlight'>æ¬ å¸­</span>ã™ã‚‹ã€‚", tr:"ë³‘ìœ¼ë¡œ ê²°ì„í•˜ë‹¤."},
            {q:"é…åˆ»", y:"ã¡ã“ã", m:"ì§€ê°", ex:"å­¦æ ¡ã«<span class='highlight'>é…åˆ»</span>ã™ã‚‹ã€‚", tr:"í•™êµì— ì§€ê°í•˜ë‹¤."},
            {q:"å¤‰åŒ–", y:"ã¸ã‚“ã‹", m:"ë³€í™”", ex:"æ°—æ¸©ã®<span class='highlight'>å¤‰åŒ–</span>ãŒæ¿€ã—ã„ã€‚", tr:"ê¸°ì˜¨ì˜ ë³€í™”ê°€ ì‹¬í•˜ë‹¤."},
            {q:"é€²åŒ–", y:"ã—ã‚“ã‹", m:"ì§„í™”", ex:"ç”Ÿç‰©ãŒ<span class='highlight'>é€²åŒ–</span>ã™ã‚‹ã€‚", tr:"ìƒë¬¼ì´ ì§„í™”í•˜ë‹¤."},
            {q:"é–‹ç™º", y:"ã‹ã„ã¯ã¤", m:"ê°œë°œ", ex:"æ–°è–¬ã‚’<span class='highlight'>é–‹ç™º</span>ã™ã‚‹ã€‚", tr:"ì‹ ì•½ì„ ê°œë°œí•˜ë‹¤."},
            {q:"ç™ºè¦‹", y:"ã¯ã£ã‘ã‚“", m:"ë°œê²¬", ex:"æ–°ã—ã„æ˜Ÿã‚’<span class='highlight'>ç™ºè¦‹</span>ã™ã‚‹ã€‚", tr:"ìƒˆë¡œìš´ ë³„ì„ ë°œê²¬í•˜ë‹¤."},
            {q:"ç™ºæ˜", y:"ã¯ã¤ã‚ã„", m:"ë°œëª…", ex:"ä¾¿åˆ©ãªæ©Ÿæ¢°ã‚’<span class='highlight'>ç™ºæ˜</span>ã™ã‚‹ã€‚", tr:"í¸ë¦¬í•œ ê¸°ê³„ë¥¼ ë°œëª…í•˜ë‹¤."},
            {q:"è§£æ±º", y:"ã‹ã„ã‘ã¤", m:"í•´ê²°", ex:"å•é¡Œã‚’<span class='highlight'>è§£æ±º</span>ã™ã‚‹ã€‚", tr:"ë¬¸ì œë¥¼ í•´ê²°í•˜ë‹¤."},
            {q:"ç›¸è«‡", y:"ãã†ã ã‚“", m:"ìƒë‹´/ì˜ë…¼", ex:"å‹é”ã«<span class='highlight'>ç›¸è«‡</span>ã™ã‚‹ã€‚", tr:"ì¹œêµ¬ì—ê²Œ ìƒë‹´í•˜ë‹¤."},
            {q:"é€£çµ¡", y:"ã‚Œã‚“ã‚‰ã", m:"ì—°ë½", ex:"ä¼šç¤¾ã«<span class='highlight'>é€£çµ¡</span>ã‚’å…¥ã‚Œã‚‹ã€‚", tr:"íšŒì‚¬ì— ì—°ë½ì„ ë„£ë‹¤."},
            {q:"ç´„æŸ", y:"ã‚„ããã", m:"ì•½ì†", ex:"å‹é”ã¨<span class='highlight'>ç´„æŸ</span>ãŒã‚ã‚‹ã€‚", tr:"ì¹œêµ¬ì™€ ì•½ì†ì´ ìˆë‹¤."},
            {q:"å”åŠ›", y:"ãã‚‡ã†ã‚Šã‚‡ã", m:"í˜‘ë ¥", ex:"ã¿ã‚“ãªã§<span class='highlight'>å”åŠ›</span>ã™ã‚‹ã€‚", tr:"ëª¨ë‘ í•¨ê»˜ í˜‘ë ¥í•˜ë‹¤."},
            {q:"æ³¨ç›®", y:"ã¡ã‚…ã†ã‚‚ã", m:"ì£¼ëª©", ex:"ä¸–ç•ŒãŒ<span class='highlight'>æ³¨ç›®</span>ã—ã¦ã„ã‚‹ã€‚", tr:"ì„¸ê³„ê°€ ì£¼ëª©í•˜ê³  ìˆë‹¤."},
            {q:"é›†ä¸­", y:"ã—ã‚…ã†ã¡ã‚…ã†", m:"ì§‘ä¸­", ex:"å‹‰å¼·ã«<span class='highlight'>é›†ä¸­</span>ã§ããªã„ã€‚", tr:"ê³µë¶€ì— ì§‘ì¤‘í•  ìˆ˜ ì—†ë‹¤."},
            {q:"åˆ¤æ–­", y:"ã¯ã‚“ã ã‚“", m:"íŒë‹¨", ex:"æ­£ã—ã„<span class='highlight'>åˆ¤æ–­</span>ã‚’ã™ã‚‹ã€‚", tr:"ì˜¬ë°”ë¥¸ íŒë‹¨ì„ í•˜ë‹¤."},
            {q:"ç†è§£", y:"ã‚Šã‹ã„", m:"ì´í•´", ex:"å†…å®¹ã‚’<span class='highlight'>ç†è§£</span>ã™ã‚‹ã€‚", tr:"ë‚´ìš©ì„ ì´í•´í•˜ë‹¤."},

            // Set 4: í•„ìˆ˜ ë™ì‚¬ 1 (ë³€í™”, ì´ë™, ìƒíƒœ)
            {q:"å¢—ãˆã‚‹", y:"ãµãˆã‚‹", m:"ëŠ˜ë‹¤/ì¦ê°€í•˜ë‹¤", ex:"ä½“é‡ãŒ<span class='highlight'>å¢—ãˆã‚‹</span>ã€‚", tr:"ì²´ì¤‘ì´ ëŠ˜ë‹¤."},
            {q:"æ¸›ã‚‹", y:"ã¸ã‚‹", m:"ì¤„ë‹¤/ê°ì†Œí•˜ë‹¤", ex:"äººå£ãŒ<span class='highlight'>æ¸›ã‚‹</span>ã€‚", tr:"ì¸êµ¬ê°€ ì¤„ë‹¤."},
            {q:"å¤‰ã‚ã‚‹", y:"ã‹ã‚ã‚‹", m:"ë³€í•˜ë‹¤/ë°”ë€Œë‹¤", ex:"ä¿¡å·ãŒ<span class='highlight'>å¤‰ã‚ã‚‹</span>ã€‚", tr:"ì‹ í˜¸ê°€ ë°”ë€Œë‹¤."},
            {q:"å¤‰ãˆã‚‹", y:"ã‹ãˆã‚‹", m:"ë°”ê¾¸ë‹¤/ë³€í™”ì‹œí‚¤ë‹¤", ex:"é«ªå‹ã‚’<span class='highlight'>å¤‰ãˆã‚‹</span>ã€‚", tr:"í—¤ì–´ìŠ¤íƒ€ì¼ì„ ë°”ê¾¸ë‹¤."},
            {q:"è¶Šãˆã‚‹", y:"ã“ãˆã‚‹", m:"ë„˜ë‹¤/ì´ˆê³¼í•˜ë‹¤", ex:"å±±ã‚’<span class='highlight'>è¶Šãˆã‚‹</span>ã€‚", tr:"ì‚°ì„ ë„˜ë‹¤."},
            {q:"éãã‚‹", y:"ã™ãã‚‹", m:"ì§€ë‚˜ë‹¤/ê³¼í•˜ë‹¤", ex:"æ™‚é–“ãŒ<span class='highlight'>éãã‚‹</span>ã€‚", tr:"ì‹œê°„ì´ ì§€ë‚˜ë‹¤."},
            {q:"ç¶šã", y:"ã¤ã¥ã", m:"ê³„ì†ë˜ë‹¤/ì´ì–´ì§€ë‹¤", ex:"é›¨ãŒ<span class='highlight'>ç¶šã</span>ã€‚", tr:"ë¹„ê°€ ê³„ì†ë˜ë‹¤."},
            {q:"ç¶šã‘ã‚‹", y:"ã¤ã¥ã‘ã‚‹", m:"ê³„ì†í•˜ë‹¤", ex:"ä»•äº‹ã‚’<span class='highlight'>ç¶šã‘ã‚‹</span>ã€‚", tr:"ì¼ì„ ê³„ì†í•˜ë‹¤."},
            {q:"ç›´ã‚‹", y:"ãªãŠã‚‹", m:"ê³ ì³ì§€ë‹¤/ë‚«ë‹¤", ex:"æ•…éšœãŒ<span class='highlight'>ç›´ã‚‹</span>ã€‚", tr:"ê³ ì¥ì´ ê³ ì³ì§€ë‹¤(ìˆ˜ë¦¬ë˜ë‹¤)."},
            {q:"ç›´ã™", y:"ãªãŠã™", m:"ê³ ì¹˜ë‹¤/ìˆ˜ë¦¬í•˜ë‹¤", ex:"é–“é•ã„ã‚’<span class='highlight'>ç›´ã™</span>ã€‚", tr:"í‹€ë¦° ê²ƒì„ ê³ ì¹˜ë‹¤."},
            {q:"æ²»ã‚‹", y:"ãªãŠã‚‹", m:"ë‚«ë‹¤(ë³‘/ìƒì²˜)", ex:"é¢¨é‚ªãŒ<span class='highlight'>æ²»ã‚‹</span>ã€‚", tr:"ê°ê¸°ê°€ ë‚«ë‹¤."},
            {q:"æˆ»ã‚‹", y:"ã‚‚ã©ã‚‹", m:"ë˜ëŒì•„ê°€ë‹¤/ì˜¤ë‹¤", ex:"å¸­ã«<span class='highlight'>æˆ»ã‚‹</span>ã€‚", tr:"ìë¦¬ë¡œ ëŒì•„ì˜¤ë‹¤."},
            {q:"æˆ»ã™", y:"ã‚‚ã©ã™", m:"ë˜ëŒë¦¬ë‹¤", ex:"æœ¬ã‚’æ£šã«<span class='highlight'>æˆ»ã™</span>ã€‚", tr:"ì±…ì„ ì„ ë°˜ì— ë˜ëŒë¦¬ë‹¤(ê½‚ë‹¤)."},
            {q:"æ®‹ã‚‹", y:"ã®ã“ã‚‹", m:"ë‚¨ë‹¤", ex:"æ™‚é–“ãŒã¾ã <span class='highlight'>æ®‹ã£ã¦</span>ã„ã‚‹ã€‚", tr:"ì‹œê°„ì´ ì•„ì§ ë‚¨ì•˜ë‹¤."},
            {q:"æ®‹ã™", y:"ã®ã“ã™", m:"ë‚¨ê¸°ë‹¤", ex:"ã”é£¯ã‚’<span class='highlight'>æ®‹ã™</span>ã€‚", tr:"ë°¥ì„ ë‚¨ê¸°ë‹¤."},
            {q:"é›†ã¾ã‚‹", y:"ã‚ã¤ã¾ã‚‹", m:"ëª¨ì´ë‹¤", ex:"äººãŒ<span class='highlight'>é›†ã¾ã‚‹</span>ã€‚", tr:"ì‚¬ëŒì´ ëª¨ì´ë‹¤."},
            {q:"é›†ã‚ã‚‹", y:"ã‚ã¤ã‚ã‚‹", m:"ëª¨ìœ¼ë‹¤", ex:"åˆ‡æ‰‹ã‚’<span class='highlight'>é›†ã‚ã‚‹</span>ã€‚", tr:"ìš°í‘œë¥¼ ëª¨ìœ¼ë‹¤."},
            {q:"æ±ºã¾ã‚‹", y:"ãã¾ã‚‹", m:"ì •í•´ì§€ë‹¤/ê²°ì •ë˜ë‹¤", ex:"æ—¥ç¨‹ãŒ<span class='highlight'>æ±ºã¾ã‚‹</span>ã€‚", tr:"ì¼ì •ì´ ì •í•´ì§€ë‹¤."},
            {q:"æ±ºã‚ã‚‹", y:"ãã‚ã‚‹", m:"ì •í•˜ë‹¤/ê²°ì •í•˜ë‹¤", ex:"é€²è·¯ã‚’<span class='highlight'>æ±ºã‚ã‚‹</span>ã€‚", tr:"ì§„ë¡œë¥¼ ì •í•˜ë‹¤."},
            {q:"æ¯”ã¹ã‚‹", y:"ãã‚‰ã¹ã‚‹", m:"ë¹„êµí•˜ë‹¤", ex:"å€¤æ®µã‚’<span class='highlight'>æ¯”ã¹ã‚‹</span>ã€‚", tr:"ê°€ê²©ì„ ë¹„êµí•˜ë‹¤."},

            // Set 5: í•„ìˆ˜ ë™ì‚¬ 2 (ê°ì •, ì˜ì§€, ê¸°íƒ€)
            {q:"ä¿¡ã˜ã‚‹", y:"ã—ã‚“ã˜ã‚‹", m:"ë¯¿ë‹¤", ex:"å½¼ã‚’<span class='highlight'>ä¿¡ã˜ã‚‹</span>ã€‚", tr:"ê·¸ë¥¼ ë¯¿ë‹¤."},
            {q:"æ„Ÿã˜ã‚‹", y:"ã‹ã‚“ã˜ã‚‹", m:"ëŠë¼ë‹¤", ex:"ç—›ã¿ã‚’<span class='highlight'>æ„Ÿã˜ã‚‹</span>ã€‚", tr:"í†µì¦ì„ ëŠë¼ë‹¤."},
            {q:"ä¼ãˆã‚‹", y:"ã¤ãŸãˆã‚‹", m:"ì „í•˜ë‹¤", ex:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’<span class='highlight'>ä¼ãˆã‚‹</span>ã€‚", tr:"ë©”ì‹œì§€ë¥¼ ì „í•˜ë‹¤."},
            {q:"ä¼ã‚ã‚‹", y:"ã¤ãŸã‚ã‚‹", m:"ì „í•´ì§€ë‹¤", ex:"ä¼çµ±ãŒ<span class='highlight'>ä¼ã‚ã‚‹</span>ã€‚", tr:"ì „í†µì´ ì „í•´ì§€ë‹¤."},
            {q:"æ¥½ã—ã‚€", y:"ãŸã®ã—ã‚€", m:"ì¦ê¸°ë‹¤", ex:"ä¼‘æ—¥ã‚’<span class='highlight'>æ¥½ã—ã‚€</span>ã€‚", tr:"íœ´ì¼ì„ ì¦ê¸°ë‹¤."},
            {q:"å–œã¶", y:"ã‚ˆã‚ã“ã¶", m:"ê¸°ë»í•˜ë‹¤", ex:"ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’<span class='highlight'>å–œã¶</span>ã€‚", tr:"ì„ ë¬¼ì„ ê¸°ë»í•˜ë‹¤."},
            {q:"æ‚²ã—ã‚€", y:"ã‹ãªã—ã‚€", m:"ìŠ¬í¼í•˜ë‹¤", ex:"åˆ¥ã‚Œã‚’<span class='highlight'>æ‚²ã—ã‚€</span>ã€‚", tr:"ì´ë³„ì„ ìŠ¬í¼í•˜ë‹¤."},
            {q:"é©šã", y:"ãŠã©ã‚ã", m:"ë†€ë¼ë‹¤", ex:"ãƒ‹ãƒ¥ãƒ¼ã‚¹ã«<span class='highlight'>é©šã</span>ã€‚", tr:"ë‰´ìŠ¤ì— ë†€ë¼ë‹¤."},
            {q:"æ€’ã‚‹", y:"ãŠã“ã‚‹", m:"í™”ë‚´ë‹¤", ex:"çˆ¶ãŒ<span class='highlight'>æ€’ã‚‹</span>ã€‚", tr:"ì•„ë²„ì§€ê°€ í™”ë‚´ë‹¤."},
            {q:"èª¿ã¹ã‚‹", y:"ã—ã‚‰ã¹ã‚‹", m:"ì¡°ì‚¬í•˜ë‹¤/ì•Œì•„ ì•Œì•„ë³´ë‹¤", ex:"è¾æ›¸ã§<span class='highlight'>èª¿ã¹ã‚‹</span>ã€‚", tr:"ì‚¬ì „ìœ¼ë¡œ ì¡°ì‚¬í•˜ë‹¤."},
            {q:"ç¢ºã‹ã‚ã‚‹", y:"ãŸã—ã‹ã‚ã‚‹", m:"í™•ì¸í•˜ë‹¤", ex:"ç­”ãˆã‚’<span class='highlight'>ç¢ºã‹ã‚ã‚‹</span>ã€‚", tr:"ë‹µì„ í™•ì¸í•˜ë‹¤."},
            {q:"è‚²ã¦ã‚‹", y:"ãã ã¦ã‚‹", m:"í‚¤ìš°ë‹¤/ê¸°ë¥´ë‹¤", ex:"èŠ±ã‚’<span class='highlight'>è‚²ã¦ã‚‹</span>ã€‚", tr:"ê½ƒì„ í‚¤ìš°ë‹¤."},
            {q:"è‚²ã¤", y:"ãã ã¤", m:"ìë¼ë‹¤/í¬ë‹¤", ex:"å­ä¾›ãŒ<span class='highlight'>è‚²ã¤</span>ã€‚", tr:"ì•„ì´ê°€ ìë¼ë‹¤."},
            {q:"å€’ã‚Œã‚‹", y:"ãŸãŠã‚Œã‚‹", m:"ì“°ëŸ¬ì§€ë‹¤/ë„˜ì–´ì§€ë‹¤", ex:"æœ¨ãŒ<span class='highlight'>å€’ã‚Œã‚‹</span>ã€‚", tr:"ë‚˜ë¬´ê°€ ì“°ëŸ¬ì§€ë‹¤."},
            {q:"å€’ã™", y:"ãŸãŠã™", m:"ì“°ëŸ¬ëœ¨ë¦¬ë‹¤/ì´ê¸°ë‹¤", ex:"æ•µã‚’<span class='highlight'>å€’ã™</span>ã€‚", tr:"ì ì„ ì“°ëŸ¬ëœ¨ë¦¬ë‹¤."},
            {q:"è½ã¡ã‚‹", y:"ãŠã¡ã‚‹", m:"ë–¨ì–´ì§€ë‹¤", ex:"è©¦é¨“ã«<span class='highlight'>è½ã¡ã‚‹</span>ã€‚", tr:"ì‹œí—˜ì— ë–¨ì–´ì§€ë‹¤."},
            {q:"è½ã¨ã™", y:"ãŠã¨ã™", m:"ë–¨ì–´ëœ¨ë¦¬ë‹¤/ìƒë‹¤", ex:"è²¡å¸ƒã‚’<span class='highlight'>è½ã¨ã™</span>ã€‚", tr:"ì§€ê°‘ì„ ë–¨ì–´ëœ¨ë¦¬ë‹¤."},
            {q:"æ¶ˆãˆã‚‹", y:"ããˆã‚‹", m:"êº¼ì§€ë‹¤/ì‚¬ë¼ì§€ë‹¤", ex:"é›»æ°—ãŒ<span class='highlight'>æ¶ˆãˆã‚‹</span>ã€‚", tr:"ì „ê¸°ê°€ êº¼ì§€ë‹¤."},
            {q:"æ¶ˆã™", y:"ã‘ã™", m:"ë„ë‹¤/ì§€ìš°ë‹¤", ex:"ç«ã‚’<span class='highlight'>æ¶ˆã™</span>ã€‚", tr:"ë¶ˆì„ ë„ë‹¤."},
            {q:"æ…£ã‚Œã‚‹", y:"ãªã‚Œã‚‹", m:"ìµìˆ™í•´ì§€ë‹¤", ex:"ä»•äº‹ã«<span class='highlight'>æ…£ã‚Œã‚‹</span>ã€‚", tr:"ì¼ì— ìµìˆ™í•´ì§€ë‹¤."}
        ];

        let quizList = [];
        let currentIdx = 0;
        let score = 0;
        let attempts = 0;
        let currentMode = 0;
        let timerInterval = null;
        let seconds = 0;
        let wrongAnswers = []; 
        let maxPossibleScore = 0;

        const wrapper = document.getElementById('jp-n3-1-wrapper');
        const elQWord = document.getElementById('qWord_n3_1');
        const elQExample = document.getElementById('qExample_n3_1');
        const elQHint = document.getElementById('qHint_n3_1');
        const elOptions = document.getElementById('qOptions_n3_1');
        const elNextBtn = document.getElementById('btnNext_n3_1');
        const elResult = document.getElementById('resultScreen_n3_1');
        const elFinalScore = document.getElementById('finalScore_n3_1');
        const elMaxScore = document.getElementById('maxScore_n3_1');
        const elWrongList = document.getElementById('wrongList_n3_1');
        const elWrongHeader = document.getElementById('wrongListHeader_n3_1');
        const elQCount = document.getElementById('qCount_n3_1');
        const elTimer = document.getElementById('timerDisplay_n3_1');
        const elLiveScore = document.getElementById('liveScore_n3_1');

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function setSize(size) {
            wrapper.classList.remove('size-small', 'size-large');
            const btns = wrapper.querySelectorAll('.size-btn');
            btns.forEach(b => b.classList.remove('active'));
            if (size === 'small') { wrapper.classList.add('size-small'); btns[0].classList.add('active'); }
            else if (size === 'large') { wrapper.classList.add('size-large'); btns[2].classList.add('active'); }
            else { btns[1].classList.add('active'); }
        }

        function changeSet(mode) {
            currentMode = mode;
            const btns = wrapper.querySelectorAll('.set-btn');
            btns.forEach(b => b.classList.remove('active'));
            let btnIdx = (mode === 'all') ? 5 : mode;
            btns[btnIdx].classList.add('active');
            initGame();
        }

        function initGame() {
            let targetData = [];
            if (currentMode === 'all') { targetData = shuffle([...dataPool]); }
            else {
                const start = currentMode * 20;
                const end = start + 20;
                targetData = shuffle(dataPool.slice(start, end));
            }
            quizList = targetData;
            currentIdx = 0; score = 0; wrongAnswers = []; maxPossibleScore = quizList.length * 10;
            elResult.style.display = 'none';
            updateStatus(); loadQuestion();
        }

        function loadQuestion() {
            if (currentIdx >= quizList.length) { finishGame(); return; }
            const data = quizList[currentIdx];
            attempts = 0; 
            resetTimer(); startTimer(); updateStatus();

            elQWord.innerHTML = `<ruby>${data.q}<rt>${data.y}</rt></ruby>`;
            elQExample.innerHTML = data.ex;
            elQHint.style.display = 'none';
            elQHint.innerText = `ğŸ’¡ í•´ì„: ${data.tr}`;
            elNextBtn.style.display = 'none';
            elOptions.innerHTML = '';
            elOptions.classList.remove('disabled-area');

            let opts = [{txt: data.m, isAns: true}];
            let others = shuffle(dataPool.filter(d => d.m !== data.m)).slice(0, 3);
            others.forEach(o => opts.push({txt: o.m, isAns: false}));
            opts = shuffle(opts);

            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt.txt;
                btn.onclick = () => checkAnswer(btn, opt.isAns);
                elOptions.appendChild(btn);
            });
        }

        function checkAnswer(btn, isCorrect) {
            if (isCorrect) {
                stopTimer(); btn.classList.add('correct'); elOptions.classList.add('disabled-area');
                if (attempts === 0) {
                    let timeBonus = Math.max(2, 10 - Math.floor(seconds / 2)); 
                    score += timeBonus; updateStatus();
                    setTimeout(() => { nextQuestion(); }, 500);
                } else { elNextBtn.style.display = 'block'; }
            } else {
                btn.classList.add('wrong'); btn.disabled = true;
                if (attempts === 0) {
                    attempts = 1; elQHint.style.display = 'block';
                    const currentData = quizList[currentIdx];
                    if(!wrongAnswers.includes(currentData)) { wrongAnswers.push(currentData); }
                } else {
                    stopTimer(); elOptions.classList.add('disabled-area');
                    const correctTxt = quizList[currentIdx].m;
                    const allBtns = elOptions.querySelectorAll('.opt-btn');
                    allBtns.forEach(b => { if (b.innerText === correctTxt) b.classList.add('correct'); });
                    elNextBtn.style.display = 'block';
                }
            }
        }

        function startTimer() { seconds = 0; elTimer.innerText = "0s"; timerInterval = setInterval(() => { seconds++; elTimer.innerText = seconds + "s"; }, 1000); }
        function stopTimer() { clearInterval(timerInterval); }
        function resetTimer() { stopTimer(); seconds = 0; elTimer.innerText = "0s"; }
        function updateStatus() { elQCount.innerText = `${currentIdx + 1} / ${quizList.length}`; elLiveScore.innerText = score; }
        function nextQuestion() { currentIdx++; loadQuestion(); }

        function speak() {
            if (!('speechSynthesis' in window)) return;
            const data = quizList[currentIdx];
            const utt = new SpeechSynthesisUtterance(data.q);
            utt.lang = 'ja-JP'; utt.rate = 0.9;
            const voices = window.speechSynthesis.getVoices();
            const jaVoice = voices.find(v => v.lang.includes('ja') || v.lang.includes('JP'));
            if (jaVoice) utt.voice = jaVoice;
            window.speechSynthesis.cancel(); window.speechSynthesis.speak(utt);
        }
        if ('speechSynthesis' in window) { window.speechSynthesis.onvoiceschanged = function() { window.speechSynthesis.getVoices(); }; }

        function finishGame() {
            stopTimer();
            elFinalScore.innerText = score; elMaxScore.innerText = maxPossibleScore;
            elWrongList.innerHTML = '';
            if (wrongAnswers.length === 0) {
                elWrongHeader.innerText = "âœ… í‹€ë¦° ë‹¨ì–´ ì—†ìŒ";
                elWrongList.innerHTML = '<div style="padding:10px; text-align:center;">ğŸ‰ ì™„ë²½í•©ë‹ˆë‹¤! N3 ê¸°ì´ˆë¥¼ ë§ˆìŠ¤í„°í•˜ì…¨êµ°ìš”!</div>';
            } else {
                elWrongHeader.innerText = `âŒ í‹€ë¦° ë‹¨ì–´ (ì´ ${wrongAnswers.length}ê°œ)`;
                wrongAnswers.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'review-item';
                    div.innerHTML = `<div class="review-word">${item.q} (${item.y})</div><div class="review-mean">${item.m}</div><div style="font-size:12px; color:#64748b; margin-top:2px;">${item.tr}</div>`;
                    elWrongList.appendChild(div);
                });
            }
            elResult.style.display = 'flex';
        }

        window.JpN3_1 = { setSize, changeSet, initGame, nextQuestion, speak };
        initGame();
    })();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT N5 ë‹¨ì–´ í€´ì¦ˆ 4 (ê¸°ì´ˆ í•œì)</title>
    
    <style>
        /* --- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .back-link {
            display: inline-block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #34495e;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .back-link:hover { background-color: #2c3e50; transform: translateY(-2px); }
        .top-bar { text-align: center; background-color: #f4f7f6; padding-top: 10px; }

        /* --- ê¸°ì¡´ ìˆ˜í›ˆë‹˜ CSS ì½”ë“œ --- */
        /* 4. ë‹¨ì–´ í€´ì¦ˆ ì „ìš© ë˜í¼ (Part 4 - í•œì) */
        #jp-wordquiz-wrapper-4 {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* ì˜¤íƒ€ ìˆ˜ì •ë¨ */
            padding: 40px 20px;
            border-radius: 10px;
            margin: 0 auto 30px auto; /* ì¤‘ì•™ ì •ë ¬ */
            max-width: 800px;
            position: relative;
            
            /* ë³€ìˆ˜ ì„¤ì • */
            --max-width: 450px;
            --q-font: 70px; /* í•œìëŠ” íšìˆ˜ê°€ ë§ìœ¼ë¯€ë¡œ í¬ê²Œ */
            --opt-font: 18px;
            --opt-padding: 15px;
            --hint-height: 35px;
        }

        /* ì‚¬ì´ì¦ˆë³„ í´ë˜ìŠ¤ */
        #jp-wordquiz-wrapper-4.size-small { --max-width: 350px; --q-font: 50px; --opt-font: 14px; --opt-padding: 10px; --hint-height: 30px; }
        #jp-wordquiz-wrapper-4.size-large { --max-width: 700px; --q-font: 100px; --opt-font: 24px; --opt-padding: 20px; --hint-height: 50px; }

        /* ë‚´ë¶€ ì»¨í…Œì´ë„ˆ */
        #jp-wordquiz-wrapper-4 .quiz-container {
            background-color: #34495e; padding: 30px; border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); text-align: center;
            width: 100%; max-width: var(--max-width); position: relative; transition: max-width 0.3s; box-sizing: border-box;
        }

        /* íƒ€ì´í‹€ */
        #jp-wordquiz-wrapper-4 h2.game-title { margin-top: 25px; font-size: 24px; color: #ecf0f1; border: none; margin-bottom: 5px; }
        .game-subtitle { font-size: 16px; color: #1abc9c; margin-bottom: 15px; font-weight: bold; }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .size-controls, .set-controls { display: flex; gap: 5px; }
        .ctrl-btn { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: #bdc3c7; padding: 5px 10px; font-size: 12px; cursor: pointer; border-radius: 4px; }
        .ctrl-btn:hover { background: rgba(0,0,0,0.5); color: white; }
        .ctrl-btn.active { background: #3498db; color: white; border-color: #3498db; }
        .set-btn.active { background: #1abc9c; border-color: #1abc9c; color: white; }

        /* ìƒíƒœë°” */
        .quiz-status-bar { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 16px; color: #bdc3c7; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; }
        .highlight { color: #f1c40f; font-weight: bold; }

        /* ë¬¸ì œ ì˜ì—­ (í•œì + ìŠ¤í”¼ì»¤) */
        .question-area { display: flex; align-items: center; justify-content: center; gap: 15px; margin: 10px 0 5px 0; }
        .question-box { font-size: var(--q-font); font-weight: bold; min-height: calc(var(--q-font) * 1.5); color: #ecf0f1; text-shadow: 2px 2px 5px rgba(0,0,0,0.3); line-height: 1.2; font-family: "MS Mincho", "Yu Mincho", serif; }

        /* ìŠ¤í”¼ì»¤ ë²„íŠ¼ */
        .audio-btn { background: #ecf0f1; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; color: #2c3e50; }
        .audio-btn:active { transform: scale(0.9); }
        .audio-btn:hover { background: #bdc3c7; }
        
        /* ìš”ë¯¸ê°€ë‚˜ ë³´ê¸° ë²„íŠ¼ & íŒíŠ¸ ì˜ì—­ */
        .yomi-toggle-btn { background: none; border: 1px solid #f39c12; color: #f39c12; padding: 5px 12px; border-radius: 15px; font-size: 12px; cursor: pointer; margin-bottom: 5px; transition: 0.2s; }
        .yomi-toggle-btn:hover { background: #f39c12; color: white; }

        .question-yomi { font-size: calc(var(--opt-font) + 4px); color: #f39c12; margin-bottom: 20px; min-height: var(--hint-height); font-weight: bold; transition: opacity 0.3s; display: flex; align-items: center; justify-content: center; }

        /* ë³´ê¸° ë²„íŠ¼ ì˜ì—­ */
        .options-grid { display: flex; flex-direction: column; gap: 12px; }
        .option-btn { background-color: #ecf0f1; color: #2c3e50; border: none; padding: var(--opt-padding); font-size: var(--opt-font); border-radius: 8px; cursor: pointer; transition: all 0.1s; font-weight: bold; position: relative; }
        .option-btn:hover { background-color: #bdc3c7; transform: translateY(-2px); }
        .option-btn.correct { background-color: #2ecc71 !important; color: white; transform: scale(1.02); }
        .option-btn.wrong { background-color: #e74c3c !important; color: white; opacity: 0.6; cursor: not-allowed; }
        .disabled-area { pointer-events: none; }

        /* ê²°ê³¼ í™”ë©´ */
        #quizResultScreen_4 { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(44, 62, 80, 0.98); border-radius: 15px; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        #quizResultScreen_4 h2 { font-size: 32px; margin-bottom: 10px; color: #2ecc71; border: none;}
        .result-stat { font-size: 20px; margin: 5px 0; color: white; }
        
        .mistake-log-container { margin-top: 15px; width: 90%; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 10px; max-height: 200px; overflow-y: auto; text-align: left; }
        .mistake-item { border-bottom: 1px solid rgba(255,255,255,0.1); padding: 8px 0; font-size: 15px; color: #bdc3c7; }
        .mistake-jp { color: #e74c3c; font-weight: bold; margin-right: 8px; font-family: "MS Mincho", serif;}
        
        .restart-btn { margin-top: 25px; padding: 12px 30px; font-size: 18px; background-color: #e67e22; color: white; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body style="background-color: #f4f7f6; margin: 0; padding: 0;">

    <div class="top-bar">
        <a href="../index.html" class="back-link">ğŸ”™ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div id="jp-wordquiz-wrapper-4">
        <div class="quiz-container">
            
            <div class="control-panel">
                <div class="set-controls">
                    <button class="ctrl-btn set-btn active" onclick="changeSet_4(1)">Set 1</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet_4(2)">Set 2</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet_4(3)">Set 3</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet_4(4)">Set 4</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet_4(5)">Set 5</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet_4('all')">ALL</button>
                </div>
                <div class="size-controls">
                    <button class="ctrl-btn size-btn" onclick="setQuizSize_4('small')">ì‘ê²Œ</button>
                    <button class="ctrl-btn size-btn active" onclick="setQuizSize_4('medium')" id="btnQuizMedium_4">ë³´í†µ</button>
                    <button class="ctrl-btn size-btn" onclick="setQuizSize_4('large')">í¬ê²Œ</button>
                </div>
            </div>

            <h2 class="game-title">ğŸ‡¯ğŸ‡µ JLPT N5 ë‹¨ì–´ì¥</h2>
            <div class="game-subtitle" id="setSubtitle_4">[ Set 1 : ì‹œì‘í•˜ê¸° ]</div>

            <div class="quiz-status-bar">
                <span>ì§„í–‰: <span id="quizProgress_4" class="highlight" style="color:#2ecc71">0 / 0</span></span>
                <span>ì ìˆ˜: <span id="quizScore_4" class="highlight">0</span></span>
            </div>

            <div class="question-area">
                <div class="question-box" id="quizQuestionText_4">???</div>
                <button class="audio-btn" onclick="speak_4()" title="ë‹¨ì–´ ë“£ê¸°">ğŸ”Š</button>
            </div>
            
            <button class="yomi-toggle-btn" onclick="toggleYomi_4()">[ ìš”ë¯¸ê°€ë‚˜ ë³´ê¸° ]</button>
            <div class="question-yomi" id="quizHintBox_4"></div>

            <div class="options-grid" id="quizOptionsArea_4"></div>

            <div id="quizResultScreen_4">
                <h2>ğŸ‰ í€´ì¦ˆ ì™„ë£Œ! ğŸ‰</h2>
                <div class="result-stat">ìµœì¢… ì ìˆ˜: <b id="finalQuizScore_4" style="color:#f1c40f">0</b></div>
                <div class="result-stat">ë§ì¶˜ ê°œìˆ˜: <b id="finalQuizProgress_4">0 / 0</b></div>
                
                <div class="mistake-log-container">
                    <div style="font-size:14px; color:#e74c3c; text-align:center; margin-bottom:5px;">â–¼ í‹€ë¦° í•œì ë³µìŠµ â–¼</div>
                    <div id="quizMistakeList_4"></div>
                </div>

                <button class="restart-btn" onclick="initQuizGame_4()">ë‹¤ì‹œ í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // 4íƒ„: ê¸°ì´ˆ í•œì 100ì„ 
        const wordQuizDB_4 = [
            // Set 1: ìˆ«ì/ìš”ì¼/ì‹œê°„ (1-20)
            { jp: 'ä¸€', mean: 'ì¼ (1)', yomi: 'ã„ã¡', set: 1 }, { jp: 'äºŒ', mean: 'ì´ (2)', yomi: 'ã«', set: 1 }, { jp: 'ä¸‰', mean: 'ì‚¼ (3)', yomi: 'ã•ã‚“', set: 1 }, { jp: 'å››', mean: 'ì‚¬ (4)', yomi: 'ã‚ˆã‚“ / ã—', set: 1 }, { jp: 'äº”', mean: 'ì˜¤ (5)', yomi: 'ã”', set: 1 }, { jp: 'å…­', mean: 'ìœ¡ (6)', yomi: 'ã‚ã', set: 1 }, { jp: 'ä¸ƒ', mean: 'ì¹  (7)', yomi: 'ãªãª / ã—ã¡', set: 1 }, { jp: 'å…«', mean: 'íŒ” (8)', yomi: 'ã¯ã¡', set: 1 }, { jp: 'ä¹', mean: 'êµ¬ (9)', yomi: 'ãã‚…ã† / ã', set: 1 }, { jp: 'å', mean: 'ì‹­ (10)', yomi: 'ã˜ã‚…ã†', set: 1 }, { jp: 'ç™¾', mean: 'ë°± (100)', yomi: 'ã²ã‚ƒã', set: 1 }, { jp: 'åƒ', mean: 'ì²œ (1,000)', yomi: 'ã›ã‚“', set: 1 }, { jp: 'ä¸‡', mean: 'ë§Œ (10,000)', yomi: 'ã¾ã‚“', set: 1 }, { jp: 'å††', mean: 'ì—” (í™”í)', yomi: 'ãˆã‚“', set: 1 }, { jp: 'æ—¥', mean: 'ë‚  ì¼ / í•´', yomi: 'ã«ã¡ / ã²', set: 1 }, { jp: 'æœˆ', mean: 'ë‹¬ ì›”', yomi: 'ã’ã¤ / ã¤ã', set: 1 }, { jp: 'ç«', mean: 'ë¶ˆ í™”', yomi: 'ã‹ / ã²', set: 1 }, { jp: 'æ°´', mean: 'ë¬¼ ìˆ˜', yomi: 'ã™ã„ / ã¿ãš', set: 1 }, { jp: 'æœ¨', mean: 'ë‚˜ë¬´ ëª©', yomi: 'ã‚‚ã / ã', set: 1 }, { jp: 'é‡‘', mean: 'ì‡  ê¸ˆ / ëˆ', yomi: 'ãã‚“ / ã‹ã­', set: 1 },
            // Set 2: ì‹œê°„/ìœ„ì¹˜/ë°©í–¥ (21-40)
            { jp: 'åœŸ', mean: 'í™ í† ', yomi: 'ã© / ã¤ã¡', set: 2 }, { jp: 'å¹´', mean: 'í•´ ë…„', yomi: 'ã­ã‚“ / ã¨ã—', set: 2 }, { jp: 'æ™‚', mean: 'ë•Œ ì‹œ (ì‹œê°„)', yomi: 'ã˜ / ã¨ã', set: 2 }, { jp: 'é–“', mean: 'ì‚¬ì´ ê°„', yomi: 'ã‹ã‚“ / ã‚ã„ã ', set: 2 }, { jp: 'åˆ†', mean: 'ë‚˜ëˆŒ ë¶„ (ë¶„)', yomi: 'ãµã‚“ / ã¶ã‚“', set: 2 }, { jp: 'ä»Š', mean: 'ì´ì œ ê¸ˆ (ì§€ê¸ˆ)', yomi: 'ã„ã¾', set: 2 }, { jp: 'åˆ', mean: 'ë‚® ì˜¤ (ì˜¤ì „/ì˜¤í›„)', yomi: 'ã”', set: 2 }, { jp: 'å‰', mean: 'ì• ì „', yomi: 'ãœã‚“ / ã¾ãˆ', set: 2 }, { jp: 'å¾Œ', mean: 'ë’¤ í›„', yomi: 'ã” / ã†ã—ã‚', set: 2 }, { jp: 'æ¯', mean: 'ë§¤ì–‘ ë§¤ (ë§¤ì¼)', yomi: 'ã¾ã„', set: 2 }, { jp: 'åŠ', mean: 'ë°˜ ë°˜ (ì ˆë°˜)', yomi: 'ã¯ã‚“', set: 2 }, { jp: 'ä¸Š', mean: 'ìœ— ìƒ', yomi: 'ã†ãˆ', set: 2 }, { jp: 'ä¸‹', mean: 'ì•„ë˜ í•˜', yomi: 'ã—ãŸ', set: 2 }, { jp: 'å·¦', mean: 'ì™¼ ì¢Œ', yomi: 'ã²ã ã‚Š', set: 2 }, { jp: 'å³', mean: 'ì˜¤ë¥¸ ìš°', yomi: 'ã¿ã', set: 2 }, { jp: 'ä¸­', mean: 'ê°€ìš´ë° ì¤‘ (ì•ˆ)', yomi: 'ãªã‹', set: 2 }, { jp: 'å¤–', mean: 'ë°”ê¹¥ ì™¸', yomi: 'ãã¨', set: 2 }, { jp: 'æ±', mean: 'ë™ë…˜ ë™', yomi: 'ã²ãŒã—', set: 2 }, { jp: 'è¥¿', mean: 'ì„œë…˜ ì„œ', yomi: 'ã«ã—', set: 2 }, { jp: 'å—', mean: 'ë‚¨ë…˜ ë‚¨', yomi: 'ã¿ãªã¿', set: 2 },
            // Set 3: ì‚¬ëŒ/ì‹ ì²´/ìì—° (41-60)
            { jp: 'åŒ—', mean: 'ë¶ë…˜ ë¶', yomi: 'ããŸ', set: 3 }, { jp: 'äºº', mean: 'ì‚¬ëŒ ì¸', yomi: 'ã²ã¨ / ã˜ã‚“', set: 3 }, { jp: 'çˆ¶', mean: 'ì•„ë¹„ ë¶€ (ì•„ë¹ )', yomi: 'ã¡ã¡', set: 3 }, { jp: 'æ¯', mean: 'ì–´ë¯¸ ëª¨ (ì—„ë§ˆ)', yomi: 'ã¯ã¯', set: 3 }, { jp: 'å‹', mean: 'ë²— ìš° (ì¹œêµ¬)', yomi: 'ã¨ã‚‚', set: 3 }, { jp: 'ç”·', mean: 'ì‚¬ë‚´ ë‚¨ (ë‚¨ì)', yomi: 'ãŠã¨ã“', set: 3 }, { jp: 'å¥³', mean: 'ê³„ì§‘ ë…€ (ì—¬ì)', yomi: 'ãŠã‚“ãª', set: 3 }, { jp: 'å­', mean: 'ì•„ë“¤ ì (ì•„ì´)', yomi: 'ã“', set: 3 }, { jp: 'å', mean: 'ì´ë¦„ ëª…', yomi: 'ãª', set: 3 }, { jp: 'ç›®', mean: 'ëˆˆ ëª©', yomi: 'ã‚', set: 3 }, { jp: 'å£', mean: 'ì… êµ¬', yomi: 'ãã¡', set: 3 }, { jp: 'è€³', mean: 'ê·€ ì´', yomi: 'ã¿ã¿', set: 3 }, { jp: 'æ‰‹', mean: 'ì† ìˆ˜', yomi: 'ã¦', set: 3 }, { jp: 'è¶³', mean: 'ë°œ ì¡±', yomi: 'ã‚ã—', set: 3 }, { jp: 'å±±', mean: 'ë«¼ ì‚°', yomi: 'ã‚„ã¾', set: 3 }, { jp: 'å·', mean: 'ë‚´ ì²œ (ê°•)', yomi: 'ã‹ã‚', set: 3 }, { jp: 'å¤©', mean: 'í•˜ëŠ˜ ì²œ', yomi: 'ã¦ã‚“', set: 3 }, { jp: 'æ°—', mean: 'ê¸°ìš´ ê¸° (ë‚ ì”¨)', yomi: 'ã', set: 3 }, { jp: 'é›¨', mean: 'ë¹„ ìš°', yomi: 'ã‚ã‚', set: 3 }, { jp: 'é›ª', mean: 'ëˆˆ ì„¤', yomi: 'ã‚†ã', set: 3 },
            // Set 4: í•™êµ/ìƒí™œ/ì¥ì†Œ (61-80)
            { jp: 'å›½', mean: 'ë‚˜ë¼ êµ­', yomi: 'ãã«', set: 4 }, { jp: 'é“', mean: 'ê¸¸ ë„', yomi: 'ã¿ã¡', set: 4 }, { jp: 'å­¦', mean: 'ë°°ìš¸ í•™', yomi: 'ãŒã', set: 4 }, { jp: 'æ ¡', mean: 'í•™êµ êµ', yomi: 'ã“ã†', set: 4 }, { jp: 'å…ˆ', mean: 'ë¨¼ì € ì„ ', yomi: 'ã›ã‚“ / ã•ã', set: 4 }, { jp: 'ç”Ÿ', mean: 'ë‚  ìƒ', yomi: 'ã›ã„ / ã†ã¾ã‚Œã‚‹', set: 4 }, { jp: 'æœ¬', mean: 'ê·¼ë³¸ ë³¸ (ì±…)', yomi: 'ã»ã‚“', set: 4 }, { jp: 'æ–‡', mean: 'ê¸€ì›” ë¬¸', yomi: 'ã¶ã‚“', set: 4 }, { jp: 'å­—', mean: 'ê¸€ì ì', yomi: 'ã˜', set: 4 }, { jp: 'èª', mean: 'ë§ì”€ ì–´ (ì–¸ì–´)', yomi: 'ã”', set: 4 }, { jp: 'è©±', mean: 'ë§í•  í™” (ì´ì•¼ê¸°)', yomi: 'ã¯ãªã—', set: 4 }, { jp: 'è»Š', mean: 'ìˆ˜ë ˆ ê±° (ìë™ì°¨)', yomi: 'ãã‚‹ã¾', set: 4 }, { jp: 'é›»', mean: 'ë²ˆê°œ ì „ (ì „ê¸°)', yomi: 'ã§ã‚“', set: 4 }, { jp: 'é§…', mean: 'ì—­ ì—­', yomi: 'ãˆã', set: 4 }, { jp: 'ç¤¾', mean: 'ëª¨ì¼ ì‚¬ (íšŒì‚¬)', yomi: 'ã—ã‚ƒ', set: 4 }, { jp: 'åº—', mean: 'ê°€ê²Œ ì ', yomi: 'ã¿ã›', set: 4 }, { jp: 'å¤§', mean: 'í° ëŒ€ (í¬ë‹¤)', yomi: 'ãŠãŠãã„', set: 4 }, { jp: 'å°', mean: 'ì‘ì„ ì†Œ (ì‘ë‹¤)', yomi: 'ã¡ã„ã•ã„', set: 4 }, { jp: 'é•·', mean: 'ê¸¸ ì¥ (ê¸¸ë‹¤)', yomi: 'ãªãŒã„', set: 4 }, { jp: 'é«˜', mean: 'ë†’ì„ ê³  (ë¹„ì‹¸ë‹¤)', yomi: 'ãŸã‹ã„', set: 4 },
            // Set 5: í˜•ìš©ì‚¬/ë™ì‚¬ (81-100)
            { jp: 'å®‰', mean: 'í¸ì•ˆ ì•ˆ (ì‹¸ë‹¤)', yomi: 'ã‚„ã™ã„', set: 5 }, { jp: 'æ–°', mean: 'ìƒˆ ì‹  (ìƒˆë¡­ë‹¤)', yomi: 'ã‚ãŸã‚‰ã—ã„', set: 5 }, { jp: 'å¤', mean: 'ì˜› ê³  (ë‚¡ë‹¤)', yomi: 'ãµã‚‹ã„', set: 5 }, { jp: 'å¤š', mean: 'ë§ˆëŠ˜ ë‹¤ (ë§ë‹¤)', yomi: 'ãŠãŠã„', set: 5 }, { jp: 'å°‘', mean: 'ì ì„ ì†Œ (ì ë‹¤)', yomi: 'ã™ããªã„', set: 5 }, { jp: 'ç™½', mean: 'í° ë°± (í•˜ì–—ë‹¤)', yomi: 'ã—ã‚ã„', set: 5 }, { jp: 'è¡Œ', mean: 'ë‹¤ë‹ í–‰ (ê°€ë‹¤)', yomi: 'ã„ã', set: 5 }, { jp: 'æ¥', mean: 'ì˜¬ ë˜ (ì˜¤ë‹¤)', yomi: 'ãã‚‹', set: 5 }, { jp: 'é£Ÿ', mean: 'ë¨¹ì„ ì‹ (ë¨¹ë‹¤)', yomi: 'ãŸã¹ã‚‹', set: 5 }, { jp: 'é£²', mean: 'ë§ˆì‹¤ ìŒ (ë§ˆì‹œë‹¤)', yomi: 'ã®ã‚€', set: 5 }, { jp: 'è¦‹', mean: 'ë³¼ ê²¬ (ë³´ë‹¤)', yomi: 'ã¿ã‚‹', set: 5 }, { jp: 'è', mean: 'ë“¤ì„ ë¬¸ (ë“£ë‹¤)', yomi: 'ãã', set: 5 }, { jp: 'èª­', mean: 'ì½ì„ ë… (ì½ë‹¤)', yomi: 'ã‚ˆã‚€', set: 5 }, { jp: 'æ›¸', mean: 'ê¸€ ì„œ (ì“°ë‹¤)', yomi: 'ã‹ã', set: 5 }, { jp: 'è¨€', mean: 'ë§ì”€ ì–¸ (ë§í•˜ë‹¤)', yomi: 'ã„ã†', set: 5 }, { jp: 'å‡º', mean: 'ë‚  ì¶œ (ë‚˜ê°€ë‹¤)', yomi: 'ã§ã‚‹', set: 5 }, { jp: 'å…¥', mean: 'ë“¤ ì… (ë“¤ì–´ê°€ë‹¤)', yomi: 'ã¯ã„ã‚‹', set: 5 }, { jp: 'ç«‹', mean: 'ì„¤ ë¦½ (ì„œë‹¤)', yomi: 'ãŸã¤', set: 5 }, { jp: 'ä¼‘', mean: 'ì‰´ íœ´ (ì‰¬ë‹¤)', yomi: 'ã‚„ã™ã‚€', set: 5 }, { jp: 'è²·', mean: 'ì‚´ ë§¤ (ì‚¬ë‹¤)', yomi: 'ã‹ã†', set: 5 }
        ];

        let quizDeck_4 = [];
        let currentQuiz_4 = null;
        let quizScore_4 = 0;
        let quizCorrectCount_4 = 0;
        let quizTotalCount_4 = 0;
        let quizWrongAnswers_4 = []; 
        let quizStartTime_4 = 0; 
        let quizMistakeCount_4 = 0; 
        let currentSet_4 = 1;

        const quizWrapper_4 = document.getElementById('jp-wordquiz-wrapper-4');
        const qText_4 = document.getElementById('quizQuestionText_4');
        const qHint_4 = document.getElementById('quizHintBox_4');
        const qOptions_4 = document.getElementById('quizOptionsArea_4');
        const qProgress_4 = document.getElementById('quizProgress_4');
        const qScore_4 = document.getElementById('quizScore_4');
        const qResult_4 = document.getElementById('quizResultScreen_4');
        const qMistakeList_4 = document.getElementById('quizMistakeList_4');
        const qSubtitle_4 = document.getElementById('setSubtitle_4');

        function setQuizSize_4(size) {
            quizWrapper_4.classList.remove('size-small', 'size-large');
            const buttons = quizWrapper_4.querySelectorAll('.size-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (size === 'small') {
                quizWrapper_4.classList.add('size-small');
                quizWrapper_4.querySelector("button[onclick=\"setQuizSize_4('small')\"]").classList.add('active');
            } else if (size === 'large') {
                quizWrapper_4.classList.add('size-large');
                quizWrapper_4.querySelector("button[onclick=\"setQuizSize_4('large')\"]").classList.add('active');
            } else {
                document.getElementById('btnQuizMedium_4').classList.add('active');
            }
        }

        function changeSet_4(set) {
            currentSet_4 = set;
            const setBtns = quizWrapper_4.querySelectorAll('.set-btn');
            setBtns.forEach(btn => btn.classList.remove('active'));
            
            if(set === 'all') {
                setBtns[5].classList.add('active');
                qSubtitle_4.innerText = `[ ì „ì²´ ë„ì „ : ì´ ${wordQuizDB_4.length}ë‹¨ì–´ ]`;
            } else {
                setBtns[set-1].classList.add('active');
                qSubtitle_4.innerText = `[ Set ${set} : ë‹¨ì–´ ${getSetRange_4(set)} ]`;
            }
            initQuizGame_4();
        }

        function getSetRange_4(set) {
            const start = (set - 1) * 20 + 1;
            const end = set * 20;
            return `${start}~${end}`;
        }

        function shuffleQuiz_4(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function initQuizGame_4() {
            let filteredDB = [];
            if (currentSet_4 === 'all') {
                filteredDB = [...wordQuizDB_4];
            } else {
                filteredDB = wordQuizDB_4.filter(item => item.set === currentSet_4);
            }

            quizDeck_4 = shuffleQuiz_4(filteredDB); 
            quizTotalCount_4 = quizDeck_4.length; 
            quizScore_4 = 0;
            quizCorrectCount_4 = 0;
            quizWrongAnswers_4 = [];
            qScore_4.innerText = quizScore_4;
            updateQuizProgress_4();
            qResult_4.style.display = 'none';
            nextQuizQuestion_4();
        }

        function updateQuizProgress_4() {
            qProgress_4.innerText = `${quizCorrectCount_4} / ${quizTotalCount_4}`;
        }

        function nextQuizQuestion_4() {
            if (quizDeck_4.length === 0) {
                endQuizGame_4();
                return;
            }
            qOptions_4.classList.remove('disabled-area');
            quizMistakeCount_4 = 0; 
            currentQuiz_4 = quizDeck_4.pop();
            qText_4.innerText = currentQuiz_4.jp;
            qHint_4.innerText = ""; 
            const options = generateQuizOptions_4(currentQuiz_4);
            renderQuizButtons_4(options);
            quizStartTime_4 = Date.now();
        }

        function toggleYomi_4() {
            if (qHint_4.innerText === "") {
                qHint_4.innerText = `ğŸ“– ${currentQuiz_4.yomi}`;
            } else {
                qHint_4.innerText = "";
            }
        }

        function generateQuizOptions_4(correctItem) {
            const otherWords = wordQuizDB_4.filter(w => w.jp !== correctItem.jp);
            const distractors = shuffleQuiz_4(otherWords).slice(0, 4);
            const finalOptions = [...distractors, correctItem];
            return shuffleQuiz_4(finalOptions);
        }

        function renderQuizButtons_4(options) {
            qOptions_4.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.mean;
                btn.onclick = () => checkQuizAnswer_4(btn, opt);
                qOptions_4.appendChild(btn);
            });
        }

        function checkQuizAnswer_4(btn, selectedOpt) {
            if (selectedOpt.jp === currentQuiz_4.jp) {
                qOptions_4.classList.add('disabled-area'); 
                btn.classList.add('correct');
                
                if (quizMistakeCount_4 === 0) {
                    const endTime = Date.now();
                    const timeTaken = (endTime - quizStartTime_4) / 1000; 
                    const point = Math.max(20, Math.floor(100 - (timeTaken * 5))); 
                    quizScore_4 += point;
                    quizCorrectCount_4++; 
                } else {
                    quizCorrectCount_4++; 
                }

                qScore_4.innerText = quizScore_4;
                updateQuizProgress_4(); 
                setTimeout(nextQuizQuestion_4, 500); 
            } else {
                btn.classList.add('wrong');
                btn.disabled = true; 
                
                if (quizMistakeCount_4 === 0) {
                    quizMistakeCount_4++;
                    qHint_4.innerText = `ğŸ’¡ íŒíŠ¸: ${currentQuiz_4.yomi}`;
                    if (!quizWrongAnswers_4.some(w => w.jp === currentQuiz_4.jp)) {
                        quizWrongAnswers_4.push(currentQuiz_4);
                    }
                } else {
                    qOptions_4.classList.add('disabled-area'); 
                    const allBtns = qOptions_4.querySelectorAll('.option-btn');
                    allBtns.forEach(b => {
                        if (b.innerText === currentQuiz_4.mean) b.classList.add('correct');
                    });
                    setTimeout(nextQuizQuestion_4, 1500);
                }
            }
        }

        function endQuizGame_4() {
            document.getElementById('finalQuizScore_4').innerText = quizScore_4;
            document.getElementById('finalQuizProgress_4').innerText = `${quizCorrectCount_4} / ${quizTotalCount_4}`;
            qMistakeList_4.innerHTML = '';
            if (quizWrongAnswers_4.length === 0) {
                qMistakeList_4.innerHTML = '<div style="color:#2ecc71; text-align:center; padding:20px;">ğŸ† ì™„ë²½í•©ë‹ˆë‹¤!</div>';
            } else {
                quizWrongAnswers_4.forEach(w => {
                    const item = document.createElement('div');
                    item.className = 'mistake-item';
                    item.innerHTML = `<span class="mistake-jp">${w.jp}</span> (${w.yomi}) : ${w.mean}`;
                    qMistakeList_4.appendChild(item);
                });
            }
            qResult_4.style.display = 'flex';
        }

        function speak_4() {
            if (!('speechSynthesis' in window)) {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }
            const text = currentQuiz_4.jp;
            const utt = new SpeechSynthesisUtterance(text);
            utt.lang = 'ja-JP';
            utt.rate = 0.9; 

            const voices = window.speechSynthesis.getVoices();
            const jaVoice = voices.find(v => v.lang.includes('ja') || v.lang.includes('JP'));
            if (jaVoice) utt.voice = jaVoice;

            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utt);
        }

        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = function() { 
                window.speechSynthesis.getVoices(); 
            };
        }

        initQuizGame_4();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLPT N5 ë‹¨ì–´ í€´ì¦ˆ 1</title>
    
    <style>
        /* --- ì¶”ê°€ëœ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .back-link {
            display: inline-block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #34495e;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .back-link:hover { background-color: #2c3e50; transform: translateY(-2px); }
        .top-bar { text-align: center; background-color: #f4f7f6; padding-top: 10px; }

        /* --- ê¸°ì¡´ ìˆ˜í›ˆë‹˜ CSS ì½”ë“œ --- */
        /* 1. ë‹¨ì–´ í€´ì¦ˆ ì „ìš© ë˜í¼ */
        #jp-wordquiz-wrapper {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* ì˜¤íƒ€ ìˆ˜ì •: justify_content -> justify-content */
            padding: 40px 20px;
            border-radius: 10px;
            margin: 0 auto 30px auto; /* ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ ìˆ˜ì • */
            max-width: 800px;
            position: relative;
            
            /* ë³€ìˆ˜ ì„¤ì • */
            --max-width: 450px;
            --q-font: 60px;
            --opt-font: 18px;
            --opt-padding: 15px;
            --hint-height: 35px;
        }

        /* ì‚¬ì´ì¦ˆë³„ í´ë˜ìŠ¤ */
        #jp-wordquiz-wrapper.size-small { --max-width: 350px; --q-font: 45px; --opt-font: 14px; --opt-padding: 10px; --hint-height: 30px; }
        #jp-wordquiz-wrapper.size-large { --max-width: 700px; --q-font: 90px; --opt-font: 24px; --opt-padding: 20px; --hint-height: 50px; }

        /* ë‚´ë¶€ ì»¨í…Œì´ë„ˆ */
        #jp-wordquiz-wrapper .quiz-container {
            background-color: #34495e; padding: 30px; border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); text-align: center;
            width: 100%; max-width: var(--max-width); position: relative; transition: max-width 0.3s; box-sizing: border-box;
        }

        /* íƒ€ì´í‹€ */
        #jp-wordquiz-wrapper h2.game-title { margin-top: 25px; font-size: 24px; color: #ecf0f1; border: none; margin-bottom: 5px; }
        .game-subtitle { font-size: 16px; color: #f39c12; margin-bottom: 15px; font-weight: bold; }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .size-controls, .set-controls { display: flex; gap: 5px; }
        .ctrl-btn { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: #bdc3c7; padding: 5px 10px; font-size: 12px; cursor: pointer; border-radius: 4px; }
        .ctrl-btn:hover { background: rgba(0,0,0,0.5); color: white; }
        .ctrl-btn.active { background: #3498db; color: white; border-color: #3498db; }
        .set-btn.active { background: #e67e22; border-color: #e67e22; color: white; }

        /* ìƒíƒœë°” */
        .quiz-status-bar { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 16px; color: #bdc3c7; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; }
        .highlight { color: #f1c40f; font-weight: bold; }

        /* ë¬¸ì œ ì˜ì—­ (ë‹¨ì–´ + ìŠ¤í”¼ì»¤) */
        .question-area { display: flex; align-items: center; justify-content: center; gap: 10px; margin: 10px 0 5px 0; }
        .question-box { font-size: var(--q-font); font-weight: bold; min-height: calc(var(--q-font) * 1.5); color: #ecf0f1; text-shadow: 2px 2px 5px rgba(0,0,0,0.3); line-height: 1.2; }

        /* ìŠ¤í”¼ì»¤ ë²„íŠ¼ */
        .audio-btn { background: #ecf0f1; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; color: #2c3e50; }
        .audio-btn:active { transform: scale(0.9); }
        .audio-btn:hover { background: #bdc3c7; }
        
        /* íŒíŠ¸ ì˜ì—­ */
        .question-yomi { font-size: calc(var(--opt-font) + 4px); color: #f39c12; margin-bottom: 20px; height: var(--hint-height); font-weight: bold; transition: opacity 0.3s; }

        /* ë³´ê¸° ë²„íŠ¼ ì˜ì—­ */
        .options-grid { display: flex; flex-direction: column; gap: 12px; }
        .option-btn { background-color: #ecf0f1; color: #2c3e50; border: none; padding: var(--opt-padding); font-size: var(--opt-font); border-radius: 8px; cursor: pointer; transition: all 0.1s; font-weight: bold; position: relative; }
        .option-btn:hover { background-color: #bdc3c7; transform: translateY(-2px); }
        .option-btn.correct { background-color: #2ecc71 !important; color: white; transform: scale(1.02); }
        .option-btn.wrong { background-color: #e74c3c !important; color: white; opacity: 0.6; cursor: not-allowed; }
        .disabled-area { pointer-events: none; }

        /* ê²°ê³¼ í™”ë©´ */
        #quizResultScreen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(44, 62, 80, 0.98); border-radius: 15px; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        #quizResultScreen h2 { font-size: 32px; margin-bottom: 10px; color: #2ecc71; border: none;}
        .result-stat { font-size: 20px; margin: 5px 0; color: white; }
        
        .mistake-log-container { margin-top: 15px; width: 90%; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 10px; max-height: 200px; overflow-y: auto; text-align: left; }
        .mistake-item { border-bottom: 1px solid rgba(255,255,255,0.1); padding: 8px 0; font-size: 15px; color: #bdc3c7; }
        .mistake-jp { color: #e74c3c; font-weight: bold; margin-right: 8px;}
        
        .restart-btn { margin-top: 25px; padding: 12px 30px; font-size: 18px; background-color: #e67e22; color: white; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body style="background-color: #f4f7f6; margin: 0; padding: 0;">

    <div class="top-bar">
        <a href="../index.html" class="back-link">ğŸ”™ ë©”ì¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div id="jp-wordquiz-wrapper">
        <div class="quiz-container">
            
            <div class="control-panel">
                <div class="set-controls">
                    <button class="ctrl-btn set-btn active" onclick="changeSet(1)">Set 1</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet(2)">Set 2</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet(3)">Set 3</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet(4)">Set 4</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet(5)">Set 5</button>
                    <button class="ctrl-btn set-btn" onclick="changeSet('all')">ALL</button>
                </div>
                <div class="size-controls">
                    <button class="ctrl-btn size-btn" onclick="setQuizSize('small')">ì‘ê²Œ</button>
                    <button class="ctrl-btn size-btn active" onclick="setQuizSize('medium')" id="btnQuizMedium">ë³´í†µ</button>
                    <button class="ctrl-btn size-btn" onclick="setQuizSize('large')">í¬ê²Œ</button>
                </div>
            </div>

            <h2 class="game-title">ğŸ‡¯ğŸ‡µ JLPT N5 ë‹¨ì–´ì¥</h2>
            <div class="game-subtitle" id="setSubtitle">[ Set 1 : ì‹œì‘í•˜ê¸° ]</div>

            <div class="quiz-status-bar">
                <span>ì§„í–‰: <span id="quizProgress" class="highlight" style="color:#2ecc71">0 / 0</span></span>
                <span>ì ìˆ˜: <span id="quizScore" class="highlight">0</span></span>
            </div>

            <div class="question-area">
                <div class="question-box" id="quizQuestionText">???</div>
                <button class="audio-btn" onclick="speak()" title="ë‹¨ì–´ ë“£ê¸°">ğŸ”Š</button>
            </div>
            
            <div class="question-yomi" id="quizHintBox"></div>

            <div class="options-grid" id="quizOptionsArea"></div>

            <div id="quizResultScreen">
                <h2>ğŸ‰ í€´ì¦ˆ ì™„ë£Œ! ğŸ‰</h2>
                <div class="result-stat">ìµœì¢… ì ìˆ˜: <b id="finalQuizScore" style="color:#f1c40f">0</b></div>
                <div class="result-stat">ë§ì¶˜ ê°œìˆ˜: <b id="finalQuizProgress">0 / 0</b></div>
                
                <div class="mistake-log-container">
                    <div style="font-size:14px; color:#e74c3c; text-align:center; margin-bottom:5px;">â–¼ í‹€ë¦° ë‹¨ì–´ ë³µìŠµ â–¼</div>
                    <div id="quizMistakeList"></div>
                </div>

                <button class="restart-btn" onclick="initQuizGame()">ë‹¤ì‹œ í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // 1. ë‹¨ì–´ì¥ ë°ì´í„° (N5 1íƒ„: ëª…ì‚¬ 100ì„ )
        const wordQuizDB = [
            // Set 1: ì‚¬ëŒ/ì¸ì¹­/ê°€ì¡± (1-20)
            { jp: 'ã‚ãŸã—', mean: 'ë‚˜ (ì €)', yomi: 'watashi', set: 1 }, { jp: 'ã‚ãªãŸ', mean: 'ë‹¹ì‹ ', yomi: 'anata', set: 1 }, { jp: 'ã²ã¨', mean: 'ì‚¬ëŒ', yomi: 'hito', set: 1 }, { jp: 'ã›ã‚“ã›ã„', mean: 'ì„ ìƒë‹˜', yomi: 'sensei', set: 1 }, { jp: 'ãŒãã›ã„', mean: 'í•™ìƒ', yomi: 'gakusei', set: 1 }, { jp: 'ã„ã—ã‚ƒ', mean: 'ì˜ì‚¬', yomi: 'isha', set: 1 }, { jp: 'ã‹ãã', mean: 'ê°€ì¡±', yomi: 'kazoku', set: 1 }, { jp: 'ã¨ã‚‚ã ã¡', mean: 'ì¹œêµ¬', yomi: 'tomodachi', set: 1 }, { jp: 'ã¡ã¡', mean: 'ì•„ë¹  (ë‚˜ì˜)', yomi: 'chichi', set: 1 }, { jp: 'ã¯ã¯', mean: 'ì—„ë§ˆ (ë‚˜ì˜)', yomi: 'haha', set: 1 }, { jp: 'ãŠã¨ã“', mean: 'ë‚¨ì', yomi: 'otoko', set: 1 }, { jp: 'ãŠã‚“ãª', mean: 'ì—¬ì', yomi: 'onna', set: 1 }, { jp: 'ã“ã©ã‚‚', mean: 'ì•„ì´', yomi: 'kodomo', set: 1 }, { jp: 'ãŠã¨ãª', mean: 'ì–´ë¥¸', yomi: 'otona', set: 1 }, { jp: 'ãŒã„ã“ãã˜ã‚“', mean: 'ì™¸êµ­ì¸', yomi: 'gaikokujin', set: 1 }, { jp: 'ã‚ã«', mean: 'í˜•/ì˜¤ë¹  (ë‚˜ì˜)', yomi: 'ani', set: 1 }, { jp: 'ã‚ã­', mean: 'ëˆ„ë‚˜/ì–¸ë‹ˆ (ë‚˜ì˜)', yomi: 'ane', set: 1 }, { jp: 'ãŠã¨ã†ã¨', mean: 'ë‚¨ë™ìƒ (ë‚˜ì˜)', yomi: 'otouto', set: 1 }, { jp: 'ã„ã‚‚ã†ã¨', mean: 'ì—¬ë™ìƒ (ë‚˜ì˜)', yomi: 'imouto', set: 1 }, { jp: 'ã ã‚Œ', mean: 'ëˆ„êµ¬', yomi: 'dare', set: 1 },
            // Set 2: ì‹œê°„/ë•Œ (21-40)
            { jp: 'ã„ã¾', mean: 'ì§€ê¸ˆ', yomi: 'ima', set: 2 }, { jp: 'ãã‚‡ã†', mean: 'ì˜¤ëŠ˜', yomi: 'kyou', set: 2 }, { jp: 'ãã®ã†', mean: 'ì–´ì œ', yomi: 'kinou', set: 2 }, { jp: 'ã‚ã—ãŸ', mean: 'ë‚´ì¼', yomi: 'ashita', set: 2 }, { jp: 'ã‚ã•', mean: 'ì•„ì¹¨', yomi: 'asa', set: 2 }, { jp: 'ã²ã‚‹', mean: 'ì ì‹¬/ë‚®', yomi: 'hiru', set: 2 }, { jp: 'ã°ã‚“', mean: 'ì €ë…/ë°¤', yomi: 'ban', set: 2 }, { jp: 'ã¾ã„ã«ã¡', mean: 'ë§¤ì¼', yomi: 'mainichi', set: 2 }, { jp: 'ã›ã‚“ã—ã‚…ã†', mean: 'ì§€ë‚œì£¼', yomi: 'senshuu', set: 2 }, { jp: 'ã“ã‚“ã—ã‚…ã†', mean: 'ì´ë²ˆì£¼', yomi: 'konshuu', set: 2 }, { jp: 'ã‚‰ã„ã—ã‚…ã†', mean: 'ë‹¤ìŒì£¼', yomi: 'raishuu', set: 2 }, { jp: 'ãã‚‡ã­ã‚“', mean: 'ì‘ë…„', yomi: 'kyonen', set: 2 }, { jp: 'ã“ã¨ã—', mean: 'ì˜¬í•´', yomi: 'kotoshi', set: 2 }, { jp: 'ã‚‰ã„ã­ã‚“', mean: 'ë‚´ë…„', yomi: 'rainen', set: 2 }, { jp: 'ãŸã‚“ã˜ã‚‡ã†ã³', mean: 'ìƒì¼', yomi: 'tanjoubi', set: 2 }, { jp: 'ã„ã¤', mean: 'ì–¸ì œ', yomi: 'itsu', set: 2 }, { jp: 'ã˜ã‹ã‚“', mean: 'ì‹œê°„', yomi: 'jikan', set: 2 }, { jp: 'ã’ã¤ã‚ˆã†ã³', mean: 'ì›”ìš”ì¼', yomi: 'getsuyoubi', set: 2 }, { jp: 'ã«ã¡ã‚ˆã†ã³', mean: 'ì¼ìš”ì¼', yomi: 'nichiyoubi', set: 2 }, { jp: 'ãªã‚“ã˜', mean: 'ëª‡ ì‹œ', yomi: 'nanji', set: 2 },
            // Set 3: ì‹ ì²´/ë™ë¬¼/ìì—°/ìŒì‹ (41-60)
            { jp: 'ã‚ãŸã¾', mean: 'ë¨¸ë¦¬', yomi: 'atama', set: 3 }, { jp: 'ã‚', mean: 'ëˆˆ(eye)', yomi: 'me', set: 3 }, { jp: 'ã¿ã¿', mean: 'ê·€', yomi: 'mimi', set: 3 }, { jp: 'ãã¡', mean: 'ì…', yomi: 'kuchi', set: 3 }, { jp: 'ã¦', mean: 'ì†', yomi: 'te', set: 3 }, { jp: 'ã‚ã—', mean: 'ë°œ/ë‹¤ë¦¬', yomi: 'ashi', set: 3 }, { jp: 'ã„ã¬', mean: 'ê°œ', yomi: 'inu', set: 3 }, { jp: 'ã­ã“', mean: 'ê³ ì–‘ì´', yomi: 'neko', set: 3 }, { jp: 'ã¨ã‚Š', mean: 'ìƒˆ', yomi: 'tori', set: 3 }, { jp: 'ã•ã‹ãª', mean: 'ë¬¼ê³ ê¸°', yomi: 'sakana', set: 3 }, { jp: 'ã', mean: 'ë‚˜ë¬´', yomi: 'ki', set: 3 }, { jp: 'ã¯ãª', mean: 'ê½ƒ', yomi: 'hana', set: 3 }, { jp: 'ã‚ã‚', mean: 'ë¹„', yomi: 'ame', set: 3 }, { jp: 'ã‚†ã', mean: 'ëˆˆ(snow)', yomi: 'yuki', set: 3 }, { jp: 'ãã‚‰', mean: 'í•˜ëŠ˜', yomi: 'sora', set: 3 }, { jp: 'ã”ã¯ã‚“', mean: 'ë°¥', yomi: 'gohan', set: 3 }, { jp: 'ãƒ‘ãƒ³', mean: 'ë¹µ', yomi: 'pan', set: 3 }, { jp: 'ã¿ãš', mean: 'ë¬¼', yomi: 'mizu', set: 3 }, { jp: 'ãŠã¡ã‚ƒ', mean: 'ì°¨(tea)', yomi: 'ocha', set: 3 }, { jp: 'ãã‚…ã†ã«ã‚…ã†', mean: 'ìš°ìœ ', yomi: 'gyuunyuu', set: 3 },
            // Set 4: ì‚¬ë¬¼/ë„êµ¬ (61-80)
            { jp: 'ã»ã‚“', mean: 'ì±…', yomi: 'hon', set: 4 }, { jp: 'ã˜ã—ã‚‡', mean: 'ì‚¬ì „', yomi: 'jisho', set: 4 }, { jp: 'ã—ã‚“ã¶ã‚“', mean: 'ì‹ ë¬¸', yomi: 'shinbun', set: 4 }, { jp: 'ã¨ã‘ã„', mean: 'ì‹œê³„', yomi: 'tokei', set: 4 }, { jp: 'ãˆã‚“ã´ã¤', mean: 'ì—°í•„', yomi: 'enpitsu', set: 4 }, { jp: 'ã‹ã°ã‚“', mean: 'ê°€ë°©', yomi: 'kaban', set: 4 }, { jp: 'ã‹ã•', mean: 'ìš°ì‚°', yomi: 'kasa', set: 4 }, { jp: 'ã‹ã­', mean: 'ëˆ', yomi: 'kane', set: 4 }, { jp: 'ã‚ãŒã­', mean: 'ì•ˆê²½', yomi: 'megane', set: 4 }, { jp: 'ãã™ã‚Š', mean: 'ì•½', yomi: 'kusuri', set: 4 }, { jp: 'ã¦ãŒã¿', mean: 'í¸ì§€', yomi: 'tegami', set: 4 }, { jp: 'ã§ã‚“ã‚', mean: 'ì „í™”', yomi: 'denwa', set: 4 }, { jp: 'ãã‚‹ã¾', mean: 'ìë™ì°¨', yomi: 'kuruma', set: 4 }, { jp: 'ã˜ã¦ã‚“ã—ã‚ƒ', mean: 'ìì „ê±°', yomi: 'jitensha', set: 4 }, { jp: 'ã§ã‚“ã—ã‚ƒ', mean: 'ì „ì² ', yomi: 'densha', set: 4 }, { jp: 'ã²ã“ã†ã', mean: 'ë¹„í–‰ê¸°', yomi: 'hikouki', set: 4 }, { jp: 'ãã£ã·', mean: 'í‘œ(í‹°ì¼“)', yomi: 'kippu', set: 4 }, { jp: 'ã„ã™', mean: 'ì˜ì', yomi: 'isu', set: 4 }, { jp: 'ã¤ããˆ', mean: 'ì±…ìƒ', yomi: 'tsukue', set: 4 }, { jp: 'ãã¤', mean: 'êµ¬ë‘/ì‹ ë°œ', yomi: 'kutsu', set: 4 },
            // Set 5: ì¥ì†Œ/ìœ„ì¹˜/ë°©í–¥ (81-100)
            { jp: 'ã„ãˆ', mean: 'ì§‘', yomi: 'ie', set: 5 }, { jp: 'ã¸ã‚„', mean: 'ë°©', yomi: 'heya', set: 5 }, { jp: 'ãŒã£ã“ã†', mean: 'í•™êµ', yomi: 'gakkou', set: 5 }, { jp: 'ãã‚‡ã†ã—ã¤', mean: 'êµì‹¤', yomi: 'kyoushitsu', set: 5 }, { jp: 'ã—ã‚‡ãã©ã†', mean: 'ì‹ë‹¹', yomi: 'shokudou', set: 5 }, { jp: 'ãƒˆã‚¤ãƒ¬', mean: 'í™”ì¥ì‹¤', yomi: 'toire', set: 5 }, { jp: 'ã³ã‚‡ã†ã„ã‚“', mean: 'ë³‘ì›', yomi: 'byouin', set: 5 }, { jp: 'ãã‚“ã“ã†', mean: 'ì€í–‰', yomi: 'ginkou', set: 5 }, { jp: 'ã‚†ã†ã³ã‚“ãã‚‡ã', mean: 'ìš°ì²´êµ­', yomi: 'yuubinkyoku', set: 5 }, { jp: 'ã“ã†ãˆã‚“', mean: 'ê³µì›', yomi: 'kouen', set: 5 }, { jp: 'ãƒ‡ãƒ‘ãƒ¼ãƒˆ', mean: 'ë°±í™”ì ', yomi: 'depato', set: 5 }, { jp: 'ãˆã', mean: 'ì—­(station)', yomi: 'eki', set: 5 }, { jp: 'ãã«', mean: 'ë‚˜ë¼', yomi: 'kuni', set: 5 }, { jp: 'ã†ãˆ', mean: 'ìœ„', yomi: 'ue', set: 5 }, { jp: 'ã—ãŸ', mean: 'ì•„ë˜', yomi: 'shita', set: 5 }, { jp: 'ã¾ãˆ', mean: 'ì•', yomi: 'mae', set: 5 }, { jp: 'ã†ã—ã‚', mean: 'ë’¤', yomi: 'ushiro', set: 5 }, { jp: 'ã¿ã', mean: 'ì˜¤ë¥¸ìª½', yomi: 'migi', set: 5 }, { jp: 'ã²ã ã‚Š', mean: 'ì™¼ìª½', yomi: 'hidari', set: 5 }, { jp: 'ãªã‹', mean: 'ì•ˆ(ì†)', yomi: 'naka', set: 5 }
        ];

        // 2. ë³€ìˆ˜ ë° DOM
        let quizDeck = [];
        let currentQuiz = null;
        let quizScore = 0;
        let quizCorrectCount = 0;
        let quizTotalCount = 0;
        let quizWrongAnswers = []; 
        let quizStartTime = 0; 
        let quizMistakeCount = 0; 
        let currentSet = 1;

        const quizWrapper = document.getElementById('jp-wordquiz-wrapper');
        const qText = document.getElementById('quizQuestionText');
        const qHint = document.getElementById('quizHintBox');
        const qOptions = document.getElementById('quizOptionsArea');
        const qProgress = document.getElementById('quizProgress');
        const qScore = document.getElementById('quizScore');
        const qResult = document.getElementById('quizResultScreen');
        const qMistakeList = document.getElementById('quizMistakeList');
        const qSubtitle = document.getElementById('setSubtitle');

        function setQuizSize(size) {
            quizWrapper.classList.remove('size-small', 'size-large');
            const buttons = quizWrapper.querySelectorAll('.size-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (size === 'small') {
                quizWrapper.classList.add('size-small');
                quizWrapper.querySelector("button[onclick=\"setQuizSize('small')\"]").classList.add('active');
            } else if (size === 'large') {
                quizWrapper.classList.add('size-large');
                quizWrapper.querySelector("button[onclick=\"setQuizSize('large')\"]").classList.add('active');
            } else {
                document.getElementById('btnQuizMedium').classList.add('active');
            }
        }

        function changeSet(set) {
            currentSet = set;
            const setBtns = document.querySelectorAll('.set-btn');
            setBtns.forEach(btn => btn.classList.remove('active'));
            
            if(set === 'all') {
                setBtns[5].classList.add('active');
                qSubtitle.innerText = `[ ì „ì²´ ë„ì „ : ì´ ${wordQuizDB.length}ë‹¨ì–´ ]`;
            } else {
                setBtns[set-1].classList.add('active');
                qSubtitle.innerText = `[ Set ${set} : ë‹¨ì–´ ${getSetRange(set)} ]`;
            }
            initQuizGame();
        }

        function getSetRange(set) {
            const start = (set - 1) * 20 + 1;
            const end = set * 20;
            return `${start}~${end}`;
        }

        function shuffleQuiz(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function initQuizGame() {
            let filteredDB = [];
            if (currentSet === 'all') {
                filteredDB = [...wordQuizDB];
            } else {
                filteredDB = wordQuizDB.filter(item => item.set === currentSet);
            }

            quizDeck = shuffleQuiz(filteredDB); 
            quizTotalCount = quizDeck.length; 
            quizScore = 0;
            quizCorrectCount = 0;
            quizWrongAnswers = [];
            qScore.innerText = quizScore;
            updateQuizProgress();
            qResult.style.display = 'none';
            nextQuizQuestion();
        }

        function updateQuizProgress() {
            qProgress.innerText = `${quizCorrectCount} / ${quizTotalCount}`;
        }

        function nextQuizQuestion() {
            if (quizDeck.length === 0) {
                endQuizGame();
                return;
            }
            qOptions.classList.remove('disabled-area');
            quizMistakeCount = 0; 
            currentQuiz = quizDeck.pop();
            qText.innerText = currentQuiz.jp;
            qHint.innerText = ""; 
            const options = generateQuizOptions(currentQuiz);
            renderQuizButtons(options);
            quizStartTime = Date.now();
        }

        function generateQuizOptions(correctItem) {
            const otherWords = wordQuizDB.filter(w => w.jp !== correctItem.jp);
            const distractors = shuffleQuiz(otherWords).slice(0, 4);
            const finalOptions = [...distractors, correctItem];
            return shuffleQuiz(finalOptions);
        }

        function renderQuizButtons(options) {
            qOptions.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.mean;
                btn.onclick = () => checkQuizAnswer(btn, opt);
                qOptions.appendChild(btn);
            });
        }

        function checkQuizAnswer(btn, selectedOpt) {
            if (selectedOpt.jp === currentQuiz.jp) {
                qOptions.classList.add('disabled-area'); 
                btn.classList.add('correct');
                
                if (quizMistakeCount === 0) {
                    const endTime = Date.now();
                    const timeTaken = (endTime - quizStartTime) / 1000; 
                    const point = Math.max(20, Math.floor(100 - (timeTaken * 5))); 
                    quizScore += point;
                    quizCorrectCount++; 
                } else {
                    quizCorrectCount++; 
                }

                qScore.innerText = quizScore;
                updateQuizProgress(); 
                setTimeout(nextQuizQuestion, 500); 
            } else {
                btn.classList.add('wrong');
                btn.disabled = true; 
                
                if (quizMistakeCount === 0) {
                    quizMistakeCount++;
                    qHint.innerText = `ğŸ’¡ íŒíŠ¸: ${currentQuiz.yomi}`;
                    if (!quizWrongAnswers.some(w => w.jp === currentQuiz.jp)) {
                        quizWrongAnswers.push(currentQuiz);
                    }
                } else {
                    qOptions.classList.add('disabled-area'); 
                    const allBtns = qOptions.querySelectorAll('.option-btn');
                    allBtns.forEach(b => {
                        if (b.innerText === currentQuiz.mean) b.classList.add('correct');
                    });
                    setTimeout(nextQuizQuestion, 1500);
                }
            }
        }

        function endQuizGame() {
            document.getElementById('finalQuizScore').innerText = quizScore;
            document.getElementById('finalQuizProgress').innerText = `${quizCorrectCount} / ${quizTotalCount}`;
            qMistakeList.innerHTML = '';
            if (quizWrongAnswers.length === 0) {
                qMistakeList.innerHTML = '<div style="color:#2ecc71; text-align:center; padding:20px;">ğŸ† ì™„ë²½í•©ë‹ˆë‹¤!</div>';
            } else {
                quizWrongAnswers.forEach(w => {
                    const item = document.createElement('div');
                    item.className = 'mistake-item';
                    item.innerHTML = `<span class="mistake-jp">${w.jp}</span> (${w.yomi}) : ${w.mean}`;
                    qMistakeList.appendChild(item);
                });
            }
            qResult.style.display = 'flex';
        }

        function speak() {
            if (!('speechSynthesis' in window)) {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }
            const text = currentQuiz.jp; 
            const utt = new SpeechSynthesisUtterance(text);
            utt.lang = 'ja-JP';
            utt.rate = 0.9; 

            const voices = window.speechSynthesis.getVoices();
            const jaVoice = voices.find(v => v.lang.includes('ja') || v.lang.includes('JP'));
            if (jaVoice) utt.voice = jaVoice;

            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utt);
        }

        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = function() { 
                window.speechSynthesis.getVoices(); 
            };
        }

        initQuizGame();
    </script>
</body>
</html>
